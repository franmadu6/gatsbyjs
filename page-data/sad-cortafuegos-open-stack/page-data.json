{"componentChunkName":"component---src-templates-post-js","path":"/sad-cortafuegos-open-stack","result":{"data":{"markdownRemark":{"html":"<h1 id=\"cortafuegos\"><a href=\"#cortafuegos\" aria-label=\"cortafuegos permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Cortafuegos</h1>\n<h2 id=\"vamos-a-construir-un-cortafuegos-en-dulcinea-que-nos-permita-controlar-el-tráfico-de-nuestra-red-el-cortafuegos-que-vamos-a-construir-debe-funcionar-tras-un-reinicio\"><a href=\"#vamos-a-construir-un-cortafuegos-en-dulcinea-que-nos-permita-controlar-el-tr%C3%A1fico-de-nuestra-red-el-cortafuegos-que-vamos-a-construir-debe-funcionar-tras-un-reinicio\" aria-label=\"vamos a construir un cortafuegos en dulcinea que nos permita controlar el tráfico de nuestra red el cortafuegos que vamos a construir debe funcionar tras un reinicio permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Vamos a construir un cortafuegos en dulcinea que nos permita controlar el tráfico de nuestra red. El cortafuegos que vamos a construir debe funcionar tras un reinicio.</h2>\n<p>El primer paso antes de ponernos a configurar la seguridad de nuestra red es necesario la instalación de nftables.</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\"><span class=\"token comment\">#instalación</span>\n<span class=\"token function\">apt</span> <span class=\"token function\">install</span> nftables\n<span class=\"token comment\">#activación</span>\nsystemctl start nftables\n<span class=\"token comment\">#para dejarlo habilitado</span>\nsystemctl <span class=\"token builtin class-name\">enable</span> nftables</code></pre></div>\n<h2 id=\"política-por-defecto\"><a href=\"#pol%C3%ADtica-por-defecto\" aria-label=\"política por defecto permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Política por defecto</h2>\n<p><strong>La política por defecto que vamos a configurar en nuestro cortafuegos será de tipo DROP.</strong></p>\n<p><strong>En un principio las tendremos en accept hasta que realicemos todas las reglas o almenos tengamos las reglas de ssh configurada para que podamos trabajar comodamente en nuestra terminal.</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">nft chain inet filter input <span class=\"token punctuation\">{</span> policy drop <span class=\"token punctuation\">\\</span><span class=\"token punctuation\">;</span> <span class=\"token punctuation\">}</span>\nnft chain inet filter forward <span class=\"token punctuation\">{</span> policy drop <span class=\"token punctuation\">\\</span><span class=\"token punctuation\">;</span> <span class=\"token punctuation\">}</span>\nnft chain inet filter output <span class=\"token punctuation\">{</span> policy drop <span class=\"token punctuation\">\\</span><span class=\"token punctuation\">;</span> <span class=\"token punctuation\">}</span></code></pre></div>\n<h2 id=\"nat\"><a href=\"#nat\" aria-label=\"nat permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>NAT</h2>\n<ul>\n<li><strong>Configura de manera adecuada las reglas NAT para que todas las máquinas de nuestra red tenga acceso al exterior.</strong></li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">nft <span class=\"token function\">add</span> table nat\n\nnft <span class=\"token function\">add</span> chain nat postrouting <span class=\"token punctuation\">{</span> <span class=\"token builtin class-name\">type</span> nat hook postrouting priority <span class=\"token number\">100</span> <span class=\"token punctuation\">\\</span><span class=\"token punctuation\">;</span> <span class=\"token punctuation\">}</span>\n\nnft <span class=\"token function\">add</span> rule <span class=\"token function\">ip</span> nat postrouting oifname <span class=\"token string\">\"eth0\"</span> <span class=\"token function\">ip</span> saddr <span class=\"token number\">10.0</span>.1.0/24 counter snat to <span class=\"token number\">10.0</span>.0.11\nnft <span class=\"token function\">add</span> rule <span class=\"token function\">ip</span> nat postrouting oifname <span class=\"token string\">\"eth0\"</span> <span class=\"token function\">ip</span> saddr <span class=\"token number\">10.0</span>.2.0/24 counter snat to <span class=\"token number\">10.0</span>.0.11</code></pre></div>\n<ul>\n<li><strong>Configura de manera adecuada todas las reglas NAT necesarias para que los servicios expuestos al exterior sean accesibles.</strong></li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">nft <span class=\"token function\">add</span> chain nat prerouting <span class=\"token punctuation\">{</span> <span class=\"token builtin class-name\">type</span> nat hook prerouting priority <span class=\"token number\">0</span> <span class=\"token punctuation\">\\</span><span class=\"token punctuation\">;</span> <span class=\"token punctuation\">}</span>\n\nnft <span class=\"token function\">add</span> rule <span class=\"token function\">ip</span> nat prerouting iifname <span class=\"token string\">\"eth0\"</span> udp dport <span class=\"token number\">53</span> counter dnat to <span class=\"token number\">10.0</span>.1.3\nnft <span class=\"token function\">add</span> rule <span class=\"token function\">ip</span> nat prerouting iifname <span class=\"token string\">\"eth0\"</span> tcp dport <span class=\"token number\">80</span> counter dnat to <span class=\"token number\">10.0</span>.2.4\nnft <span class=\"token function\">add</span> rule <span class=\"token function\">ip</span> nat prerouting iifname <span class=\"token string\">\"eth0\"</span> tcp dport <span class=\"token number\">443</span> counter dnat to <span class=\"token number\">10.0</span>.2.4</code></pre></div>\n<h2 id=\"reglas\"><a href=\"#reglas\" aria-label=\"reglas permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Reglas</h2>\n<p><strong>Para cada configuración, hay que mostrar las reglas que se han configurado y una prueba de funcionamiento de la misma:</strong></p>\n<h3 id=\"ping\"><a href=\"#ping\" aria-label=\"ping permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>PING</h3>\n<ul>\n<li><strong>Todas las máquinas de las dos redes pueden hacer ping entre ellas.</strong></li>\n</ul>\n<p><strong>Permitir ping Dulcinea con la red interna y la DMZ</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">nft <span class=\"token function\">add</span> rule inet filter forward <span class=\"token function\">ip</span> saddr <span class=\"token number\">10.0</span>.1.0/24 iifname <span class=\"token string\">\"eth1\"</span> <span class=\"token function\">ip</span> daddr <span class=\"token number\">10.0</span>.2.0/24 oifname <span class=\"token string\">\"eth2\"</span> icmp <span class=\"token builtin class-name\">type</span> echo-request counter accept\nnft <span class=\"token function\">add</span> rule inet filter forward <span class=\"token function\">ip</span> saddr <span class=\"token number\">10.0</span>.2.0/24 iifname <span class=\"token string\">\"eth2\"</span> <span class=\"token function\">ip</span> daddr <span class=\"token number\">10.0</span>.1.0/24 oifname <span class=\"token string\">\"eth1\"</span> icmp <span class=\"token builtin class-name\">type</span> echo-reply counter accept</code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">debian@freston:~$ <span class=\"token function\">ping</span> <span class=\"token number\">10.0</span>.2.4\nPING <span class=\"token number\">10.0</span>.2.4 <span class=\"token punctuation\">(</span><span class=\"token number\">10.0</span>.2.4<span class=\"token punctuation\">)</span> <span class=\"token number\">56</span><span class=\"token punctuation\">(</span><span class=\"token number\">84</span><span class=\"token punctuation\">)</span> bytes of data.\n<span class=\"token number\">64</span> bytes from <span class=\"token number\">10.0</span>.2.4: <span class=\"token assign-left variable\">icmp_seq</span><span class=\"token operator\">=</span><span class=\"token number\">1</span> <span class=\"token assign-left variable\">ttl</span><span class=\"token operator\">=</span><span class=\"token number\">63</span> <span class=\"token assign-left variable\">time</span><span class=\"token operator\">=</span><span class=\"token number\">3.08</span> ms\n<span class=\"token number\">64</span> bytes from <span class=\"token number\">10.0</span>.2.4: <span class=\"token assign-left variable\">icmp_seq</span><span class=\"token operator\">=</span><span class=\"token number\">2</span> <span class=\"token assign-left variable\">ttl</span><span class=\"token operator\">=</span><span class=\"token number\">63</span> <span class=\"token assign-left variable\">time</span><span class=\"token operator\">=</span><span class=\"token number\">1.55</span> ms\n<span class=\"token number\">64</span> bytes from <span class=\"token number\">10.0</span>.2.4: <span class=\"token assign-left variable\">icmp_seq</span><span class=\"token operator\">=</span><span class=\"token number\">3</span> <span class=\"token assign-left variable\">ttl</span><span class=\"token operator\">=</span><span class=\"token number\">63</span> <span class=\"token assign-left variable\">time</span><span class=\"token operator\">=</span><span class=\"token number\">1.54</span> ms\n^C\n--- <span class=\"token number\">10.0</span>.2.4 <span class=\"token function\">ping</span> statistics ---\n<span class=\"token number\">3</span> packets transmitted, <span class=\"token number\">3</span> received, <span class=\"token number\">0</span>% packet loss, <span class=\"token function\">time</span> 5ms\nrtt min/avg/max/mdev <span class=\"token operator\">=</span> <span class=\"token number\">1.538</span>/2.053/3.076/0.723 ms</code></pre></div>\n<p><strong>Permitir ping DMZ con la red interna</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">nft <span class=\"token function\">add</span> rule inet filter forward <span class=\"token function\">ip</span> saddr <span class=\"token number\">10.0</span>.2.0/24 iifname <span class=\"token string\">\"eth2\"</span> <span class=\"token function\">ip</span> daddr <span class=\"token number\">10.0</span>.1.0/24 oifname <span class=\"token string\">\"eth1\"</span> icmp <span class=\"token builtin class-name\">type</span> echo-request counter accept\nnft <span class=\"token function\">add</span> rule inet filter forward <span class=\"token function\">ip</span> saddr <span class=\"token number\">10.0</span>.1.0/24 iifname <span class=\"token string\">\"eth1\"</span> <span class=\"token function\">ip</span> daddr <span class=\"token number\">10.0</span>.2.0/24 oifname <span class=\"token string\">\"eth2\"</span> icmp <span class=\"token builtin class-name\">type</span> echo-reply counter accept</code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\"><span class=\"token punctuation\">[</span>centos@quijote ~<span class=\"token punctuation\">]</span>$ <span class=\"token function\">ping</span> <span class=\"token number\">10.0</span>.1.3\nPING <span class=\"token number\">10.0</span>.1.3 <span class=\"token punctuation\">(</span><span class=\"token number\">10.0</span>.1.3<span class=\"token punctuation\">)</span> <span class=\"token number\">56</span><span class=\"token punctuation\">(</span><span class=\"token number\">84</span><span class=\"token punctuation\">)</span> bytes of data.\n<span class=\"token number\">64</span> bytes from <span class=\"token number\">10.0</span>.1.3: <span class=\"token assign-left variable\">icmp_seq</span><span class=\"token operator\">=</span><span class=\"token number\">1</span> <span class=\"token assign-left variable\">ttl</span><span class=\"token operator\">=</span><span class=\"token number\">63</span> <span class=\"token assign-left variable\">time</span><span class=\"token operator\">=</span><span class=\"token number\">1.44</span> ms\n<span class=\"token number\">64</span> bytes from <span class=\"token number\">10.0</span>.1.3: <span class=\"token assign-left variable\">icmp_seq</span><span class=\"token operator\">=</span><span class=\"token number\">2</span> <span class=\"token assign-left variable\">ttl</span><span class=\"token operator\">=</span><span class=\"token number\">63</span> <span class=\"token assign-left variable\">time</span><span class=\"token operator\">=</span><span class=\"token number\">1.86</span> ms\n<span class=\"token number\">64</span> bytes from <span class=\"token number\">10.0</span>.1.3: <span class=\"token assign-left variable\">icmp_seq</span><span class=\"token operator\">=</span><span class=\"token number\">3</span> <span class=\"token assign-left variable\">ttl</span><span class=\"token operator\">=</span><span class=\"token number\">63</span> <span class=\"token assign-left variable\">time</span><span class=\"token operator\">=</span><span class=\"token number\">1.61</span> ms\n^C\n--- <span class=\"token number\">10.0</span>.1.3 <span class=\"token function\">ping</span> statistics ---\n<span class=\"token number\">3</span> packets transmitted, <span class=\"token number\">3</span> received, <span class=\"token number\">0</span>% packet loss, <span class=\"token function\">time</span> 5ms\nrtt min/avg/max/mdev <span class=\"token operator\">=</span> <span class=\"token number\">1.435</span>/1.633/1.859/0.177 ms</code></pre></div>\n<p><strong>Permitir ping red interna con la DMZ.</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">nft <span class=\"token function\">add</span> rule inet filter output <span class=\"token function\">ip</span> daddr <span class=\"token number\">10.0</span>.1.0/24 oifname <span class=\"token string\">\"eth1\"</span> icmp <span class=\"token builtin class-name\">type</span> echo-request counter accept\nnft <span class=\"token function\">add</span> rule inet filter input <span class=\"token function\">ip</span> saddr <span class=\"token number\">10.0</span>.1.0/24 iifname <span class=\"token string\">\"eth1\"</span> icmp <span class=\"token builtin class-name\">type</span> echo-reply counter accept</code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">root@dulcinea:/home/debian<span class=\"token comment\"># ping 10.0.1.3</span>\nPING <span class=\"token number\">10.0</span>.1.3 <span class=\"token punctuation\">(</span><span class=\"token number\">10.0</span>.1.3<span class=\"token punctuation\">)</span> <span class=\"token number\">56</span><span class=\"token punctuation\">(</span><span class=\"token number\">84</span><span class=\"token punctuation\">)</span> bytes of data.\n<span class=\"token number\">64</span> bytes from <span class=\"token number\">10.0</span>.1.3: <span class=\"token assign-left variable\">icmp_seq</span><span class=\"token operator\">=</span><span class=\"token number\">1</span> <span class=\"token assign-left variable\">ttl</span><span class=\"token operator\">=</span><span class=\"token number\">64</span> <span class=\"token assign-left variable\">time</span><span class=\"token operator\">=</span><span class=\"token number\">1.29</span> ms\n<span class=\"token number\">64</span> bytes from <span class=\"token number\">10.0</span>.1.3: <span class=\"token assign-left variable\">icmp_seq</span><span class=\"token operator\">=</span><span class=\"token number\">2</span> <span class=\"token assign-left variable\">ttl</span><span class=\"token operator\">=</span><span class=\"token number\">64</span> <span class=\"token assign-left variable\">time</span><span class=\"token operator\">=</span><span class=\"token number\">0.895</span> ms\n<span class=\"token number\">64</span> bytes from <span class=\"token number\">10.0</span>.1.3: <span class=\"token assign-left variable\">icmp_seq</span><span class=\"token operator\">=</span><span class=\"token number\">3</span> <span class=\"token assign-left variable\">ttl</span><span class=\"token operator\">=</span><span class=\"token number\">64</span> <span class=\"token assign-left variable\">time</span><span class=\"token operator\">=</span><span class=\"token number\">0.746</span> ms\n^C\n--- <span class=\"token number\">10.0</span>.1.3 <span class=\"token function\">ping</span> statistics ---\n<span class=\"token number\">3</span> packets transmitted, <span class=\"token number\">3</span> received, <span class=\"token number\">0</span>% packet loss, <span class=\"token function\">time</span> 5ms\nrtt min/avg/max/mdev <span class=\"token operator\">=</span> <span class=\"token number\">0.746</span>/0.975/1.286/0.230 ms</code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">nft <span class=\"token function\">add</span> rule inet filter output <span class=\"token function\">ip</span> daddr <span class=\"token number\">10.0</span>.2.0/24 oifname <span class=\"token string\">\"eth2\"</span> icmp <span class=\"token builtin class-name\">type</span> echo-request counter accept\nnft <span class=\"token function\">add</span> rule inet filter input <span class=\"token function\">ip</span> saddr <span class=\"token number\">10.0</span>.2.0/24 iifname <span class=\"token string\">\"eth2\"</span> icmp <span class=\"token builtin class-name\">type</span> echo-reply counter accept</code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">root@dulcinea:/home/debian<span class=\"token comment\"># ping 10.0.2.4</span>\nPING <span class=\"token number\">10.0</span>.2.4 <span class=\"token punctuation\">(</span><span class=\"token number\">10.0</span>.2.4<span class=\"token punctuation\">)</span> <span class=\"token number\">56</span><span class=\"token punctuation\">(</span><span class=\"token number\">84</span><span class=\"token punctuation\">)</span> bytes of data.\n<span class=\"token number\">64</span> bytes from <span class=\"token number\">10.0</span>.2.4: <span class=\"token assign-left variable\">icmp_seq</span><span class=\"token operator\">=</span><span class=\"token number\">1</span> <span class=\"token assign-left variable\">ttl</span><span class=\"token operator\">=</span><span class=\"token number\">64</span> <span class=\"token assign-left variable\">time</span><span class=\"token operator\">=</span><span class=\"token number\">2.35</span> ms\n<span class=\"token number\">64</span> bytes from <span class=\"token number\">10.0</span>.2.4: <span class=\"token assign-left variable\">icmp_seq</span><span class=\"token operator\">=</span><span class=\"token number\">2</span> <span class=\"token assign-left variable\">ttl</span><span class=\"token operator\">=</span><span class=\"token number\">64</span> <span class=\"token assign-left variable\">time</span><span class=\"token operator\">=</span><span class=\"token number\">1.10</span> ms\n<span class=\"token number\">64</span> bytes from <span class=\"token number\">10.0</span>.2.4: <span class=\"token assign-left variable\">icmp_seq</span><span class=\"token operator\">=</span><span class=\"token number\">3</span> <span class=\"token assign-left variable\">ttl</span><span class=\"token operator\">=</span><span class=\"token number\">64</span> <span class=\"token assign-left variable\">time</span><span class=\"token operator\">=</span><span class=\"token number\">1.39</span> ms\n^C\n--- <span class=\"token number\">10.0</span>.2.4 <span class=\"token function\">ping</span> statistics ---\n<span class=\"token number\">3</span> packets transmitted, <span class=\"token number\">3</span> received, <span class=\"token number\">0</span>% packet loss, <span class=\"token function\">time</span> 5ms\nrtt min/avg/max/mdev <span class=\"token operator\">=</span> <span class=\"token number\">1.097</span>/1.610/2.345/0.533 ms</code></pre></div>\n<ul>\n<li><strong>Todas las máquinas pueden hacer ping a una máquina del exterior.</strong></li>\n</ul>\n<p><strong>Permitir ping red interna al exterior.</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">nft <span class=\"token function\">add</span> rule inet filter forward <span class=\"token function\">ip</span> saddr <span class=\"token number\">10.0</span>.1.0/24 iifname <span class=\"token string\">\"eth1\"</span> oifname <span class=\"token string\">\"eth0\"</span> icmp <span class=\"token builtin class-name\">type</span> echo-request counter accept\nnft <span class=\"token function\">add</span> rule inet filter forward <span class=\"token function\">ip</span> daddr <span class=\"token number\">10.0</span>.1.0/24 iifname <span class=\"token string\">\"eth0\"</span> oifname <span class=\"token string\">\"eth1\"</span> icmp <span class=\"token builtin class-name\">type</span> echo-reply counter accept</code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">debian@freston:~$ <span class=\"token function\">ping</span> <span class=\"token number\">1.1</span>.1.1\nPING <span class=\"token number\">1.1</span>.1.1 <span class=\"token punctuation\">(</span><span class=\"token number\">1.1</span>.1.1<span class=\"token punctuation\">)</span> <span class=\"token number\">56</span><span class=\"token punctuation\">(</span><span class=\"token number\">84</span><span class=\"token punctuation\">)</span> bytes of data.\n<span class=\"token number\">64</span> bytes from <span class=\"token number\">1.1</span>.1.1: <span class=\"token assign-left variable\">icmp_seq</span><span class=\"token operator\">=</span><span class=\"token number\">1</span> <span class=\"token assign-left variable\">ttl</span><span class=\"token operator\">=</span><span class=\"token number\">54</span> <span class=\"token assign-left variable\">time</span><span class=\"token operator\">=</span><span class=\"token number\">42.2</span> ms\n<span class=\"token number\">64</span> bytes from <span class=\"token number\">1.1</span>.1.1: <span class=\"token assign-left variable\">icmp_seq</span><span class=\"token operator\">=</span><span class=\"token number\">2</span> <span class=\"token assign-left variable\">ttl</span><span class=\"token operator\">=</span><span class=\"token number\">54</span> <span class=\"token assign-left variable\">time</span><span class=\"token operator\">=</span><span class=\"token number\">41.6</span> ms\n<span class=\"token number\">64</span> bytes from <span class=\"token number\">1.1</span>.1.1: <span class=\"token assign-left variable\">icmp_seq</span><span class=\"token operator\">=</span><span class=\"token number\">3</span> <span class=\"token assign-left variable\">ttl</span><span class=\"token operator\">=</span><span class=\"token number\">54</span> <span class=\"token assign-left variable\">time</span><span class=\"token operator\">=</span><span class=\"token number\">42.2</span> ms\n^C\n--- <span class=\"token number\">1.1</span>.1.1 <span class=\"token function\">ping</span> statistics ---\n<span class=\"token number\">3</span> packets transmitted, <span class=\"token number\">3</span> received, <span class=\"token number\">0</span>% packet loss, <span class=\"token function\">time</span> 6ms\nrtt min/avg/max/mdev <span class=\"token operator\">=</span> <span class=\"token number\">41.589</span>/41.972/42.168/0.270 ms</code></pre></div>\n<p><strong>Permitir ping DMZ al exterior.</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">nft <span class=\"token function\">add</span> rule inet filter forward <span class=\"token function\">ip</span> saddr <span class=\"token number\">10.0</span>.2.0/24 iifname <span class=\"token string\">\"eth2\"</span> oifname <span class=\"token string\">\"eth0\"</span> icmp <span class=\"token builtin class-name\">type</span> echo-request counter accept\nnft <span class=\"token function\">add</span> rule inet filter forward <span class=\"token function\">ip</span> daddr <span class=\"token number\">10.0</span>.2.0/24 iifname <span class=\"token string\">\"eth0\"</span> oifname <span class=\"token string\">\"eth2\"</span> icmp <span class=\"token builtin class-name\">type</span> echo-reply counter accept</code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\"><span class=\"token punctuation\">[</span>centos@quijote ~<span class=\"token punctuation\">]</span>$ <span class=\"token function\">ping</span> <span class=\"token number\">1.1</span>.1.1\nPING <span class=\"token number\">1.1</span>.1.1 <span class=\"token punctuation\">(</span><span class=\"token number\">1.1</span>.1.1<span class=\"token punctuation\">)</span> <span class=\"token number\">56</span><span class=\"token punctuation\">(</span><span class=\"token number\">84</span><span class=\"token punctuation\">)</span> bytes of data.\n<span class=\"token number\">64</span> bytes from <span class=\"token number\">1.1</span>.1.1: <span class=\"token assign-left variable\">icmp_seq</span><span class=\"token operator\">=</span><span class=\"token number\">1</span> <span class=\"token assign-left variable\">ttl</span><span class=\"token operator\">=</span><span class=\"token number\">54</span> <span class=\"token assign-left variable\">time</span><span class=\"token operator\">=</span><span class=\"token number\">43.6</span> ms\n<span class=\"token number\">64</span> bytes from <span class=\"token number\">1.1</span>.1.1: <span class=\"token assign-left variable\">icmp_seq</span><span class=\"token operator\">=</span><span class=\"token number\">2</span> <span class=\"token assign-left variable\">ttl</span><span class=\"token operator\">=</span><span class=\"token number\">54</span> <span class=\"token assign-left variable\">time</span><span class=\"token operator\">=</span><span class=\"token number\">42.2</span> ms\n<span class=\"token number\">64</span> bytes from <span class=\"token number\">1.1</span>.1.1: <span class=\"token assign-left variable\">icmp_seq</span><span class=\"token operator\">=</span><span class=\"token number\">3</span> <span class=\"token assign-left variable\">ttl</span><span class=\"token operator\">=</span><span class=\"token number\">54</span> <span class=\"token assign-left variable\">time</span><span class=\"token operator\">=</span><span class=\"token number\">42.3</span> ms\n^C\n--- <span class=\"token number\">1.1</span>.1.1 <span class=\"token function\">ping</span> statistics ---\n<span class=\"token number\">3</span> packets transmitted, <span class=\"token number\">3</span> received, <span class=\"token number\">0</span>% packet loss, <span class=\"token function\">time</span> 5ms\nrtt min/avg/max/mdev <span class=\"token operator\">=</span> <span class=\"token number\">42.172</span>/42.695/43.628/0.661 ms</code></pre></div>\n<p><strong>Permitir ping de Dulcinea al exterior.</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">nft <span class=\"token function\">add</span> rule inet filter input iifname <span class=\"token string\">\"eth0\"</span> icmp <span class=\"token builtin class-name\">type</span> echo-request counter accept\nnft <span class=\"token function\">add</span> rule inet filter output oifname <span class=\"token string\">\"eth0\"</span> icmp <span class=\"token builtin class-name\">type</span> echo-reply counter accept</code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">root@dulcinea:/home/debian<span class=\"token comment\"># ping 1.1.1.1</span>\nPING <span class=\"token number\">1.1</span>.1.1 <span class=\"token punctuation\">(</span><span class=\"token number\">1.1</span>.1.1<span class=\"token punctuation\">)</span> <span class=\"token number\">56</span><span class=\"token punctuation\">(</span><span class=\"token number\">84</span><span class=\"token punctuation\">)</span> bytes of data.\n<span class=\"token number\">64</span> bytes from <span class=\"token number\">1.1</span>.1.1: <span class=\"token assign-left variable\">icmp_seq</span><span class=\"token operator\">=</span><span class=\"token number\">1</span> <span class=\"token assign-left variable\">ttl</span><span class=\"token operator\">=</span><span class=\"token number\">55</span> <span class=\"token assign-left variable\">time</span><span class=\"token operator\">=</span><span class=\"token number\">69.3</span> ms\n<span class=\"token number\">64</span> bytes from <span class=\"token number\">1.1</span>.1.1: <span class=\"token assign-left variable\">icmp_seq</span><span class=\"token operator\">=</span><span class=\"token number\">2</span> <span class=\"token assign-left variable\">ttl</span><span class=\"token operator\">=</span><span class=\"token number\">55</span> <span class=\"token assign-left variable\">time</span><span class=\"token operator\">=</span><span class=\"token number\">40.8</span> ms\n<span class=\"token number\">64</span> bytes from <span class=\"token number\">1.1</span>.1.1: <span class=\"token assign-left variable\">icmp_seq</span><span class=\"token operator\">=</span><span class=\"token number\">3</span> <span class=\"token assign-left variable\">ttl</span><span class=\"token operator\">=</span><span class=\"token number\">55</span> <span class=\"token assign-left variable\">time</span><span class=\"token operator\">=</span><span class=\"token number\">41.2</span> ms\n^C\n--- <span class=\"token number\">1.1</span>.1.1 <span class=\"token function\">ping</span> statistics ---\n<span class=\"token number\">3</span> packets transmitted, <span class=\"token number\">3</span> received, <span class=\"token number\">0</span>% packet loss, <span class=\"token function\">time</span> 5ms\nrtt min/avg/max/mdev <span class=\"token operator\">=</span> <span class=\"token number\">40.796</span>/50.423/69.322/13.365 ms</code></pre></div>\n<ul>\n<li><strong>Desde el exterior se puede hacer ping a dulcinea.</strong></li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">nft <span class=\"token function\">add</span> rule inet filter input iifname <span class=\"token string\">\"eth0\"</span> icmp <span class=\"token builtin class-name\">type</span> echo-request counter accept\nnft <span class=\"token function\">add</span> rule inet filter output oifname <span class=\"token string\">\"eth0\"</span> icmp <span class=\"token builtin class-name\">type</span> echo-reply counter accept</code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">fran@debian:~$ <span class=\"token function\">ping</span> <span class=\"token number\">172.22</span>.201.38\nPING <span class=\"token number\">172.22</span>.201.38 <span class=\"token punctuation\">(</span><span class=\"token number\">172.22</span>.201.38<span class=\"token punctuation\">)</span> <span class=\"token number\">56</span><span class=\"token punctuation\">(</span><span class=\"token number\">84</span><span class=\"token punctuation\">)</span> bytes of data.\n<span class=\"token number\">64</span> bytes from <span class=\"token number\">172.22</span>.201.38: <span class=\"token assign-left variable\">icmp_seq</span><span class=\"token operator\">=</span><span class=\"token number\">1</span> <span class=\"token assign-left variable\">ttl</span><span class=\"token operator\">=</span><span class=\"token number\">63</span> <span class=\"token assign-left variable\">time</span><span class=\"token operator\">=</span><span class=\"token number\">2.87</span> ms\n<span class=\"token number\">64</span> bytes from <span class=\"token number\">172.22</span>.201.38: <span class=\"token assign-left variable\">icmp_seq</span><span class=\"token operator\">=</span><span class=\"token number\">2</span> <span class=\"token assign-left variable\">ttl</span><span class=\"token operator\">=</span><span class=\"token number\">63</span> <span class=\"token assign-left variable\">time</span><span class=\"token operator\">=</span><span class=\"token number\">1.24</span> ms\n<span class=\"token number\">64</span> bytes from <span class=\"token number\">172.22</span>.201.38: <span class=\"token assign-left variable\">icmp_seq</span><span class=\"token operator\">=</span><span class=\"token number\">3</span> <span class=\"token assign-left variable\">ttl</span><span class=\"token operator\">=</span><span class=\"token number\">63</span> <span class=\"token assign-left variable\">time</span><span class=\"token operator\">=</span><span class=\"token number\">1.16</span> ms\n^C\n--- <span class=\"token number\">172.22</span>.201.38 <span class=\"token function\">ping</span> statistics ---\n<span class=\"token number\">3</span> packets transmitted, <span class=\"token number\">3</span> received, <span class=\"token number\">0</span>% packet loss, <span class=\"token function\">time</span> 5ms\nrtt min/avg/max/mdev <span class=\"token operator\">=</span> <span class=\"token number\">1.156</span>/1.755/2.872/0.791 ms</code></pre></div>\n<ul>\n<li><strong>A dulcinea se le puede hacer ping desde la DMZ, pero desde la LAN se le debe rechazar la conexión (REJECT).</strong></li>\n</ul>\n<p><strong>Rechazar ping de red interna hacia Dulcinea.</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">nft <span class=\"token function\">add</span> rule inet filter input <span class=\"token function\">ip</span> saddr <span class=\"token number\">10.0</span>.1.0/24 iifname <span class=\"token string\">\"eth1\"</span> icmp <span class=\"token builtin class-name\">type</span> echo-request counter reject</code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">debian@freston:~$ <span class=\"token function\">ping</span> <span class=\"token number\">10.0</span>.1.7\nPING <span class=\"token number\">10.0</span>.1.7 <span class=\"token punctuation\">(</span><span class=\"token number\">10.0</span>.1.7<span class=\"token punctuation\">)</span> <span class=\"token number\">56</span><span class=\"token punctuation\">(</span><span class=\"token number\">84</span><span class=\"token punctuation\">)</span> bytes of data.\nFrom <span class=\"token number\">10.0</span>.1.7 <span class=\"token assign-left variable\">icmp_seq</span><span class=\"token operator\">=</span><span class=\"token number\">1</span> Destination Port Unreachable\nFrom <span class=\"token number\">10.0</span>.1.7 <span class=\"token assign-left variable\">icmp_seq</span><span class=\"token operator\">=</span><span class=\"token number\">2</span> Destination Port Unreachable\nFrom <span class=\"token number\">10.0</span>.1.7 <span class=\"token assign-left variable\">icmp_seq</span><span class=\"token operator\">=</span><span class=\"token number\">3</span> Destination Port Unreachable\n^C\n--- <span class=\"token number\">10.0</span>.1.7 <span class=\"token function\">ping</span> statistics ---\n<span class=\"token number\">3</span> packets transmitted, <span class=\"token number\">0</span> received, +3 errors, <span class=\"token number\">100</span>% packet loss, <span class=\"token function\">time</span> 4ms</code></pre></div>\n<p><strong>Permitir ping de DMZ hacia Dulcinea.</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">nft <span class=\"token function\">add</span> rule inet filter input <span class=\"token function\">ip</span> saddr <span class=\"token number\">10.0</span>.2.0/24 iifname <span class=\"token string\">\"eth2\"</span> icmp <span class=\"token builtin class-name\">type</span> echo-request counter accept\nnft <span class=\"token function\">add</span> rule inet filter output <span class=\"token function\">ip</span> daddr <span class=\"token number\">10.0</span>.2.0/24 oifname <span class=\"token string\">\"eth2\"</span> icmp <span class=\"token builtin class-name\">type</span> echo-reply counter accept</code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\"><span class=\"token punctuation\">[</span>centos@quijote ~<span class=\"token punctuation\">]</span>$ <span class=\"token function\">ping</span> <span class=\"token number\">10.0</span>.2.6\nPING <span class=\"token number\">10.0</span>.2.6 <span class=\"token punctuation\">(</span><span class=\"token number\">10.0</span>.2.6<span class=\"token punctuation\">)</span> <span class=\"token number\">56</span><span class=\"token punctuation\">(</span><span class=\"token number\">84</span><span class=\"token punctuation\">)</span> bytes of data.\n<span class=\"token number\">64</span> bytes from <span class=\"token number\">10.0</span>.2.6: <span class=\"token assign-left variable\">icmp_seq</span><span class=\"token operator\">=</span><span class=\"token number\">1</span> <span class=\"token assign-left variable\">ttl</span><span class=\"token operator\">=</span><span class=\"token number\">64</span> <span class=\"token assign-left variable\">time</span><span class=\"token operator\">=</span><span class=\"token number\">1.36</span> ms\n<span class=\"token number\">64</span> bytes from <span class=\"token number\">10.0</span>.2.6: <span class=\"token assign-left variable\">icmp_seq</span><span class=\"token operator\">=</span><span class=\"token number\">2</span> <span class=\"token assign-left variable\">ttl</span><span class=\"token operator\">=</span><span class=\"token number\">64</span> <span class=\"token assign-left variable\">time</span><span class=\"token operator\">=</span><span class=\"token number\">1.48</span> ms\n<span class=\"token number\">64</span> bytes from <span class=\"token number\">10.0</span>.2.6: <span class=\"token assign-left variable\">icmp_seq</span><span class=\"token operator\">=</span><span class=\"token number\">3</span> <span class=\"token assign-left variable\">ttl</span><span class=\"token operator\">=</span><span class=\"token number\">64</span> <span class=\"token assign-left variable\">time</span><span class=\"token operator\">=</span><span class=\"token number\">1.48</span> ms\n^C\n--- <span class=\"token number\">10.0</span>.2.6 <span class=\"token function\">ping</span> statistics ---\n<span class=\"token number\">3</span> packets transmitted, <span class=\"token number\">3</span> received, <span class=\"token number\">0</span>% packet loss, <span class=\"token function\">time</span> 6ms\nrtt min/avg/max/mdev <span class=\"token operator\">=</span> <span class=\"token number\">1.356</span>/1.439/1.481/0.058 ms</code></pre></div>\n<h3 id=\"ssh\"><a href=\"#ssh\" aria-label=\"ssh permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>ssh</h3>\n<ul>\n<li><strong>Podemos acceder por ssh a todas las máquinas.</strong></li>\n</ul>\n<p>LAN</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">nft <span class=\"token function\">add</span> rule inet filter output <span class=\"token function\">ip</span> daddr <span class=\"token number\">10.0</span>.1.0/24 oifname <span class=\"token string\">\"eth1\"</span> tcp dport <span class=\"token number\">22</span> ct state new,established counter accept\nnft <span class=\"token function\">add</span> rule inet filter input <span class=\"token function\">ip</span> saddr <span class=\"token number\">10.0</span>.1.0/24 iifname <span class=\"token string\">\"eth1\"</span> tcp sport <span class=\"token number\">22</span> ct state established counter accept</code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">root@dulcinea:/home/debian<span class=\"token comment\"># ssh debian@freston</span>\ndebian@freston's password: \nLinux freston.madu.gonzalonazareno.org <span class=\"token number\">4.19</span>.0-13-cloud-amd64 <span class=\"token comment\">#1 SMP Debian 4.19.160-2 (2020-11-28) x86_64</span>\n\nThe programs included with the Debian GNU/Linux system are <span class=\"token function\">free</span> software<span class=\"token punctuation\">;</span>\nthe exact distribution terms <span class=\"token keyword\">for</span> each program are described <span class=\"token keyword\">in</span> the\nindividual files <span class=\"token keyword\">in</span> /usr/share/doc/*/copyright.\n\nDebian GNU/Linux comes with ABSOLUTELY NO WARRANTY, to the extent\npermitted by applicable law.\nLast login: Tue May <span class=\"token number\">11</span> <span class=\"token number\">12</span>:54:43 <span class=\"token number\">2021</span> from <span class=\"token number\">10.0</span>.1.7\ndebian@freston:~$ </code></pre></div>\n<p>DMZ</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">nft <span class=\"token function\">add</span> rule inet filter output <span class=\"token function\">ip</span> daddr <span class=\"token number\">10.0</span>.2.0/24 oifname <span class=\"token string\">\"eth2\"</span> tcp dport <span class=\"token number\">22</span> ct state new,established counter accept\nnft <span class=\"token function\">add</span> rule inet filter input <span class=\"token function\">ip</span> saddr <span class=\"token number\">10.0</span>.2.0/24 iifname <span class=\"token string\">\"eth2\"</span> tcp sport <span class=\"token number\">22</span> ct state established counter accept</code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">root@dulcinea:/home/debian<span class=\"token comment\"># ssh centos@quijote</span>\nWarning: the ECDSA <span class=\"token function\">host</span> key <span class=\"token keyword\">for</span> <span class=\"token string\">'quijote'</span> differs from the key <span class=\"token keyword\">for</span> the IP address <span class=\"token string\">'10.0.2.4'</span>\nOffending key <span class=\"token keyword\">for</span> <span class=\"token for-or-select variable\">IP</span> <span class=\"token keyword\">in</span> /root/.ssh/known_hosts:5\nMatching <span class=\"token function\">host</span> key <span class=\"token keyword\">in</span> /root/.ssh/known_hosts:7\nAre you sure you want to <span class=\"token builtin class-name\">continue</span> connecting <span class=\"token punctuation\">(</span>yes/no<span class=\"token punctuation\">)</span>? <span class=\"token function\">yes</span>\ncentos@quijote's password: \nLast login: Tue May <span class=\"token number\">11</span> <span class=\"token number\">12</span>:45:35 <span class=\"token number\">2021</span> from <span class=\"token number\">10.0</span>.2.6\n<span class=\"token punctuation\">[</span>centos@quijote ~<span class=\"token punctuation\">]</span>$ </code></pre></div>\n<p>Dulcinea</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\"><span class=\"token comment\">#desde la red del gonzalonazareno</span>\nnft <span class=\"token function\">add</span> rule inet filter input <span class=\"token function\">ip</span> saddr <span class=\"token number\">172.22</span>.0.0/16 iifname <span class=\"token string\">\"eth0\"</span> tcp dport <span class=\"token number\">22</span> ct state new,established counter accept\nnft <span class=\"token function\">add</span> rule inet filter output <span class=\"token function\">ip</span> daddr <span class=\"token number\">172.22</span>.0.0/16 oifname <span class=\"token string\">\"eth0\"</span> tcp sport <span class=\"token number\">22</span> ct state established counter accept\n\n<span class=\"token comment\">#desde la vpn externa novnc</span>\nroot@dulcinea:/home/debian<span class=\"token comment\"># nft add rule inet filter input ip saddr 172.29.0.0/16 iifname \"eth0\" tcp dport 22 ct state new,established counter accept</span>\nroot@dulcinea:/home/debian<span class=\"token comment\"># nft add rule inet filter output ip daddr 172.29.0.0/16 oifname \"eth0\" tcp sport 22 ct state established counter accept</span></code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">root@debian:/home/fran<span class=\"token comment\"># ssh debian@dulcinea</span>\nLinux dulcinea.madu.gonzalonazareno.org <span class=\"token number\">4.19</span>.0-14-cloud-amd64 <span class=\"token comment\">#1 SMP Debian 4.19.171-2 (2021-01-30) x86_64</span>\n\nThe programs included with the Debian GNU/Linux system are <span class=\"token function\">free</span> software<span class=\"token punctuation\">;</span>\nthe exact distribution terms <span class=\"token keyword\">for</span> each program are described <span class=\"token keyword\">in</span> the\nindividual files <span class=\"token keyword\">in</span> /usr/share/doc/*/copyright.\n\nDebian GNU/Linux comes with ABSOLUTELY NO WARRANTY, to the extent\npermitted by applicable law.\nLast login: Tue May <span class=\"token number\">11</span> <span class=\"token number\">12</span>:38:55 <span class=\"token number\">2021</span> from <span class=\"token number\">172.22</span>.8.117\ndebian@dulcinea:~$ </code></pre></div>\n<ul>\n<li><strong>Todas las máquinas pueden hacer ssh a máquinas del exterior.</strong></li>\n</ul>\n<p>LAN</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">nft <span class=\"token function\">add</span> rule inet filter forward <span class=\"token function\">ip</span> saddr <span class=\"token number\">10.0</span>.1.0/24 iifname <span class=\"token string\">\"eth1\"</span> oifname <span class=\"token string\">\"eth0\"</span> tcp dport <span class=\"token number\">22</span> ct state new,established counter accept\nnft <span class=\"token function\">add</span> rule inet filter forward <span class=\"token function\">ip</span> daddr <span class=\"token number\">10.0</span>.1.0/24 iifname <span class=\"token string\">\"eth0\"</span> oifname <span class=\"token string\">\"eth1\"</span> tcp sport <span class=\"token number\">22</span> ct state established counter accept</code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">debian@freston:~$ <span class=\"token function\">ssh</span> debian@51.178.19.140\ndebian@51.178.19.140: Permission denied <span class=\"token punctuation\">(</span>publickey<span class=\"token punctuation\">)</span>.</code></pre></div>\n<p>DMZ</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">nft <span class=\"token function\">add</span> rule inet filter forward <span class=\"token function\">ip</span> saddr <span class=\"token number\">10.0</span>.2.0/24 iifname <span class=\"token string\">\"eth2\"</span> oifname <span class=\"token string\">\"eth0\"</span> tcp dport <span class=\"token number\">22</span> ct state new,established counter accept\nnft <span class=\"token function\">add</span> rule inet filter forward <span class=\"token function\">ip</span> daddr <span class=\"token number\">10.0</span>.2.0/24 iifname <span class=\"token string\">\"eth0\"</span> oifname <span class=\"token string\">\"eth2\"</span> tcp sport <span class=\"token number\">22</span> ct state established counter accept</code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\"><span class=\"token punctuation\">[</span>centos@quijote ~<span class=\"token punctuation\">]</span>$ <span class=\"token function\">ssh</span> debian@51.178.19.140\ndebian@51.178.19.140: Permission denied <span class=\"token punctuation\">(</span>publickey<span class=\"token punctuation\">)</span>.</code></pre></div>\n<ul>\n<li><strong>La máquina dulcinea tiene un servidor ssh escuchando por el puerto 22, pero al acceder desde el exterior habrá que conectar al puerto 2222.</strong></li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">nft <span class=\"token function\">add</span> rule inet filter output oifname <span class=\"token string\">\"eth0\"</span> tcp dport <span class=\"token number\">22</span> ct state new,established counter accept\nnft <span class=\"token function\">add</span> rule inet filter input iifname <span class=\"token string\">\"eth0\"</span> tcp sport <span class=\"token number\">22</span> ct state established counter accept</code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">root@dulcinea:~<span class=\"token comment\"># ssh debian@51.178.19.140</span>\nLinux vps <span class=\"token number\">4.19</span>.0-13-cloud-amd64 <span class=\"token comment\">#1 SMP Debian 4.19.160-2 (2021-04-12) x86_64</span>\n\n\nThe programs included with the Debian GNU/Linux system are <span class=\"token function\">free</span> software<span class=\"token punctuation\">;</span>\nthe exact distribution terms <span class=\"token keyword\">for</span> each program are described <span class=\"token keyword\">in</span> the\nindividual files <span class=\"token keyword\">in</span> /usr/share/doc/*/copyright.\n\nDebian GNU/Linux comes with ABSOLUTELY NO WARRANTY, to the extent\npermitted by applicable law.\nNo mail.\nLast login: Mon Apr <span class=\"token number\">12</span> <span class=\"token number\">11</span>:52:17 <span class=\"token number\">2021</span> from <span class=\"token number\">80.59</span>.1.152</code></pre></div>\n<h3 id=\"dns\"><a href=\"#dns\" aria-label=\"dns permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>DNS</h3>\n<ul>\n<li><strong>El único dns que pueden usar los equipos de las dos redes es freston, no pueden utilizar un DNS externo.</strong></li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">nft <span class=\"token function\">add</span> rule inet filter forward <span class=\"token function\">ip</span> saddr <span class=\"token number\">10.0</span>.2.0/24 iifname <span class=\"token string\">\"eth2\"</span> <span class=\"token function\">ip</span> daddr <span class=\"token number\">10.0</span>.1.3 oifname <span class=\"token string\">\"eth1\"</span> udp dport <span class=\"token number\">53</span> ct state new,established counter accept\nnft <span class=\"token function\">add</span> rule inet filter forward <span class=\"token function\">ip</span> daddr <span class=\"token number\">10.0</span>.2.0/24 iifname <span class=\"token string\">\"eth1\"</span> <span class=\"token function\">ip</span> saddr <span class=\"token number\">10.0</span>.1.3 oifname <span class=\"token string\">\"eth2\"</span> udp sport <span class=\"token number\">53</span> ct state established counter accept</code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">ubuntu@sancho:~$ <span class=\"token function\">dig</span> www.madu.gonzalonazareno.org\n\n<span class=\"token punctuation\">;</span> <span class=\"token operator\">&lt;&lt;</span><span class=\"token operator\">>></span> DiG <span class=\"token number\">9.16</span>.1-Ubuntu <span class=\"token operator\">&lt;&lt;</span><span class=\"token operator\">>></span> www.madu.gonzalonazareno.org\n<span class=\"token punctuation\">;</span><span class=\"token punctuation\">;</span> global options: +cmd\n<span class=\"token punctuation\">;</span><span class=\"token punctuation\">;</span> Got answer:\n<span class=\"token punctuation\">;</span><span class=\"token punctuation\">;</span> -<span class=\"token operator\">>></span>HEADER<span class=\"token operator\">&lt;&lt;-</span> opcode: QUERY, status: NOERROR, id: <span class=\"token number\">31355</span>\n<span class=\"token punctuation\">;</span><span class=\"token punctuation\">;</span> flags: qr rd ra<span class=\"token punctuation\">;</span> QUERY: <span class=\"token number\">1</span>, ANSWER: <span class=\"token number\">2</span>, AUTHORITY: <span class=\"token number\">0</span>, ADDITIONAL: <span class=\"token number\">1</span>\n\n<span class=\"token punctuation\">;</span><span class=\"token punctuation\">;</span> OPT PSEUDOSECTION:\n<span class=\"token punctuation\">;</span> EDNS: version: <span class=\"token number\">0</span>, flags:<span class=\"token punctuation\">;</span> udp: <span class=\"token number\">65494</span>\n<span class=\"token punctuation\">;</span><span class=\"token punctuation\">;</span> QUESTION SECTION:\n<span class=\"token punctuation\">;</span>www.madu.gonzalonazareno.org.\tIN\tA\n\n<span class=\"token punctuation\">;</span><span class=\"token punctuation\">;</span> ANSWER SECTION:\nwww.madu.gonzalonazareno.org. <span class=\"token number\">86400</span> IN\tCNAME\tdulcinea.madu.gonzalonazareno.org.\ndulcinea.madu.gonzalonazareno.org. <span class=\"token number\">7199</span>\tIN A\t<span class=\"token number\">172.22</span>.201.38\n\n<span class=\"token punctuation\">;</span><span class=\"token punctuation\">;</span> Query time: <span class=\"token number\">19</span> msec\n<span class=\"token punctuation\">;</span><span class=\"token punctuation\">;</span> SERVER: <span class=\"token number\">127.0</span>.0.53<span class=\"token comment\">#53(127.0.0.53)</span>\n<span class=\"token punctuation\">;</span><span class=\"token punctuation\">;</span> WHEN: Wed May <span class=\"token number\">12</span> <span class=\"token number\">20</span>:04:29 CEST <span class=\"token number\">2021</span>\n<span class=\"token punctuation\">;</span><span class=\"token punctuation\">;</span> MSG SIZE  rcvd: <span class=\"token number\">96</span></code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">ubuntu@sancho:~$ <span class=\"token function\">dig</span> @8.8.8.8 google.es\n\n<span class=\"token punctuation\">;</span> <span class=\"token operator\">&lt;&lt;</span><span class=\"token operator\">>></span> DiG <span class=\"token number\">9.16</span>.1-Ubuntu <span class=\"token operator\">&lt;&lt;</span><span class=\"token operator\">>></span> @8.8.8.8 google.es\n<span class=\"token punctuation\">;</span> <span class=\"token punctuation\">(</span><span class=\"token number\">1</span> server found<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">;</span><span class=\"token punctuation\">;</span> global options: +cmd\n<span class=\"token punctuation\">;</span><span class=\"token punctuation\">;</span> Got answer:\n<span class=\"token punctuation\">;</span><span class=\"token punctuation\">;</span> -<span class=\"token operator\">>></span>HEADER<span class=\"token operator\">&lt;&lt;-</span> opcode: QUERY, status: NOERROR, id: <span class=\"token number\">37197</span>\n<span class=\"token punctuation\">;</span><span class=\"token punctuation\">;</span> flags: qr rd ra<span class=\"token punctuation\">;</span> QUERY: <span class=\"token number\">1</span>, ANSWER: <span class=\"token number\">1</span>, AUTHORITY: <span class=\"token number\">0</span>, ADDITIONAL: <span class=\"token number\">1</span>\n\n<span class=\"token punctuation\">;</span><span class=\"token punctuation\">;</span> OPT PSEUDOSECTION:\n<span class=\"token punctuation\">;</span> EDNS: version: <span class=\"token number\">0</span>, flags:<span class=\"token punctuation\">;</span> udp: <span class=\"token number\">512</span>\n<span class=\"token punctuation\">;</span><span class=\"token punctuation\">;</span> QUESTION SECTION:\n<span class=\"token punctuation\">;</span>google.es.\t\t\tIN\tA\n\n<span class=\"token punctuation\">;</span><span class=\"token punctuation\">;</span> ANSWER SECTION:\ngoogle.es.\t\t<span class=\"token number\">299</span>\tIN\tA\t<span class=\"token number\">142.250</span>.184.3\n\n<span class=\"token punctuation\">;</span><span class=\"token punctuation\">;</span> Query time: <span class=\"token number\">63</span> msec\n<span class=\"token punctuation\">;</span><span class=\"token punctuation\">;</span> SERVER: <span class=\"token number\">8.8</span>.8.8<span class=\"token comment\">#53(8.8.8.8)</span>\n<span class=\"token punctuation\">;</span><span class=\"token punctuation\">;</span> WHEN: Wed May <span class=\"token number\">12</span> <span class=\"token number\">20</span>:05:41 CEST <span class=\"token number\">2021</span>\n<span class=\"token punctuation\">;</span><span class=\"token punctuation\">;</span> MSG SIZE  rcvd: <span class=\"token number\">54</span></code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\"><span class=\"token punctuation\">[</span>centos@quijote ~<span class=\"token punctuation\">]</span>$ <span class=\"token function\">dig</span> www.madu.gonzalonazareno.org\n\n<span class=\"token punctuation\">;</span> <span class=\"token operator\">&lt;&lt;</span><span class=\"token operator\">>></span> DiG <span class=\"token number\">9.11</span>.20-RedHat-9.11.20-5.el8_3.1 <span class=\"token operator\">&lt;&lt;</span><span class=\"token operator\">>></span> www.madu.gonzalonazareno.org\n<span class=\"token punctuation\">;</span><span class=\"token punctuation\">;</span> global options: +cmd\n<span class=\"token punctuation\">;</span><span class=\"token punctuation\">;</span> Got answer:\n<span class=\"token punctuation\">;</span><span class=\"token punctuation\">;</span> -<span class=\"token operator\">>></span>HEADER<span class=\"token operator\">&lt;&lt;-</span> opcode: QUERY, status: NOERROR, id: <span class=\"token number\">31612</span>\n<span class=\"token punctuation\">;</span><span class=\"token punctuation\">;</span> flags: qr aa rd ra<span class=\"token punctuation\">;</span> QUERY: <span class=\"token number\">1</span>, ANSWER: <span class=\"token number\">2</span>, AUTHORITY: <span class=\"token number\">1</span>, ADDITIONAL: <span class=\"token number\">2</span>\n\n<span class=\"token punctuation\">;</span><span class=\"token punctuation\">;</span> OPT PSEUDOSECTION:\n<span class=\"token punctuation\">;</span> EDNS: version: <span class=\"token number\">0</span>, flags:<span class=\"token punctuation\">;</span> udp: <span class=\"token number\">4096</span>\n<span class=\"token punctuation\">;</span> COOKIE: 0dfd2e1745f99938bcb05bd7609c192ae655908279420efe <span class=\"token punctuation\">(</span>good<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">;</span><span class=\"token punctuation\">;</span> QUESTION SECTION:\n<span class=\"token punctuation\">;</span>www.madu.gonzalonazareno.org.\tIN\tA\n\n<span class=\"token punctuation\">;</span><span class=\"token punctuation\">;</span> ANSWER SECTION:\nwww.madu.gonzalonazareno.org. <span class=\"token number\">86400</span> IN\tCNAME\tquijote.madu.gonzalonazareno.org.\nquijote.madu.gonzalonazareno.org. <span class=\"token number\">86400</span>\tIN A\t<span class=\"token number\">10.0</span>.2.4\n\n<span class=\"token punctuation\">;</span><span class=\"token punctuation\">;</span> AUTHORITY SECTION:\nmadu.gonzalonazareno.org. <span class=\"token number\">86400</span>\tIN\tNS\tfreston.madu.gonzalonazareno.org.\n\n<span class=\"token punctuation\">;</span><span class=\"token punctuation\">;</span> ADDITIONAL SECTION:\nfreston.madu.gonzalonazareno.org. <span class=\"token number\">86400</span>\tIN A\t<span class=\"token number\">10.0</span>.1.3\n\n<span class=\"token punctuation\">;</span><span class=\"token punctuation\">;</span> Query time: <span class=\"token number\">2</span> msec\n<span class=\"token punctuation\">;</span><span class=\"token punctuation\">;</span> SERVER: <span class=\"token number\">10.0</span>.1.3<span class=\"token comment\">#53(10.0.1.3)</span>\n<span class=\"token punctuation\">;</span><span class=\"token punctuation\">;</span> WHEN: Wed May <span class=\"token number\">12</span> <span class=\"token number\">20</span>:06:34 CEST <span class=\"token number\">2021</span>\n<span class=\"token punctuation\">;</span><span class=\"token punctuation\">;</span> MSG SIZE  rcvd: <span class=\"token number\">161</span></code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\"><span class=\"token punctuation\">[</span>centos@quijote ~<span class=\"token punctuation\">]</span>$ <span class=\"token function\">dig</span> @8.8.8.8 google.es\n\n<span class=\"token punctuation\">;</span> <span class=\"token operator\">&lt;&lt;</span><span class=\"token operator\">>></span> DiG <span class=\"token number\">9.11</span>.20-RedHat-9.11.20-5.el8_3.1 <span class=\"token operator\">&lt;&lt;</span><span class=\"token operator\">>></span> @8.8.8.8 google.es\n<span class=\"token punctuation\">;</span> <span class=\"token punctuation\">(</span><span class=\"token number\">1</span> server found<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">;</span><span class=\"token punctuation\">;</span> global options: +cmd\n<span class=\"token punctuation\">;</span><span class=\"token punctuation\">;</span> Got answer:\n<span class=\"token punctuation\">;</span><span class=\"token punctuation\">;</span> -<span class=\"token operator\">>></span>HEADER<span class=\"token operator\">&lt;&lt;-</span> opcode: QUERY, status: NOERROR, id: <span class=\"token number\">39036</span>\n<span class=\"token punctuation\">;</span><span class=\"token punctuation\">;</span> flags: qr rd ra<span class=\"token punctuation\">;</span> QUERY: <span class=\"token number\">1</span>, ANSWER: <span class=\"token number\">1</span>, AUTHORITY: <span class=\"token number\">0</span>, ADDITIONAL: <span class=\"token number\">1</span>\n\n<span class=\"token punctuation\">;</span><span class=\"token punctuation\">;</span> OPT PSEUDOSECTION:\n<span class=\"token punctuation\">;</span> EDNS: version: <span class=\"token number\">0</span>, flags:<span class=\"token punctuation\">;</span> udp: <span class=\"token number\">512</span>\n<span class=\"token punctuation\">;</span><span class=\"token punctuation\">;</span> QUESTION SECTION:\n<span class=\"token punctuation\">;</span>google.es.\t\t\tIN\tA\n\n<span class=\"token punctuation\">;</span><span class=\"token punctuation\">;</span> ANSWER SECTION:\ngoogle.es.\t\t<span class=\"token number\">299</span>\tIN\tA\t<span class=\"token number\">142.250</span>.184.3\n\n<span class=\"token punctuation\">;</span><span class=\"token punctuation\">;</span> Query time: <span class=\"token number\">63</span> msec\n<span class=\"token punctuation\">;</span><span class=\"token punctuation\">;</span> SERVER: <span class=\"token number\">8.8</span>.8.8<span class=\"token comment\">#53(8.8.8.8)</span>\n<span class=\"token punctuation\">;</span><span class=\"token punctuation\">;</span> WHEN: Wed May <span class=\"token number\">12</span> <span class=\"token number\">20</span>:07:05 CEST <span class=\"token number\">2021</span>\n<span class=\"token punctuation\">;</span><span class=\"token punctuation\">;</span> MSG SIZE  rcvd: <span class=\"token number\">54</span></code></pre></div>\n<ul>\n<li><strong>dulcinea puede usar cualquier servidor DNS.</strong></li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">nft <span class=\"token function\">add</span> rule inet filter output udp dport <span class=\"token number\">53</span> ct state new,established counter accept\nnft <span class=\"token function\">add</span> rule inet filter input udp sport <span class=\"token number\">53</span> ct state established counter accept</code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">root@dulcinea:/home/debian<span class=\"token comment\"># dig www.madu.gonzalonazareno.org</span>\n\n<span class=\"token punctuation\">;</span> <span class=\"token operator\">&lt;&lt;</span><span class=\"token operator\">>></span> DiG <span class=\"token number\">9.11</span>.5-P4-5.1+deb10u2-Debian <span class=\"token operator\">&lt;&lt;</span><span class=\"token operator\">>></span> www.madu.gonzalonazareno.org\n<span class=\"token punctuation\">;</span><span class=\"token punctuation\">;</span> global options: +cmd\n<span class=\"token punctuation\">;</span><span class=\"token punctuation\">;</span> Got answer:\n<span class=\"token punctuation\">;</span><span class=\"token punctuation\">;</span> -<span class=\"token operator\">>></span>HEADER<span class=\"token operator\">&lt;&lt;-</span> opcode: QUERY, status: NOERROR, id: <span class=\"token number\">45022</span>\n<span class=\"token punctuation\">;</span><span class=\"token punctuation\">;</span> flags: qr aa rd ra<span class=\"token punctuation\">;</span> QUERY: <span class=\"token number\">1</span>, ANSWER: <span class=\"token number\">2</span>, AUTHORITY: <span class=\"token number\">1</span>, ADDITIONAL: <span class=\"token number\">2</span>\n\n<span class=\"token punctuation\">;</span><span class=\"token punctuation\">;</span> OPT PSEUDOSECTION:\n<span class=\"token punctuation\">;</span> EDNS: version: <span class=\"token number\">0</span>, flags:<span class=\"token punctuation\">;</span> udp: <span class=\"token number\">4096</span>\n<span class=\"token punctuation\">;</span> COOKIE: 2a480766e04960533183ecab609c1993a9373a4102fd1371 <span class=\"token punctuation\">(</span>good<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">;</span><span class=\"token punctuation\">;</span> QUESTION SECTION:\n<span class=\"token punctuation\">;</span>www.madu.gonzalonazareno.org.\tIN\tA\n\n<span class=\"token punctuation\">;</span><span class=\"token punctuation\">;</span> ANSWER SECTION:\nwww.madu.gonzalonazareno.org. <span class=\"token number\">86400</span> IN\tCNAME\tquijote.madu.gonzalonazareno.org.\nquijote.madu.gonzalonazareno.org. <span class=\"token number\">86400</span>\tIN A\t<span class=\"token number\">10.0</span>.2.4\n\n<span class=\"token punctuation\">;</span><span class=\"token punctuation\">;</span> AUTHORITY SECTION:\nmadu.gonzalonazareno.org. <span class=\"token number\">86400</span>\tIN\tNS\tfreston.madu.gonzalonazareno.org.\n\n<span class=\"token punctuation\">;</span><span class=\"token punctuation\">;</span> ADDITIONAL SECTION:\nfreston.madu.gonzalonazareno.org. <span class=\"token number\">86400</span>\tIN A\t<span class=\"token number\">10.0</span>.1.3\n\n<span class=\"token punctuation\">;</span><span class=\"token punctuation\">;</span> Query time: <span class=\"token number\">1</span> msec\n<span class=\"token punctuation\">;</span><span class=\"token punctuation\">;</span> SERVER: <span class=\"token number\">10.0</span>.1.3<span class=\"token comment\">#53(10.0.1.3)</span>\n<span class=\"token punctuation\">;</span><span class=\"token punctuation\">;</span> WHEN: Wed May <span class=\"token number\">12</span> <span class=\"token number\">20</span>:08:19 CEST <span class=\"token number\">2021</span>\n<span class=\"token punctuation\">;</span><span class=\"token punctuation\">;</span> MSG SIZE  rcvd: <span class=\"token number\">161</span>\n\nroot@dulcinea:/home/debian<span class=\"token comment\"># dig @8.8.8.8 google.es</span>\n\n<span class=\"token punctuation\">;</span> <span class=\"token operator\">&lt;&lt;</span><span class=\"token operator\">>></span> DiG <span class=\"token number\">9.11</span>.5-P4-5.1+deb10u2-Debian <span class=\"token operator\">&lt;&lt;</span><span class=\"token operator\">>></span> @8.8.8.8 google.es\n<span class=\"token punctuation\">;</span> <span class=\"token punctuation\">(</span><span class=\"token number\">1</span> server found<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">;</span><span class=\"token punctuation\">;</span> global options: +cmd\n<span class=\"token punctuation\">;</span><span class=\"token punctuation\">;</span> Got answer:\n<span class=\"token punctuation\">;</span><span class=\"token punctuation\">;</span> -<span class=\"token operator\">>></span>HEADER<span class=\"token operator\">&lt;&lt;-</span> opcode: QUERY, status: NOERROR, id: <span class=\"token number\">6506</span>\n<span class=\"token punctuation\">;</span><span class=\"token punctuation\">;</span> flags: qr rd ra<span class=\"token punctuation\">;</span> QUERY: <span class=\"token number\">1</span>, ANSWER: <span class=\"token number\">1</span>, AUTHORITY: <span class=\"token number\">0</span>, ADDITIONAL: <span class=\"token number\">1</span>\n\n<span class=\"token punctuation\">;</span><span class=\"token punctuation\">;</span> OPT PSEUDOSECTION:\n<span class=\"token punctuation\">;</span> EDNS: version: <span class=\"token number\">0</span>, flags:<span class=\"token punctuation\">;</span> udp: <span class=\"token number\">512</span>\n<span class=\"token punctuation\">;</span><span class=\"token punctuation\">;</span> QUESTION SECTION:\n<span class=\"token punctuation\">;</span>google.es.\t\t\tIN\tA\n\n<span class=\"token punctuation\">;</span><span class=\"token punctuation\">;</span> ANSWER SECTION:\ngoogle.es.\t\t<span class=\"token number\">215</span>\tIN\tA\t<span class=\"token number\">142.250</span>.184.3\n\n<span class=\"token punctuation\">;</span><span class=\"token punctuation\">;</span> Query time: <span class=\"token number\">239</span> msec\n<span class=\"token punctuation\">;</span><span class=\"token punctuation\">;</span> SERVER: <span class=\"token number\">8.8</span>.8.8<span class=\"token comment\">#53(8.8.8.8)</span>\n<span class=\"token punctuation\">;</span><span class=\"token punctuation\">;</span> WHEN: Wed May <span class=\"token number\">12</span> <span class=\"token number\">20</span>:08:29 CEST <span class=\"token number\">2021</span>\n<span class=\"token punctuation\">;</span><span class=\"token punctuation\">;</span> MSG SIZE  rcvd: <span class=\"token number\">54</span></code></pre></div>\n<ul>\n<li><strong>Tenemos que permitir consultas dns desde el exterior a freston, para que, por ejemplo, papion-dns pueda preguntar.</strong></li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">nft <span class=\"token function\">add</span> rule inet filter forward <span class=\"token function\">ip</span> daddr <span class=\"token number\">10.0</span>.1.3 iifname <span class=\"token string\">\"eth0\"</span> oifname <span class=\"token string\">\"eth1\"</span> udp dport <span class=\"token number\">53</span> ct state new,established counter accept\nnft <span class=\"token function\">add</span> rule inet filter forward <span class=\"token function\">ip</span> saddr <span class=\"token number\">10.0</span>.1.3 iifname <span class=\"token string\">\"eth1\"</span> oifname <span class=\"token string\">\"eth0\"</span> udp sport <span class=\"token number\">53</span> ct state established counter accept</code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">hacer en el instituto\n\nfran@debian:~$ <span class=\"token function\">dig</span> www.madu.gonzalonazareno.org\n\n<span class=\"token punctuation\">;</span> <span class=\"token operator\">&lt;&lt;</span><span class=\"token operator\">>></span> DiG <span class=\"token number\">9.11</span>.5-P4-5.1+deb10u5-Debian <span class=\"token operator\">&lt;&lt;</span><span class=\"token operator\">>></span> www.madu.gonzalonazareno.org\n<span class=\"token punctuation\">;</span><span class=\"token punctuation\">;</span> global options: +cmd\n<span class=\"token punctuation\">;</span><span class=\"token punctuation\">;</span> Got answer:\n<span class=\"token punctuation\">;</span><span class=\"token punctuation\">;</span> -<span class=\"token operator\">>></span>HEADER<span class=\"token operator\">&lt;&lt;-</span> opcode: QUERY, status: NOERROR, id: <span class=\"token number\">9641</span>\n<span class=\"token punctuation\">;</span><span class=\"token punctuation\">;</span> flags: qr rd ra<span class=\"token punctuation\">;</span> QUERY: <span class=\"token number\">1</span>, ANSWER: <span class=\"token number\">2</span>, AUTHORITY: <span class=\"token number\">0</span>, ADDITIONAL: <span class=\"token number\">1</span>\n\n<span class=\"token punctuation\">;</span><span class=\"token punctuation\">;</span> OPT PSEUDOSECTION:\n<span class=\"token punctuation\">;</span> EDNS: version: <span class=\"token number\">0</span>, flags:<span class=\"token punctuation\">;</span> udp: <span class=\"token number\">512</span>\n<span class=\"token punctuation\">;</span><span class=\"token punctuation\">;</span> QUESTION SECTION:\n<span class=\"token punctuation\">;</span>www.madu.gonzalonazareno.org.\tIN\tA\n\n<span class=\"token punctuation\">;</span><span class=\"token punctuation\">;</span> ANSWER SECTION:\nwww.madu.gonzalonazareno.org. <span class=\"token number\">900</span> IN\tCNAME\tmacaco.gonzalonazareno.org.\nmacaco.gonzalonazareno.org. <span class=\"token number\">900</span>\tIN\tA\t<span class=\"token number\">80.59</span>.1.152\n\n<span class=\"token punctuation\">;</span><span class=\"token punctuation\">;</span> Query time: <span class=\"token number\">237</span> msec\n<span class=\"token punctuation\">;</span><span class=\"token punctuation\">;</span> SERVER: <span class=\"token number\">192.168</span>.2.1<span class=\"token comment\">#53(192.168.2.1)</span>\n<span class=\"token punctuation\">;</span><span class=\"token punctuation\">;</span> WHEN: mié may <span class=\"token number\">12</span> <span class=\"token number\">20</span>:09:34 CEST <span class=\"token number\">2021</span>\n<span class=\"token punctuation\">;</span><span class=\"token punctuation\">;</span> MSG SIZE  rcvd: <span class=\"token number\">94</span></code></pre></div>\n<ul>\n<li><strong>Tenemos que permitir consultas DNS al exterior a Freston, para que pueda hacer las preguntas recursivas.</strong></li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">nft <span class=\"token function\">add</span> rule inet filter forward <span class=\"token function\">ip</span> saddr <span class=\"token number\">10.0</span>.1.3 iifname <span class=\"token string\">\"eth1\"</span> oifname <span class=\"token string\">\"eth0\"</span> udp dport <span class=\"token number\">53</span> ct state new,established counter accept\nnft <span class=\"token function\">add</span> rule inet filter forward <span class=\"token function\">ip</span> daddr <span class=\"token number\">10.0</span>.1.3 iifname <span class=\"token string\">\"eth0\"</span> oifname <span class=\"token string\">\"eth1\"</span> udp sport <span class=\"token number\">53</span> ct state established counter accept\n\nnft <span class=\"token function\">add</span> rule inet filter forward <span class=\"token function\">ip</span> saddr <span class=\"token number\">10.0</span>.1.3 iifname <span class=\"token string\">\"eth1\"</span> oifname <span class=\"token string\">\"eth0\"</span> tcp dport <span class=\"token number\">53</span> ct state new,established counter accept\nnft <span class=\"token function\">add</span> rule inet filter forward <span class=\"token function\">ip</span> daddr <span class=\"token number\">10.0</span>.1.3 iifname <span class=\"token string\">\"eth0\"</span> oifname <span class=\"token string\">\"eth1\"</span> tcp sport <span class=\"token number\">53</span> ct state established counter accept</code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\"><span class=\"token punctuation\">[</span>centos@quijote ~<span class=\"token punctuation\">]</span>$ <span class=\"token function\">dig</span> www.wikipedia.es\n\n<span class=\"token punctuation\">;</span> <span class=\"token operator\">&lt;&lt;</span><span class=\"token operator\">>></span> DiG <span class=\"token number\">9.11</span>.20-RedHat-9.11.20-5.el8_3.1 <span class=\"token operator\">&lt;&lt;</span><span class=\"token operator\">>></span> www.wikipedia.es\n<span class=\"token punctuation\">;</span><span class=\"token punctuation\">;</span> global options: +cmd\n<span class=\"token punctuation\">;</span><span class=\"token punctuation\">;</span> Got answer:\n<span class=\"token punctuation\">;</span><span class=\"token punctuation\">;</span> -<span class=\"token operator\">>></span>HEADER<span class=\"token operator\">&lt;&lt;-</span> opcode: QUERY, status: NOERROR, id: <span class=\"token number\">36057</span>\n<span class=\"token punctuation\">;</span><span class=\"token punctuation\">;</span> flags: qr rd ra<span class=\"token punctuation\">;</span> QUERY: <span class=\"token number\">1</span>, ANSWER: <span class=\"token number\">2</span>, AUTHORITY: <span class=\"token number\">3</span>, ADDITIONAL: <span class=\"token number\">4</span>\n\n<span class=\"token punctuation\">;</span><span class=\"token punctuation\">;</span> OPT PSEUDOSECTION:\n<span class=\"token punctuation\">;</span> EDNS: version: <span class=\"token number\">0</span>, flags:<span class=\"token punctuation\">;</span> udp: <span class=\"token number\">4096</span>\n<span class=\"token punctuation\">;</span> COOKIE: 250ad09337f424f198924d8b609c1a392f89033a0c6dda0f <span class=\"token punctuation\">(</span>good<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">;</span><span class=\"token punctuation\">;</span> QUESTION SECTION:\n<span class=\"token punctuation\">;</span>www.wikipedia.es.\t\tIN\tA\n\n<span class=\"token punctuation\">;</span><span class=\"token punctuation\">;</span> ANSWER SECTION:\nwww.wikipedia.es.\t<span class=\"token number\">86400</span>\tIN\tCNAME\tncredir-lb.wikimedia.org.\nncredir-lb.wikimedia.org. <span class=\"token number\">600</span>\tIN\tA\t<span class=\"token number\">91.198</span>.174.194\n\n<span class=\"token punctuation\">;</span><span class=\"token punctuation\">;</span> AUTHORITY SECTION:\nwikimedia.org.\t\t<span class=\"token number\">45873</span>\tIN\tNS\tns1.wikimedia.org.\nwikimedia.org.\t\t<span class=\"token number\">45873</span>\tIN\tNS\tns2.wikimedia.org.\nwikimedia.org.\t\t<span class=\"token number\">45873</span>\tIN\tNS\tns0.wikimedia.org.\n\n<span class=\"token punctuation\">;</span><span class=\"token punctuation\">;</span> ADDITIONAL SECTION:\nns0.wikimedia.org.\t<span class=\"token number\">45872</span>\tIN\tA\t<span class=\"token number\">208.80</span>.154.238\nns1.wikimedia.org.\t<span class=\"token number\">45872</span>\tIN\tA\t<span class=\"token number\">208.80</span>.153.231\nns2.wikimedia.org.\t<span class=\"token number\">45872</span>\tIN\tA\t<span class=\"token number\">91.198</span>.174.239\n\n<span class=\"token punctuation\">;</span><span class=\"token punctuation\">;</span> Query time: <span class=\"token number\">1120</span> msec\n<span class=\"token punctuation\">;</span><span class=\"token punctuation\">;</span> SERVER: <span class=\"token number\">192.168</span>.202.2<span class=\"token comment\">#53(192.168.202.2)</span>\n<span class=\"token punctuation\">;</span><span class=\"token punctuation\">;</span> WHEN: Wed May <span class=\"token number\">12</span> <span class=\"token number\">20</span>:11:05 CEST <span class=\"token number\">2021</span>\n<span class=\"token punctuation\">;</span><span class=\"token punctuation\">;</span> MSG SIZE  rcvd: <span class=\"token number\">229</span></code></pre></div>\n<h3 id=\"base-de-datos\"><a href=\"#base-de-datos\" aria-label=\"base de datos permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Base de datos</h3>\n<ul>\n<li><strong>A la base de datos de sancho sólo pueden acceder las máquinas de la DMZ y la LAN.</strong></li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">nft <span class=\"token function\">add</span> rule inet filter forward <span class=\"token function\">ip</span> saddr <span class=\"token number\">10.0</span>.2.0/24 iifname <span class=\"token string\">\"eth2\"</span> <span class=\"token function\">ip</span> daddr <span class=\"token number\">10.0</span>.1.10 oifname <span class=\"token string\">\"eth1\"</span> tcp dport <span class=\"token number\">3306</span> ct state new,established counter accept\nnft <span class=\"token function\">add</span> rule inet filter forward <span class=\"token function\">ip</span> daddr <span class=\"token number\">10.0</span>.2.0/24 iifname <span class=\"token string\">\"eth1\"</span> <span class=\"token function\">ip</span> saddr <span class=\"token number\">10.0</span>.1.10 oifname <span class=\"token string\">\"eth2\"</span> tcp sport <span class=\"token number\">3306</span> ct state established counter accept</code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\"><span class=\"token punctuation\">[</span>centos@quijote ~<span class=\"token punctuation\">]</span>$ mysql -u quijote -p -h bd.madu.gonzalonazareno.org\nEnter password: \nWelcome to the MariaDB monitor.  Commands end with <span class=\"token punctuation\">;</span> or <span class=\"token punctuation\">\\</span>g.\nYour MariaDB connection <span class=\"token function\">id</span> is <span class=\"token number\">309</span>\nServer version: <span class=\"token number\">10.3</span>.25-MariaDB-0ubuntu0.20.04.1 Ubuntu <span class=\"token number\">20.04</span>\n\nCopyright <span class=\"token punctuation\">(</span>c<span class=\"token punctuation\">)</span> <span class=\"token number\">2000</span>, <span class=\"token number\">2018</span>, Oracle, MariaDB Corporation Ab and others.\n\nType <span class=\"token string\">'help;'</span> or <span class=\"token string\">'\\h'</span> <span class=\"token keyword\">for</span> help. Type <span class=\"token string\">'<span class=\"token entity\" title=\"\\c\">\\c</span>'</span> to <span class=\"token function\">clear</span> the current input statement.\n\nMariaDB <span class=\"token punctuation\">[</span><span class=\"token punctuation\">(</span>none<span class=\"token punctuation\">)</span><span class=\"token punctuation\">]</span><span class=\"token operator\">></span> Ctrl-C -- exit<span class=\"token operator\">!</span>\nAborted</code></pre></div>\n<h3 id=\"web\"><a href=\"#web\" aria-label=\"web permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Web</h3>\n<ul>\n<li><strong>Las páginas web de quijote (80, 443) pueden ser accedidas desde todas las máquinas de nuestra red y desde el exterior.</strong></li>\n</ul>\n<p>LAN</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">nft <span class=\"token function\">add</span> rule inet filter forward <span class=\"token function\">ip</span> saddr <span class=\"token number\">10.0</span>.1.0/24 iifname <span class=\"token string\">\"eth1\"</span> <span class=\"token function\">ip</span> daddr <span class=\"token number\">10.0</span>.2.4 oifname <span class=\"token string\">\"eth2\"</span> tcp dport <span class=\"token number\">80</span> ct state new,established counter accept\nnft <span class=\"token function\">add</span> rule inet filter forward <span class=\"token function\">ip</span> daddr <span class=\"token number\">10.0</span>.1.0/24 iifname <span class=\"token string\">\"eth2\"</span> <span class=\"token function\">ip</span> saddr <span class=\"token number\">10.0</span>.2.4 oifname <span class=\"token string\">\"eth1\"</span> tcp sport <span class=\"token number\">80</span> ct state established counter accept\n\nnft <span class=\"token function\">add</span> rule inet filter forward <span class=\"token function\">ip</span> saddr <span class=\"token number\">10.0</span>.1.0/24 iifname <span class=\"token string\">\"eth1\"</span> <span class=\"token function\">ip</span> daddr <span class=\"token number\">10.0</span>.2.4 oifname <span class=\"token string\">\"eth2\"</span> tcp dport <span class=\"token number\">443</span> ct state new,established counter accept\nnft <span class=\"token function\">add</span> rule inet filter forward <span class=\"token function\">ip</span> daddr <span class=\"token number\">10.0</span>.1.0/24 iifname <span class=\"token string\">\"eth2\"</span> <span class=\"token function\">ip</span> saddr <span class=\"token number\">10.0</span>.2.4 oifname <span class=\"token string\">\"eth1\"</span> tcp sport <span class=\"token number\">443</span> ct state established counter accept</code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">debian@freston:~$ <span class=\"token function\">curl</span> http://www.madu.gonzalonazareno.org\n<span class=\"token operator\">&lt;</span><span class=\"token operator\">!</span>DOCTYPE HTML PUBLIC <span class=\"token string\">\"-//IETF//DTD HTML 2.0//EN\"</span><span class=\"token operator\">></span>\n<span class=\"token operator\">&lt;</span>html<span class=\"token operator\">></span><span class=\"token operator\">&lt;</span>head<span class=\"token operator\">></span>\n<span class=\"token operator\">&lt;</span>title<span class=\"token operator\">></span><span class=\"token number\">301</span> Moved Permanently<span class=\"token operator\">&lt;</span>/title<span class=\"token operator\">></span>\n<span class=\"token operator\">&lt;</span>/head<span class=\"token operator\">></span><span class=\"token operator\">&lt;</span>body<span class=\"token operator\">></span>\n<span class=\"token operator\">&lt;</span>h<span class=\"token operator\"><span class=\"token file-descriptor important\">1</span>></span>Moved Permanently<span class=\"token operator\">&lt;</span>/h<span class=\"token operator\"><span class=\"token file-descriptor important\">1</span>></span>\n<span class=\"token operator\">&lt;</span>p<span class=\"token operator\">></span>The document has moved <span class=\"token operator\">&lt;</span>a <span class=\"token assign-left variable\">href</span><span class=\"token operator\">=</span><span class=\"token string\">\"https://www.madu.gonzalonazareno.org/\"</span><span class=\"token operator\">></span>here<span class=\"token operator\">&lt;</span>/a<span class=\"token operator\">></span>.<span class=\"token operator\">&lt;</span>/p<span class=\"token operator\">></span>\n<span class=\"token operator\">&lt;</span>/body<span class=\"token operator\">></span><span class=\"token operator\">&lt;</span>/html<span class=\"token operator\">></span></code></pre></div>\n<p>DMZ</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\"><span class=\"token punctuation\">[</span>centos@quijote ~<span class=\"token punctuation\">]</span>$ <span class=\"token function\">curl</span> http://www.madu.gonzalonazareno.org\n<span class=\"token operator\">&lt;</span><span class=\"token operator\">!</span>DOCTYPE HTML PUBLIC <span class=\"token string\">\"-//IETF//DTD HTML 2.0//EN\"</span><span class=\"token operator\">></span>\n<span class=\"token operator\">&lt;</span>html<span class=\"token operator\">></span><span class=\"token operator\">&lt;</span>head<span class=\"token operator\">></span>\n<span class=\"token operator\">&lt;</span>title<span class=\"token operator\">></span><span class=\"token number\">301</span> Moved Permanently<span class=\"token operator\">&lt;</span>/title<span class=\"token operator\">></span>\n<span class=\"token operator\">&lt;</span>/head<span class=\"token operator\">></span><span class=\"token operator\">&lt;</span>body<span class=\"token operator\">></span>\n<span class=\"token operator\">&lt;</span>h<span class=\"token operator\"><span class=\"token file-descriptor important\">1</span>></span>Moved Permanently<span class=\"token operator\">&lt;</span>/h<span class=\"token operator\"><span class=\"token file-descriptor important\">1</span>></span>\n<span class=\"token operator\">&lt;</span>p<span class=\"token operator\">></span>The document has moved <span class=\"token operator\">&lt;</span>a <span class=\"token assign-left variable\">href</span><span class=\"token operator\">=</span><span class=\"token string\">\"https://www.madu.gonzalonazareno.org/\"</span><span class=\"token operator\">></span>here<span class=\"token operator\">&lt;</span>/a<span class=\"token operator\">></span>.<span class=\"token operator\">&lt;</span>/p<span class=\"token operator\">></span>\n<span class=\"token operator\">&lt;</span>/body<span class=\"token operator\">></span><span class=\"token operator\">&lt;</span>/html<span class=\"token operator\">></span></code></pre></div>\n<p>Dulcinea</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">nft <span class=\"token function\">add</span> rule inet filter output <span class=\"token function\">ip</span> daddr <span class=\"token number\">10.0</span>.2.4 oifname <span class=\"token string\">\"eth2\"</span> tcp dport <span class=\"token number\">80</span> ct state new,established counter accept\nnft <span class=\"token function\">add</span> rule inet filter input <span class=\"token function\">ip</span> saddr <span class=\"token number\">10.0</span>.2.4 iifname <span class=\"token string\">\"eth2\"</span> tcp sport <span class=\"token number\">80</span> ct state established counter accept\n\nnft <span class=\"token function\">add</span> rule inet filter output <span class=\"token function\">ip</span> daddr <span class=\"token number\">10.0</span>.2.4 oifname <span class=\"token string\">\"eth2\"</span> tcp dport <span class=\"token number\">443</span> ct state new,established counter accept\nnft <span class=\"token function\">add</span> rule inet filter input <span class=\"token function\">ip</span> saddr <span class=\"token number\">10.0</span>.2.4 iifname <span class=\"token string\">\"eth2\"</span> tcp sport <span class=\"token number\">443</span> ct state established counter accept</code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">root@dulcinea:/home/debian<span class=\"token comment\"># curl http://www.madu.gonzalonazareno.org</span>\n<span class=\"token operator\">&lt;</span><span class=\"token operator\">!</span>DOCTYPE HTML PUBLIC <span class=\"token string\">\"-//IETF//DTD HTML 2.0//EN\"</span><span class=\"token operator\">></span>\n<span class=\"token operator\">&lt;</span>html<span class=\"token operator\">></span><span class=\"token operator\">&lt;</span>head<span class=\"token operator\">></span>\n<span class=\"token operator\">&lt;</span>title<span class=\"token operator\">></span><span class=\"token number\">301</span> Moved Permanently<span class=\"token operator\">&lt;</span>/title<span class=\"token operator\">></span>\n<span class=\"token operator\">&lt;</span>/head<span class=\"token operator\">></span><span class=\"token operator\">&lt;</span>body<span class=\"token operator\">></span>\n<span class=\"token operator\">&lt;</span>h<span class=\"token operator\"><span class=\"token file-descriptor important\">1</span>></span>Moved Permanently<span class=\"token operator\">&lt;</span>/h<span class=\"token operator\"><span class=\"token file-descriptor important\">1</span>></span>\n<span class=\"token operator\">&lt;</span>p<span class=\"token operator\">></span>The document has moved <span class=\"token operator\">&lt;</span>a <span class=\"token assign-left variable\">href</span><span class=\"token operator\">=</span><span class=\"token string\">\"https://www.madu.gonzalonazareno.org/\"</span><span class=\"token operator\">></span>here<span class=\"token operator\">&lt;</span>/a<span class=\"token operator\">></span>.<span class=\"token operator\">&lt;</span>/p<span class=\"token operator\">></span>\n<span class=\"token operator\">&lt;</span>/body<span class=\"token operator\">></span><span class=\"token operator\">&lt;</span>/html<span class=\"token operator\">></span></code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">nft <span class=\"token function\">add</span> rule inet filter forward <span class=\"token function\">ip</span> daddr <span class=\"token number\">10.0</span>.2.4 iifname <span class=\"token string\">\"eth0\"</span> oifname <span class=\"token string\">\"eth2\"</span> tcp dport <span class=\"token number\">80</span> ct state new,established counter accept\nnft <span class=\"token function\">add</span> rule inet filter forward <span class=\"token function\">ip</span> saddr <span class=\"token number\">10.0</span>.2.4 iifname <span class=\"token string\">\"eth2\"</span> oifname <span class=\"token string\">\"eth0\"</span> tcp sport <span class=\"token number\">80</span> ct state established counter accept\n\nnft <span class=\"token function\">add</span> rule inet filter forward <span class=\"token function\">ip</span> daddr <span class=\"token number\">10.0</span>.2.4 iifname <span class=\"token string\">\"eth0\"</span> oifname <span class=\"token string\">\"eth2\"</span> tcp dport <span class=\"token number\">443</span> ct state new,established counter accept\nnft <span class=\"token function\">add</span> rule inet filter forward <span class=\"token function\">ip</span> saddr <span class=\"token number\">10.0</span>.2.4 iifname <span class=\"token string\">\"eth2\"</span> oifname <span class=\"token string\">\"eth0\"</span> tcp sport <span class=\"token number\">443</span> ct state established counter accept</code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">debian@dulcinea:~$ <span class=\"token function\">curl</span> http://www.madu.gonzalonazareno.org\n<span class=\"token operator\">&lt;</span><span class=\"token operator\">!</span>DOCTYPE HTML PUBLIC <span class=\"token string\">\"-//IETF//DTD HTML 2.0//EN\"</span><span class=\"token operator\">></span>\n<span class=\"token operator\">&lt;</span>html<span class=\"token operator\">></span><span class=\"token operator\">&lt;</span>head<span class=\"token operator\">></span>\n<span class=\"token operator\">&lt;</span>title<span class=\"token operator\">></span><span class=\"token number\">301</span> Moved Permanently<span class=\"token operator\">&lt;</span>/title<span class=\"token operator\">></span>\n<span class=\"token operator\">&lt;</span>/head<span class=\"token operator\">></span><span class=\"token operator\">&lt;</span>body<span class=\"token operator\">></span>\n<span class=\"token operator\">&lt;</span>h<span class=\"token operator\"><span class=\"token file-descriptor important\">1</span>></span>Moved Permanently<span class=\"token operator\">&lt;</span>/h<span class=\"token operator\"><span class=\"token file-descriptor important\">1</span>></span>\n<span class=\"token operator\">&lt;</span>p<span class=\"token operator\">></span>The document has moved <span class=\"token operator\">&lt;</span>a <span class=\"token assign-left variable\">href</span><span class=\"token operator\">=</span><span class=\"token string\">\"https://www.madu.gonzalonazareno.org/\"</span><span class=\"token operator\">></span>here<span class=\"token operator\">&lt;</span>/a<span class=\"token operator\">></span>.<span class=\"token operator\">&lt;</span>/p<span class=\"token operator\">></span>\n<span class=\"token operator\">&lt;</span>/body<span class=\"token operator\">></span><span class=\"token operator\">&lt;</span>/html<span class=\"token operator\">></span></code></pre></div>\n<h3 id=\"más-servicios\"><a href=\"#m%C3%A1s-servicios\" aria-label=\"más servicios permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Más servicios</h3>\n<ul>\n<li><strong>Configura de manera adecuada el cortafuegos, para otros servicios que tengas instalado en tu red (ldap, correo, ...)</strong></li>\n</ul>\n<p><strong>Permitimos que todas las máquinas puedan acceder a los puertos 80 y 443 del exterior (necesario para las actualizaciones).</strong></p>\n<p>LAN</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">nft <span class=\"token function\">add</span> rule inet filter forward <span class=\"token function\">ip</span> saddr <span class=\"token number\">10.0</span>.1.0/24 iifname <span class=\"token string\">\"eth1\"</span> oifname <span class=\"token string\">\"eth0\"</span> tcp dport <span class=\"token number\">80</span> ct state new,established counter accept\nnft <span class=\"token function\">add</span> rule inet filter forward <span class=\"token function\">ip</span> daddr <span class=\"token number\">10.0</span>.1.0/24 iifname <span class=\"token string\">\"eth0\"</span> oifname <span class=\"token string\">\"eth1\"</span> tcp sport <span class=\"token number\">80</span> ct state established counter accept\n\nnft <span class=\"token function\">add</span> rule inet filter forward <span class=\"token function\">ip</span> saddr <span class=\"token number\">10.0</span>.1.0/24 iifname <span class=\"token string\">\"eth1\"</span> oifname <span class=\"token string\">\"eth0\"</span> tcp dport <span class=\"token number\">443</span> ct state new,established counter accept\nnft <span class=\"token function\">add</span> rule inet filter forward <span class=\"token function\">ip</span> daddr <span class=\"token number\">10.0</span>.1.0/24 iifname <span class=\"token string\">\"eth0\"</span> oifname <span class=\"token string\">\"eth1\"</span> tcp sport <span class=\"token number\">443</span> ct state established counter accept</code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">debian@freston:~$ <span class=\"token function\">sudo</span> <span class=\"token function\">apt</span> update\nGet:1 http://security.debian.org/debian-security buster/updates InRelease <span class=\"token punctuation\">[</span><span class=\"token number\">65.4</span> kB<span class=\"token punctuation\">]</span>\nGet:2 http://deb.debian.org/debian buster InRelease <span class=\"token punctuation\">[</span><span class=\"token number\">121</span> kB<span class=\"token punctuation\">]</span>\nGet:3 http://deb.debian.org/debian buster-updates InRelease <span class=\"token punctuation\">[</span><span class=\"token number\">51.9</span> kB<span class=\"token punctuation\">]</span>\nGet:4 http://security.debian.org/debian-security buster/updates/main Sources <span class=\"token punctuation\">[</span><span class=\"token number\">184</span> kB<span class=\"token punctuation\">]</span>\nGet:5 http://deb.debian.org/debian buster/main Sources <span class=\"token punctuation\">[</span><span class=\"token number\">7,841</span> kB<span class=\"token punctuation\">]</span>                      \nGet:6 http://security.debian.org/debian-security buster/updates/main amd64 Packages <span class=\"token punctuation\">[</span><span class=\"token number\">286</span> kB<span class=\"token punctuation\">]</span>\nGet:7 http://security.debian.org/debian-security buster/updates/main Translation-en <span class=\"token punctuation\">[</span><span class=\"token number\">148</span> kB<span class=\"token punctuation\">]</span>\nHit:8 http://repo.zabbix.com/zabbix/4.4/debian buster InRelease                        \nGet:9 http://deb.debian.org/debian buster-updates/main Sources.diff/Index <span class=\"token punctuation\">[</span><span class=\"token number\">6,640</span> B<span class=\"token punctuation\">]</span>    \nGet:10 http://deb.debian.org/debian buster-updates/main amd64 Packages.diff/Index <span class=\"token punctuation\">[</span><span class=\"token number\">6,640</span> B<span class=\"token punctuation\">]</span>\nGet:11 http://deb.debian.org/debian buster-updates/main Translation-en.diff/Index <span class=\"token punctuation\">[</span><span class=\"token number\">4,180</span> B<span class=\"token punctuation\">]</span>\nGet:12 http://deb.debian.org/debian buster-updates/main Sources <span class=\"token number\">2021</span>-02-07-1359.56.pdiff <span class=\"token punctuation\">[</span><span class=\"token number\">959</span> B<span class=\"token punctuation\">]</span>\nGet:13 http://deb.debian.org/debian buster-updates/main Sources <span class=\"token number\">2021</span>-04-22-1401.14.pdiff <span class=\"token punctuation\">[</span><span class=\"token number\">985</span> B<span class=\"token punctuation\">]</span>\nGet:14 http://deb.debian.org/debian buster-updates/main Sources <span class=\"token number\">2021</span>-04-23-1401.02.pdiff <span class=\"token punctuation\">[</span><span class=\"token number\">238</span> B<span class=\"token punctuation\">]</span>\nGet:14 http://deb.debian.org/debian buster-updates/main Sources <span class=\"token number\">2021</span>-04-23-1401.02.pdiff <span class=\"token punctuation\">[</span><span class=\"token number\">238</span> B<span class=\"token punctuation\">]</span>\nGet:15 http://deb.debian.org/debian buster-updates/main amd64 Packages <span class=\"token number\">2021</span>-02-07-1359.56.pdiff <span class=\"token punctuation\">[</span><span class=\"token number\">2,302</span> B<span class=\"token punctuation\">]</span>\nGet:16 http://deb.debian.org/debian buster-updates/main amd64 Packages <span class=\"token number\">2021</span>-04-22-1401.14.pdiff <span class=\"token punctuation\">[</span><span class=\"token number\">1,996</span> B<span class=\"token punctuation\">]</span>\nGet:17 http://deb.debian.org/debian buster-updates/main amd64 Packages <span class=\"token number\">2021</span>-04-23-1401.02.pdiff <span class=\"token punctuation\">[</span><span class=\"token number\">1,127</span> B<span class=\"token punctuation\">]</span>\nGet:17 http://deb.debian.org/debian buster-updates/main amd64 Packages <span class=\"token number\">2021</span>-04-23-1401.02.pdiff <span class=\"token punctuation\">[</span><span class=\"token number\">1,127</span> B<span class=\"token punctuation\">]</span>\nGet:18 http://deb.debian.org/debian buster-updates/main Translation-en <span class=\"token number\">2021</span>-02-07-1359.56.pdiff <span class=\"token punctuation\">[</span><span class=\"token number\">1,506</span> B<span class=\"token punctuation\">]</span>\nGet:19 http://deb.debian.org/debian buster-updates/main Translation-en <span class=\"token number\">2021</span>-04-22-1401.14.pdiff <span class=\"token punctuation\">[</span><span class=\"token number\">1,408</span> B<span class=\"token punctuation\">]</span>\nGet:19 http://deb.debian.org/debian buster-updates/main Translation-en <span class=\"token number\">2021</span>-04-22-1401.14.pdiff <span class=\"token punctuation\">[</span><span class=\"token number\">1,408</span> B<span class=\"token punctuation\">]</span>\nGet:20 http://deb.debian.org/debian buster/main amd64 Packages <span class=\"token punctuation\">[</span><span class=\"token number\">7,907</span> kB<span class=\"token punctuation\">]</span>\nGet:21 http://deb.debian.org/debian buster/main Translation-en <span class=\"token punctuation\">[</span><span class=\"token number\">5,969</span> kB<span class=\"token punctuation\">]</span>\nFetched <span class=\"token number\">22.6</span> MB <span class=\"token keyword\">in</span> 8s <span class=\"token punctuation\">(</span><span class=\"token number\">2,765</span> kB/s<span class=\"token punctuation\">)</span>                                                     \nReading package lists<span class=\"token punctuation\">..</span>. Done\nBuilding dependency tree       \nReading state information<span class=\"token punctuation\">..</span>. Done\n<span class=\"token number\">71</span> packages can be upgraded. Run <span class=\"token string\">'apt list --upgradable'</span> to see them.\nN: Repository <span class=\"token string\">'http://deb.debian.org/debian buster InRelease'</span> changed its <span class=\"token string\">'Version'</span> value from <span class=\"token string\">'10.7'</span> to <span class=\"token string\">'10.9'</span></code></pre></div>\n<p>DMZ</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">nft <span class=\"token function\">add</span> rule inet filter forward <span class=\"token function\">ip</span> saddr <span class=\"token number\">10.0</span>.2.0/24 iifname <span class=\"token string\">\"eth2\"</span> oifname <span class=\"token string\">\"eth0\"</span> tcp dport <span class=\"token number\">80</span> ct state new,established counter accept\nnft <span class=\"token function\">add</span> rule inet filter forward <span class=\"token function\">ip</span> daddr <span class=\"token number\">10.0</span>.2.0/24 iifname <span class=\"token string\">\"eth0\"</span> oifname <span class=\"token string\">\"eth2\"</span> tcp sport <span class=\"token number\">80</span> ct state established counter accept\n\nnft <span class=\"token function\">add</span> rule inet filter forward <span class=\"token function\">ip</span> saddr <span class=\"token number\">10.0</span>.2.0/24 iifname <span class=\"token string\">\"eth2\"</span> oifname <span class=\"token string\">\"eth0\"</span> tcp dport <span class=\"token number\">443</span> ct state new,established counter accept\nnft <span class=\"token function\">add</span> rule inet filter forward <span class=\"token function\">ip</span> daddr <span class=\"token number\">10.0</span>.2.0/24 iifname <span class=\"token string\">\"eth0\"</span> oifname <span class=\"token string\">\"eth2\"</span> tcp sport <span class=\"token number\">443</span> ct state established counter accept</code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\"><span class=\"token punctuation\">[</span>centos@quijote ~<span class=\"token punctuation\">]</span>$ <span class=\"token function\">sudo</span> dnf update\nLast metadata expiration check: <span class=\"token number\">0</span>:52:25 ago on Wed <span class=\"token number\">12</span> May <span class=\"token number\">2021</span> 07:42:43 PM CEST.\nDependencies resolved.\nNothing to do.\nComplete<span class=\"token operator\">!</span></code></pre></div>\n<p>Dulcinea</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">nft <span class=\"token function\">add</span> rule inet filter output oifname <span class=\"token string\">\"eth0\"</span> tcp dport <span class=\"token number\">80</span> ct state new,established counter accept\nnft <span class=\"token function\">add</span> rule inet filter input iifname <span class=\"token string\">\"eth0\"</span> tcp sport <span class=\"token number\">80</span> ct state established counter accept\n\nnft <span class=\"token function\">add</span> rule inet filter output oifname <span class=\"token string\">\"eth0\"</span> tcp dport <span class=\"token number\">443</span> ct state new,established counter accept\nnft <span class=\"token function\">add</span> rule inet filter input iifname <span class=\"token string\">\"eth0\"</span> tcp sport <span class=\"token number\">443</span> ct state established counter accept</code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">root@dulcinea:/home/debian<span class=\"token comment\"># apt update</span>\nGet:1 http://security.debian.org/debian-security buster/updates InRelease <span class=\"token punctuation\">[</span><span class=\"token number\">65.4</span> kB<span class=\"token punctuation\">]</span>\nGet:2 http://deb.debian.org/debian buster InRelease <span class=\"token punctuation\">[</span><span class=\"token number\">121</span> kB<span class=\"token punctuation\">]</span>\nGet:3 http://deb.debian.org/debian buster-updates InRelease <span class=\"token punctuation\">[</span><span class=\"token number\">51.9</span> kB<span class=\"token punctuation\">]</span>\nGet:4 http://security.debian.org/debian-security buster/updates/main Sources <span class=\"token punctuation\">[</span><span class=\"token number\">184</span> kB<span class=\"token punctuation\">]</span>\nGet:5 http://security.debian.org/debian-security buster/updates/main amd64 Packages <span class=\"token punctuation\">[</span><span class=\"token number\">286</span> kB<span class=\"token punctuation\">]</span>\nGet:6 http://deb.debian.org/debian buster/main Sources <span class=\"token punctuation\">[</span><span class=\"token number\">7,841</span> kB<span class=\"token punctuation\">]</span>\nGet:7 http://security.debian.org/debian-security buster/updates/main Translation-en <span class=\"token punctuation\">[</span><span class=\"token number\">148</span> kB<span class=\"token punctuation\">]</span>\nGet:8 http://deb.debian.org/debian buster-updates/main Sources.diff/Index <span class=\"token punctuation\">[</span><span class=\"token number\">6,640</span> B<span class=\"token punctuation\">]</span>\nGet:9 http://deb.debian.org/debian buster-updates/main amd64 Packages.diff/Index <span class=\"token punctuation\">[</span><span class=\"token number\">6,640</span> B<span class=\"token punctuation\">]</span>\nGet:10 http://deb.debian.org/debian buster-updates/main Translation-en.diff/Index <span class=\"token punctuation\">[</span><span class=\"token number\">4,180</span> B<span class=\"token punctuation\">]</span>\nGet:11 http://deb.debian.org/debian buster-updates/main Sources <span class=\"token number\">2021</span>-02-07-1359.56.pdiff <span class=\"token punctuation\">[</span><span class=\"token number\">959</span> B<span class=\"token punctuation\">]</span>\nGet:12 http://deb.debian.org/debian buster-updates/main Sources <span class=\"token number\">2021</span>-04-22-1401.14.pdiff <span class=\"token punctuation\">[</span><span class=\"token number\">985</span> B<span class=\"token punctuation\">]</span>\nGet:13 http://deb.debian.org/debian buster-updates/main Sources <span class=\"token number\">2021</span>-04-23-1401.02.pdiff <span class=\"token punctuation\">[</span><span class=\"token number\">238</span> B<span class=\"token punctuation\">]</span>\nGet:13 http://deb.debian.org/debian buster-updates/main Sources <span class=\"token number\">2021</span>-04-23-1401.02.pdiff <span class=\"token punctuation\">[</span><span class=\"token number\">238</span> B<span class=\"token punctuation\">]</span>\nGet:14 http://deb.debian.org/debian buster-updates/main amd64 Packages <span class=\"token number\">2021</span>-02-07-1359.56.pdiff <span class=\"token punctuation\">[</span><span class=\"token number\">2,302</span> B<span class=\"token punctuation\">]</span>\nGet:15 http://deb.debian.org/debian buster-updates/main amd64 Packages <span class=\"token number\">2021</span>-04-22-1401.14.pdiff <span class=\"token punctuation\">[</span><span class=\"token number\">1,996</span> B<span class=\"token punctuation\">]</span>\nGet:16 http://deb.debian.org/debian buster-updates/main amd64 Packages <span class=\"token number\">2021</span>-04-23-1401.02.pdiff <span class=\"token punctuation\">[</span><span class=\"token number\">1,127</span> B<span class=\"token punctuation\">]</span>\nGet:16 http://deb.debian.org/debian buster-updates/main amd64 Packages <span class=\"token number\">2021</span>-04-23-1401.02.pdiff <span class=\"token punctuation\">[</span><span class=\"token number\">1,127</span> B<span class=\"token punctuation\">]</span>\nGet:17 http://deb.debian.org/debian buster-updates/main Translation-en <span class=\"token number\">2021</span>-02-07-1359.56.pdiff <span class=\"token punctuation\">[</span><span class=\"token number\">1,506</span> B<span class=\"token punctuation\">]</span>\nGet:18 http://deb.debian.org/debian buster-updates/main Translation-en <span class=\"token number\">2021</span>-04-22-1401.14.pdiff <span class=\"token punctuation\">[</span><span class=\"token number\">1,408</span> B<span class=\"token punctuation\">]</span>\nGet:18 http://deb.debian.org/debian buster-updates/main Translation-en <span class=\"token number\">2021</span>-04-22-1401.14.pdiff <span class=\"token punctuation\">[</span><span class=\"token number\">1,408</span> B<span class=\"token punctuation\">]</span>\nGet:19 http://deb.debian.org/debian buster/main amd64 Packages <span class=\"token punctuation\">[</span><span class=\"token number\">7,907</span> kB<span class=\"token punctuation\">]</span>\nIgn:19 http://deb.debian.org/debian buster/main amd64 Packages                         \nGet:20 http://deb.debian.org/debian buster/main Translation-en <span class=\"token punctuation\">[</span><span class=\"token number\">5,969</span> kB<span class=\"token punctuation\">]</span>\nIgn:20 http://deb.debian.org/debian buster/main Translation-en                         \nGet:19 http://deb.debian.org/debian buster/main amd64 Packages <span class=\"token punctuation\">[</span><span class=\"token number\">7,907</span> kB<span class=\"token punctuation\">]</span>\nGet:20 http://deb.debian.org/debian buster/main Translation-en <span class=\"token punctuation\">[</span><span class=\"token number\">5,969</span> kB<span class=\"token punctuation\">]</span>\nFetched <span class=\"token number\">13.1</span> MB <span class=\"token keyword\">in</span> 1min 8s <span class=\"token punctuation\">(</span><span class=\"token number\">191</span> kB/s<span class=\"token punctuation\">)</span>                                                  \nReading package lists<span class=\"token punctuation\">..</span>. Done\nBuilding dependency tree       \nReading state information<span class=\"token punctuation\">..</span>. Done\n<span class=\"token number\">50</span> packages can be upgraded. Run <span class=\"token string\">'apt list --upgradable'</span> to see them.\nN: Repository <span class=\"token string\">'http://deb.debian.org/debian buster InRelease'</span> changed its <span class=\"token string\">'Version'</span> value from <span class=\"token string\">'10.7'</span> to <span class=\"token string\">'10.9'</span></code></pre></div>\n<p><strong>Permitimos que todas las máquinas puedan acceder al puerto 123 del exterior (necesario para la sincronización NTP).</strong></p>\n<p>LAN</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">nft <span class=\"token function\">add</span> rule inet filter forward <span class=\"token function\">ip</span> saddr <span class=\"token number\">10.0</span>.1.0/24 iifname <span class=\"token string\">\"eth1\"</span> oifname <span class=\"token string\">\"eth0\"</span> udp dport <span class=\"token number\">123</span> ct state new,established counter accept\nnft <span class=\"token function\">add</span> rule inet filter forward <span class=\"token function\">ip</span> daddr <span class=\"token number\">10.0</span>.1.0/24 iifname <span class=\"token string\">\"eth0\"</span> oifname <span class=\"token string\">\"eth1\"</span> udp sport <span class=\"token number\">123</span> ct state established counter accept</code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">ubuntu@sancho:~$ timedatectl\n               Local time: Wed <span class=\"token number\">2021</span>-05-12 <span class=\"token number\">20</span>:38:08 CEST\n           Universal time: Wed <span class=\"token number\">2021</span>-05-12 <span class=\"token number\">18</span>:38:08 UTC \n                 RTC time: Wed <span class=\"token number\">2021</span>-05-12 <span class=\"token number\">18</span>:38:09     \n                Time zone: Europe/Madrid <span class=\"token punctuation\">(</span>CEST, +0200<span class=\"token punctuation\">)</span> \nSystem clock synchronized: <span class=\"token function\">yes</span>                         \n              NTP service: active                      \n          RTC <span class=\"token keyword\">in</span> <span class=\"token builtin class-name\">local</span> TZ: no  </code></pre></div>\n<p>DMZ</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">nft <span class=\"token function\">add</span> rule inet filter forward <span class=\"token function\">ip</span> saddr <span class=\"token number\">10.0</span>.2.0/24 iifname <span class=\"token string\">\"eth2\"</span> oifname <span class=\"token string\">\"eth0\"</span> udp dport <span class=\"token number\">123</span> ct state new,established counter accept\nnft <span class=\"token function\">add</span> rule inet filter forward <span class=\"token function\">ip</span> daddr <span class=\"token number\">10.0</span>.2.0/24 iifname <span class=\"token string\">\"eth0\"</span> oifname <span class=\"token string\">\"eth2\"</span> udp sport <span class=\"token number\">123</span> ct state established counter accept</code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\"><span class=\"token punctuation\">[</span>centos@quijote ~<span class=\"token punctuation\">]</span>$ timedatectl\n               Local time: Wed <span class=\"token number\">2021</span>-05-12 <span class=\"token number\">20</span>:38:56 CEST\n           Universal time: Wed <span class=\"token number\">2021</span>-05-12 <span class=\"token number\">18</span>:38:56 UTC\n                 RTC time: Wed <span class=\"token number\">2021</span>-05-12 <span class=\"token number\">18</span>:38:56\n                Time zone: Europe/Madrid <span class=\"token punctuation\">(</span>CEST, +0200<span class=\"token punctuation\">)</span>\nSystem clock synchronized: <span class=\"token function\">yes</span>\n              NTP service: active\n          RTC <span class=\"token keyword\">in</span> <span class=\"token builtin class-name\">local</span> TZ: no</code></pre></div>\n<p>Dulcinea</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">nft <span class=\"token function\">add</span> rule inet filter output oifname <span class=\"token string\">\"eth0\"</span> udp dport <span class=\"token number\">123</span> ct state new,established counter accept\nnft <span class=\"token function\">add</span> rule inet filter input iifname <span class=\"token string\">\"eth0\"</span> udp sport <span class=\"token number\">123</span> ct state established counter accept</code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">root@dulcinea:/home/debian<span class=\"token comment\"># timedatectl</span>\n               Local time: Wed <span class=\"token number\">2021</span>-05-12 <span class=\"token number\">20</span>:39:29 CEST\n           Universal time: Wed <span class=\"token number\">2021</span>-05-12 <span class=\"token number\">18</span>:39:29 UTC\n                 RTC time: Wed <span class=\"token number\">2021</span>-05-12 <span class=\"token number\">18</span>:39:30\n                Time zone: Europe/Madrid <span class=\"token punctuation\">(</span>CEST, +0200<span class=\"token punctuation\">)</span>\nSystem clock synchronized: <span class=\"token function\">yes</span>\n              NTP service: inactive\n          RTC <span class=\"token keyword\">in</span> <span class=\"token builtin class-name\">local</span> TZ: no</code></pre></div>\n<p><strong>Para finalizar guardaremos las reglas en un fichero para que la configuración perdure tras un reinicio</strong></p>\n<p>Ahora es el momento de poner las politicas a drop y guardar el fichero de nftables.</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">nft chain inet filter input <span class=\"token punctuation\">{</span> policy drop <span class=\"token punctuation\">\\</span><span class=\"token punctuation\">;</span> <span class=\"token punctuation\">}</span>\nnft chain inet filter forward <span class=\"token punctuation\">{</span> policy drop <span class=\"token punctuation\">\\</span><span class=\"token punctuation\">;</span> <span class=\"token punctuation\">}</span></code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">nft list ruleset <span class=\"token operator\">></span> /etc/nftables.conf</code></pre></div>","timeToRead":28,"excerpt":"Cortafuegos Vamos a construir un cortafuegos en dulcinea que nos permita controlar el tráfico de nuestra red. El cortafuegos que vamos a…","frontmatter":{"title":"[SAD] - Cortafuegos - OpenStack","cover":"https://img.icons8.com/ios/452/work.png","date":"2021-04-05T00:00:00.000Z","categories":["SAD"],"tags":["Cortafuegos","Iptables","OpenStack"]},"fields":{"slug":"/sad-cortafuegos-open-stack","date":"April 04, 2021"}}},"pageContext":{"slug":"/sad-cortafuegos-open-stack","nexttitle":"[SAD] - Práctica: VPN con OpenVPN y certificados x509","nextslug":"/sad-practica-vpn-con-open-vpn-y-certificados-x-509","prevtitle":"[IAW] - Práctica: Implantación de aplicaciones web PHP en docker ","prevslug":"/iaw-practica-implantacion-de-aplicaciones-web-php-en-docker"}}}