{"componentChunkName":"component---src-templates-post-js","path":"/configuracion-de-cliente-open-vpn-con-certificados-x-509","result":{"data":{"markdownRemark":{"html":"<h2 id=\"configuración-de-cliente-openvpn-con-certificados-x509\"><a href=\"#configuraci%C3%B3n-de-cliente-openvpn-con-certificados-x509\" aria-label=\"configuración de cliente openvpn con certificados x509 permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Configuración de cliente OpenVPN con certificados X.509</h2>\n<h3 id=\"para-poder-acceder-a-la-red-local-desde-el-exterior-existe-una-red-privada-configurada-con-openvpn-que-utiliza-certificados-x509-para-autenticar-los-usuarios-y-el-servidor\"><a href=\"#para-poder-acceder-a-la-red-local-desde-el-exterior-existe-una-red-privada-configurada-con-openvpn-que-utiliza-certificados-x509-para-autenticar-los-usuarios-y-el-servidor\" aria-label=\"para poder acceder a la red local desde el exterior existe una red privada configurada con openvpn que utiliza certificados x509 para autenticar los usuarios y el servidor permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Para poder acceder a la red local desde el exterior, existe una red privada configurada con OpenVPN que utiliza certificados x509 para autenticar los usuarios y el servidor.</h3>\n<ul>\n<li>\n<p>Genera una clave privada RSA 4096</p>\n<pre style=\"background-color:powderblue;\">\nroot@debian:/home/fran/Documentos# openssl genrsa 4096 > /etc/ssl/private/maduvpn.key\nGenerating RSA private key, 4096 bit long modulus (2 primes)\n.................................++++\n....................................\n.........................................................++++\ne is 65537 (0x010001)\n</pre>\n</li>\n<li>\n<p>Genera una solicitud de firma de certificado (fichero CSR) y súbelo a gestiona</p>\n<pre style=\"background-color:powderblue;\">\nroot@debian:~# openssl req -new -key /etc/ssl/private/maduvpn.key -out /root/maduvpn.csr\nYou are about to be asked to enter information that will be incorporated\ninto your certificate request.\nWhat you are about to enter is what is called a Distinguished Name or a DN.\nThere are quite a few fields but you can leave some blank\nFor some fields there will be a default value,\nIf you enter '.', the field will be left blank.\n-----\nCountry Name (2 letter code) [AU]:ES\nState or Province Name (full name) [Some-State]:Sevilla\nLocality Name (eg, city) []:Dos Hermanas\nOrganization Name (eg, company) [Internet Widgits Pty Ltd]:IES Gonzalo Nazareno\nOrganizational Unit Name (eg, section) []:Asir\nCommon Name (e.g. server FQDN or YOUR name) []:maduvpn  \nEmail Address []:frandh1997@gmail.com\n</li>\n</ul>\n<p>Please enter the following 'extra' attributes\nto be sent with your certificate request\nA challenge password []:\nAn optional company name []:</p>\n</pre>\n<p>Una vez generado el certificado deberemos ir a gestiona \"<a href=\"https://dit.gonzalonazareno.org/gestiona/cert/\">https://dit.gonzalonazareno.org/gestiona/cert/</a>\" subirlo y esperar su regreso.\nNos llegará nuestro archivo .crt y estara certificado por el cetro.</p>\n<ul>\n<li>Instala y configura apropiadamente el cliente openvpn y muestra los registros (logs) del sistema que demuestren que se ha establecido una conexión.</li>\n</ul>\n<p>Instalaremos nuestro cliente openvpn</p>\n<pre style=\"background-color:powderblue;\">\nfran@debian:~$ sudo apt-get install openvpn\n</pre>\n<p>Ahora con paquete instalado moveremos el certificado a /etc/openvpn</p>\n<pre style=\"background-color:powderblue;\">\nroot@debian:/etc/openvpn# ls\nclient\tmaduvpn.crt  server  update-resolv-conf\n</pre>\n<p>Crearemos un fichero de configuración nuevo y le añadiremos las siguientes lineas</p>\n<pre style=\"background-color:powderblue;\">\n#sputnik.conf\ndev tun\nremote sputnik.gonzalonazareno.org\nifconfig 172.23.0.0 255.255.255.0\npull\nproto tcp-client\ntls-client\nremote-cert-tls server\nca /etc/ssl/certs/gonzalonazareno.crt            \ncert /etc/openvpn/maduvpn.crt\nkey /etc/ssl/private/maduvpn.key\ncomp-lzo\nkeepalive 10 60\nlog /var/log/openvpn-sputnik.log\nverb 1\n</pre>\n<p>Reiniciamos el servicio de openvpn</p>\n<pre style=\"background-color:powderblue;\">\nroot@debian:/etc/openvpn# /etc/init.d/openvpn restart\n[ ok ] Restarting openvpn (via systemctl): openvpn.service.\n</pre>\n<p>Commprobamos que se ha creado la regla de encaminamiento para acceder a los equipos de la 172.22.0.0/16.</p>\n<pre style=\"background-color:powderblue;\">\nfran@debian:~$ ip r\ndefault via 192.168.1.1 dev wlo1 proto dhcp metric 600 \n169.254.0.0/16 dev wlo1 scope link metric 1000 \n172.22.0.0/16 via 172.23.0.93 dev tun0 \n172.23.0.1 via 172.23.0.93 dev tun0 \n172.23.0.93 dev tun0 proto kernel scope link src 172.23.0.94 \n192.168.1.0/24 dev wlo1 proto kernel scope link src 192.168.1.139 metric 600 \n</pre>\n<p>Comprobamos los mensajes de log</p>\n<pre style=\"background-color:powderblue;\">\nroot@debian:/home/fran# cat /var/log/openvpn-sputnik.log\nWed Nov  4 19:10:38 2020 WARNING: file '/etc/ssl/private/maduvpn.key' is group or others accessible\nWed Nov  4 19:10:38 2020 OpenVPN 2.4.7 x86_64-pc-linux-gnu [SSL (OpenSSL)] [LZO] [LZ4] [EPOLL] [PKCS11] [MH/PKTINFO] [AEAD] built on Feb 20 2019\nWed Nov  4 19:10:38 2020 library versions: OpenSSL 1.1.1d  10 Sep 2019, LZO 2.10\nWed Nov  4 19:10:38 2020 WARNING: using --pull/--client and --ifconfig together is probably not what you want\nWed Nov  4 19:10:38 2020 TCP/UDP: Preserving recently used remote address: [AF_INET]92.222.86.77:1194\nWed Nov  4 19:10:38 2020 Attempting to establish TCP connection with [AF_INET]92.222.86.77:1194 [nonblock]\nWed Nov  4 19:10:39 2020 TCP connection established with [AF_INET]92.222.86.77:1194\nWed Nov  4 19:10:39 2020 TCP_CLIENT link local: (not bound)\nWed Nov  4 19:10:39 2020 TCP_CLIENT link remote: [AF_INET]92.222.86.77:1194\nWed Nov  4 19:10:40 2020 [sputnik.gonzalonazareno.org] Peer Connection Initiated with [AF_INET]92.222.86.77:1194\nWed Nov  4 19:10:41 2020 TUN/TAP device tun0 opened\nWed Nov  4 19:10:41 2020 /sbin/ip link set dev tun0 up mtu 1500\nWed Nov  4 19:10:41 2020 /sbin/ip addr add dev tun0 local 172.23.0.94 peer 172.23.0.93\nWed Nov  4 19:10:41 2020 WARNING: this configuration may cache passwords in memory -- use the auth-nocache option to prevent this\nWed Nov  4 19:10:41 2020 Initialization Sequence Completed\n</pre>\n<ul>\n<li>Cuando hayas establecido la conexión VPN tendrás acceso a la red 172.22.0.0/16 a través de un túnel SSL. Compruébalo haciendo ping a 172.22.0.1</li>\n</ul>\n<pre style=\"background-color:powderblue;\">\nroot@debian:/home/fran# ping 172.22.0.1\nPING 172.22.0.1 (172.22.0.1) 56(84) bytes of data.\n64 bytes from 172.22.0.1: icmp_seq=1 ttl=63 time=144 ms\n64 bytes from 172.22.0.1: icmp_seq=2 ttl=63 time=88.8 ms\n64 bytes from 172.22.0.1: icmp_seq=3 ttl=63 time=88.8 ms\n64 bytes from 172.22.0.1: icmp_seq=4 ttl=63 time=93.5 ms\n^C\n--- 172.22.0.1 ping statistics ---\n4 packets transmitted, 4 received, 0% packet loss, time 8ms\nrtt min/avg/max/mdev = 88.801/103.841/144.254/23.411 ms\n</pre>","timeToRead":4,"excerpt":"Configuración de cliente OpenVPN con certificados X.509 Para poder acceder a la red local desde el exterior, existe una red privada…","frontmatter":{"title":"Configuración de cliente OpenVPN con certificados X.509","cover":"https://img.icons8.com/ios/452/work.png","date":"2020-11-03T00:00:00.000Z","categories":["HLC"],"tags":["OpenVPN","Certificados"]},"fields":{"slug":"/configuracion-de-cliente-open-vpn-con-certificados-x-509","date":"November 02, 2020"}}},"pageContext":{"slug":"/configuracion-de-cliente-open-vpn-con-certificados-x-509","nexttitle":"Ejercicio 6: Configuración de apache mediante archivo .htaccess ","nextslug":"/ejercicio-6-configuracion-de-apache-mediante-archivo-htaccess","prevtitle":"Servidor web nginx","prevslug":"/servidor-web-nginx"}}}