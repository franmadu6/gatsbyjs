{"componentChunkName":"component---src-templates-post-js","path":"/utilizacion-de-cloud-init","result":{"data":{"markdownRemark":{"html":"<p><img src=\"/gatsbyjs/a90123ac31a89e2493991affc9cc3c94/cloud-init.svg\" alt=\"PracticaImg\" title=\"cloud init logo\"></p>\n<h3 id=\"cloud-init-se-define-como-el-estándar-para-personalizar-instancias-cloud-las-imágenes-para-las-instancias-cloud-empiezan-siendo-idénticas-entre-sí-al-ser-clones-es-la-información-proporcionada-por-el-usuario-lo-que-le-da-a-la-instancia-su-personalidad-y-cloud-init-es-la-herramienta-que-aplica-esta-configuración-a-las-instancias-de-forma-automática\"><a href=\"#cloud-init-se-define-como-el-est%C3%A1ndar-para-personalizar-instancias-cloud-las-im%C3%A1genes-para-las-instancias-cloud-empiezan-siendo-id%C3%A9nticas-entre-s%C3%AD-al-ser-clones-es-la-informaci%C3%B3n-proporcionada-por-el-usuario-lo-que-le-da-a-la-instancia-su-personalidad-y-cloud-init-es-la-herramienta-que-aplica-esta-configuraci%C3%B3n-a-las-instancias-de-forma-autom%C3%A1tica\" aria-label=\"cloud init se define como el estándar para personalizar instancias cloud las imágenes para las instancias cloud empiezan siendo idénticas entre sí al ser clones es la información proporcionada por el usuario lo que le da a la instancia su personalidad y cloud init es la herramienta que aplica esta configuración a las instancias de forma automática permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>cloud-init se define como el estándar para personalizar instancias cloud. Las imágenes para las instancias cloud empiezan siendo idénticas entre sí, al ser clones. Es la información proporcionada por el usuario lo que le da a la instancia su personalidad y cloud-init es la herramienta que aplica esta configuración a las instancias de forma automática.</h3>\n<h3 id=\"cloud-init-fue-desarrollado-inicialmente-por-canonical-para-las-imágenes-cloud-de-ubuntu-usadas-por-aws-desde-entonces-la-aplicación-ha-evolucionado-y-puede-ser-usada-en-otras-muchas-distribuciones-y-en-otros-entornos-cloud-y-no-cloud\"><a href=\"#cloud-init-fue-desarrollado-inicialmente-por-canonical-para-las-im%C3%A1genes-cloud-de-ubuntu-usadas-por-aws-desde-entonces-la-aplicaci%C3%B3n-ha-evolucionado-y-puede-ser-usada-en-otras-muchas-distribuciones-y-en-otros-entornos-cloud-y-no-cloud\" aria-label=\"cloud init fue desarrollado inicialmente por canonical para las imágenes cloud de ubuntu usadas por aws desde entonces la aplicación ha evolucionado y puede ser usada en otras muchas distribuciones y en otros entornos cloud y no cloud permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>cloud-init fue desarrollado inicialmente por Canonical para las imágenes cloud de Ubuntu usadas por AWS. Desde entonces, la aplicación ha evolucionado y puede ser usada en otras muchas distribuciones y en otros entornos cloud (y no cloud).</h3>\n<hr>\n<h2 id=\"elige-una-instancia-del-escenario-de-openstack-y-vuelve-a-crearla-utilizando-el-mismo-volumen-para-el-sistema-raíz-pero-realizando-toda-la-configuración-posible-con-cloud-init-de-manera-que-la-instancia-permanezca-bien-configurada-aunque-se-reinicie\"><a href=\"#elige-una-instancia-del-escenario-de-openstack-y-vuelve-a-crearla-utilizando-el-mismo-volumen-para-el-sistema-ra%C3%ADz-pero-realizando-toda-la-configuraci%C3%B3n-posible-con-cloud-init-de-manera-que-la-instancia-permanezca-bien-configurada-aunque-se-reinicie\" aria-label=\"elige una instancia del escenario de openstack y vuelve a crearla utilizando el mismo volumen para el sistema raíz pero realizando toda la configuración posible con cloud init de manera que la instancia permanezca bien configurada aunque se reinicie permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Elige una instancia del escenario de OpenStack y vuelve a crearla utilizando el mismo volumen para el sistema raíz, pero realizando toda la configuración posible con cloud-init, de manera que la instancia permanezca bien configurada aunque se reinicie.</h2>\n<ul>\n<li>Sube a la tarea el fichero <strong>cloud-config</strong> utilizado.</li>\n</ul>\n<p>habilitaremos el servidor dhcp de la subred\n<span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 530px;\"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/gatsbyjs/static/dd4629213eb774175704f71288f23e39/3e6fd/subred-cloud-init.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 72.45283018867926%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAYAAAAvxDzwAAAACXBIWXMAAAsSAAALEgHS3X78AAABmUlEQVQ4y4VTia6CQAzk/z/MaKLG+xafmCAqlyigcsxj6oMHBnWTSRd22860XcU0TYzHY2w2G0wmE0ynU6xWK/T7fQyHQ4xGI+x2u+IsDENwpWmKuqWoqopms4lutytB5/M5er0eGo0GFosFeL5cLtFqteSbK0kSCVgHJY5j5IiiCPf7HbfbTZwej8e/8wdWlYCvh5fLBdvtFp7n4Xg8Qtd1SZKDkoMgEHDPpOUSKPnGsiwcDge4riuWtTX2eynDTwYtS0LLe7ZtF9b3/QpLJd8w0z4LMBgMpAG240A3Pai6BcPxcXCDDD4sP4ITJrD9GG5mn3QYA/8Mc5aGYWA2m2G9Xkt2g0wt+8/liSS7myQpYkFS+BaS89qxIawfJZMh60fZtPzH5vBODjaxLLUYG3bUyeRxJAg2hKPDIAzGGeSeTbper3KXKNeuwpAHdDidTjLEnDkONJ3O57OM0LtVN0aFZDLpdDryatrttsjlP03TKizKeA1adJmLc8UgbAbZ8psyyf5bwPJe+fQuv8mrO1feZf8mry4Y7S8lGji9iR8AkgAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"PracticaImg\"\n        title=\"subred-cloud-init\"\n        src=\"/gatsbyjs/static/dd4629213eb774175704f71288f23e39/3e6fd/subred-cloud-init.png\"\n        srcset=\"/gatsbyjs/static/dd4629213eb774175704f71288f23e39/acf4b/subred-cloud-init.png 173w,\n/gatsbyjs/static/dd4629213eb774175704f71288f23e39/fc834/subred-cloud-init.png 345w,\n/gatsbyjs/static/dd4629213eb774175704f71288f23e39/3e6fd/subred-cloud-init.png 530w\"\n        sizes=\"(max-width: 530px) 100vw, 530px\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>Deberemos añadir la valiable de entorno (OS<em>VOLUME</em>API_VERSION) con la versión de la API que vamos a utilizar, por lo que haremos uso del comando:</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">root@debian:/home/fran/Documentos<span class=\"token comment\"># echo \"export OS_VOLUME_API_VERSION=2\" >> Proyecto\\ de\\ francisco.madu-openrc.sh </span></code></pre></div>\n<p>Verificaremos nuestras instancias actuales:</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">fran@debian:~/Documentos$ <span class=\"token builtin class-name\">source</span> ~/.virtualenvs/openstackclient/bin/activate\n<span class=\"token punctuation\">(</span>openstackclient<span class=\"token punctuation\">)</span> fran@debian:~/Documentos$ <span class=\"token builtin class-name\">source</span> Proyecto<span class=\"token punctuation\">\\</span> de<span class=\"token punctuation\">\\</span> francisco.madu-openrc.sh \nPlease enter your OpenStack Password <span class=\"token keyword\">for</span> project Proyecto de francisco.madu as user francisco.madu: \n<span class=\"token punctuation\">(</span>openstackclient<span class=\"token punctuation\">)</span> fran@debian:~/Documentos$ openstack server list\n+--------------------------------------+----------------+--------+-----------------------------------------------------------------------------------------------------------------+--------------------------+-----------+\n<span class=\"token operator\">|</span> ID                                   <span class=\"token operator\">|</span> Name           <span class=\"token operator\">|</span> Status <span class=\"token operator\">|</span> Networks                                                                                                        <span class=\"token operator\">|</span> Image                    <span class=\"token operator\">|</span> Flavor    <span class=\"token operator\">|</span>\n+--------------------------------------+----------------+--------+-----------------------------------------------------------------------------------------------------------------+--------------------------+-----------+\n<span class=\"token operator\">|</span> 3dae141f-1707-478f-a26a-340081eb44a6 <span class=\"token operator\">|</span> Quijote        <span class=\"token operator\">|</span> ACTIVE <span class=\"token operator\">|</span> dmz de francisco.madu<span class=\"token operator\">=</span><span class=\"token number\">10.0</span>.2.4                                                                                  <span class=\"token operator\">|</span> N/A <span class=\"token punctuation\">(</span>booted from volume<span class=\"token punctuation\">)</span> <span class=\"token operator\">|</span> m1.mini   <span class=\"token operator\">|</span>\n<span class=\"token operator\">|</span> 82fa5cde-c13c-486b-86b7-8027c0335207 <span class=\"token operator\">|</span> AnsiblePruebas <span class=\"token operator\">|</span> ACTIVE <span class=\"token operator\">|</span> red de francisco.madu<span class=\"token operator\">=</span><span class=\"token number\">10.0</span>.0.8, <span class=\"token number\">172.22</span>.201.13                                                                   <span class=\"token operator\">|</span> N/A <span class=\"token punctuation\">(</span>booted from volume<span class=\"token punctuation\">)</span> <span class=\"token operator\">|</span> m1.mini   <span class=\"token operator\">|</span>\n<span class=\"token operator\">|</span> 29299b3d-c9de-4b1b-a21b-52a31a41b9ec <span class=\"token operator\">|</span> Sancho         <span class=\"token operator\">|</span> ACTIVE <span class=\"token operator\">|</span> interna francisco.madu<span class=\"token operator\">=</span><span class=\"token number\">10.0</span>.1.10                                                                                <span class=\"token operator\">|</span> N/A <span class=\"token punctuation\">(</span>booted from volume<span class=\"token punctuation\">)</span> <span class=\"token operator\">|</span> m1.mini   <span class=\"token operator\">|</span>\n<span class=\"token operator\">|</span> <span class=\"token number\">90868331</span>-2011-4ee3-97cd-146931dbd536 <span class=\"token operator\">|</span> Freston        <span class=\"token operator\">|</span> ACTIVE <span class=\"token operator\">|</span> interna francisco.madu<span class=\"token operator\">=</span><span class=\"token number\">10.0</span>.1.3                                                                                 <span class=\"token operator\">|</span> N/A <span class=\"token punctuation\">(</span>booted from volume<span class=\"token punctuation\">)</span> <span class=\"token operator\">|</span> m1.mini   <span class=\"token operator\">|</span>\n<span class=\"token operator\">|</span> 4573fbb8-0bd3-4230-85d4-6ae6ab99d543 <span class=\"token operator\">|</span> Dulcinea       <span class=\"token operator\">|</span> ACTIVE <span class=\"token operator\">|</span> dmz de francisco.madu<span class=\"token operator\">=</span><span class=\"token number\">10.0</span>.2.6<span class=\"token punctuation\">;</span> interna francisco.madu<span class=\"token operator\">=</span><span class=\"token number\">10.0</span>.1.7<span class=\"token punctuation\">;</span> red de francisco.madu<span class=\"token operator\">=</span><span class=\"token number\">10.0</span>.0.11, <span class=\"token number\">172.22</span>.201.38 <span class=\"token operator\">|</span> N/A <span class=\"token punctuation\">(</span>booted from volume<span class=\"token punctuation\">)</span> <span class=\"token operator\">|</span> m1.mini   <span class=\"token operator\">|</span>\n<span class=\"token operator\">|</span> 7e3d63eb-114a-47c7-98a1-cc2d6199c36f <span class=\"token operator\">|</span> tareaDjango    <span class=\"token operator\">|</span> ACTIVE <span class=\"token operator\">|</span> red de francisco.madu<span class=\"token operator\">=</span><span class=\"token number\">10.0</span>.0.3, <span class=\"token number\">172.22</span>.200.109                                                                  <span class=\"token operator\">|</span> Debian Buster <span class=\"token number\">10.6</span>       <span class=\"token operator\">|</span> m1.normal <span class=\"token operator\">|</span>\n+--------------------------------------+----------------+--------+-----------------------------------------------------------------------------------------------------------------+--------------------------+-----------+</code></pre></div>\n<p>Procedremos a la eliminación de <strong>Sancho</strong>, el volumen quedará libre y disponible para ser usado mas adelante:</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\"><span class=\"token punctuation\">(</span>openstackclient<span class=\"token punctuation\">)</span> fran@debian:~/Documentos$ openstack server delete Sancho\n<span class=\"token punctuation\">(</span>openstackclient<span class=\"token punctuation\">)</span> fran@debian:~/Documentos$ openstack server show Sancho\nNo server with a name or ID of <span class=\"token string\">'Sancho'</span> exists.</code></pre></div>\n<p>Verificaremos los puestos asociados a <strong>'interna francisco.madu'</strong>:</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\"><span class=\"token punctuation\">(</span>openstackclient<span class=\"token punctuation\">)</span> fran@debian:~/Documentos$ openstack port list --network <span class=\"token string\">'interna francisco.madu'</span>\n+--------------------------------------+------+-------------------+-------------------------------------------------------------------------+--------+\n<span class=\"token operator\">|</span> ID                                   <span class=\"token operator\">|</span> Name <span class=\"token operator\">|</span> MAC Address       <span class=\"token operator\">|</span> Fixed IP Addresses                                                      <span class=\"token operator\">|</span> Status <span class=\"token operator\">|</span>\n+--------------------------------------+------+-------------------+-------------------------------------------------------------------------+--------+\n<span class=\"token operator\">|</span> 2c9b1d47-10ca-479e-b1de-62ed18ccca26 <span class=\"token operator\">|</span>      <span class=\"token operator\">|</span> fa:16:3e:28:3c:7d <span class=\"token operator\">|</span> <span class=\"token assign-left variable\">ip_address</span><span class=\"token operator\">=</span><span class=\"token string\">'10.0.1.1'</span>, <span class=\"token assign-left variable\">subnet_id</span><span class=\"token operator\">=</span><span class=\"token string\">'7877edc3-a5b4-47c2-a0b6-1eb381e7c358'</span> <span class=\"token operator\">|</span> ACTIVE <span class=\"token operator\">|</span>\n<span class=\"token operator\">|</span> 92ab186a-b317-41e5-8bac-315524c18c8b <span class=\"token operator\">|</span>      <span class=\"token operator\">|</span> fa:16:3e:0c:c0:5e <span class=\"token operator\">|</span> <span class=\"token assign-left variable\">ip_address</span><span class=\"token operator\">=</span><span class=\"token string\">'10.0.1.7'</span>, <span class=\"token assign-left variable\">subnet_id</span><span class=\"token operator\">=</span><span class=\"token string\">'7877edc3-a5b4-47c2-a0b6-1eb381e7c358'</span> <span class=\"token operator\">|</span> ACTIVE <span class=\"token operator\">|</span>\n<span class=\"token operator\">|</span> bd2dabad-a368-40c0-9897-765a9311b4fe <span class=\"token operator\">|</span>      <span class=\"token operator\">|</span> fa:16:3e:bf:dd:55 <span class=\"token operator\">|</span> <span class=\"token assign-left variable\">ip_address</span><span class=\"token operator\">=</span><span class=\"token string\">'10.0.1.3'</span>, <span class=\"token assign-left variable\">subnet_id</span><span class=\"token operator\">=</span><span class=\"token string\">'7877edc3-a5b4-47c2-a0b6-1eb381e7c358'</span> <span class=\"token operator\">|</span> ACTIVE <span class=\"token operator\">|</span>\n+--------------------------------------+------+-------------------+-------------------------------------------------------------------------+--------+</code></pre></div>\n<p>Deberemos de crear un nuevo puerto para <strong>Sancho</strong> (10.0.1.10):</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">openstack port create --network <span class=\"token string\">'interna francisco.madu'</span> --fixed-ip <span class=\"token assign-left variable\">subnet</span><span class=\"token operator\">=</span>7877edc3-a5b4-47c2-a0b6-1eb381e7c358,ip-address<span class=\"token operator\">=</span><span class=\"token number\">10.0</span>.1.10 --no-security-group --disable-port-security port-sancho</code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\"><span class=\"token punctuation\">(</span>openstackclient<span class=\"token punctuation\">)</span> fran@debian:~/Documentos$ openstack port create --network <span class=\"token string\">'interna francisco.madu'</span> --fixed-ip <span class=\"token assign-left variable\">subnet</span><span class=\"token operator\">=</span>7877edc3-a5b4-47c2-a0b6-1eb381e7c358,ip-address<span class=\"token operator\">=</span><span class=\"token number\">10.0</span>.1.10 --no-security-group --disable-port-security port-sancho\n+-------------------------+--------------------------------------------------------------------------+\n<span class=\"token operator\">|</span> Field                   <span class=\"token operator\">|</span> Value                                                                    <span class=\"token operator\">|</span>\n+-------------------------+--------------------------------------------------------------------------+\n<span class=\"token operator\">|</span> admin_state_up          <span class=\"token operator\">|</span> UP                                                                       <span class=\"token operator\">|</span>\n<span class=\"token operator\">|</span> allowed_address_pairs   <span class=\"token operator\">|</span>                                                                          <span class=\"token operator\">|</span>\n<span class=\"token operator\">|</span> binding_host_id         <span class=\"token operator\">|</span> None                                                                     <span class=\"token operator\">|</span>\n<span class=\"token operator\">|</span> binding_profile         <span class=\"token operator\">|</span> None                                                                     <span class=\"token operator\">|</span>\n<span class=\"token operator\">|</span> binding_vif_details     <span class=\"token operator\">|</span> None                                                                     <span class=\"token operator\">|</span>\n<span class=\"token operator\">|</span> binding_vif_type        <span class=\"token operator\">|</span> None                                                                     <span class=\"token operator\">|</span>\n<span class=\"token operator\">|</span> binding_vnic_type       <span class=\"token operator\">|</span> normal                                                                   <span class=\"token operator\">|</span>\n<span class=\"token operator\">|</span> created_at              <span class=\"token operator\">|</span> <span class=\"token number\">2021</span>-06-06T08:32:46Z                                                     <span class=\"token operator\">|</span>\n<span class=\"token operator\">|</span> data_plane_status       <span class=\"token operator\">|</span> None                                                                     <span class=\"token operator\">|</span>\n<span class=\"token operator\">|</span> description             <span class=\"token operator\">|</span>                                                                          <span class=\"token operator\">|</span>\n<span class=\"token operator\">|</span> device_id               <span class=\"token operator\">|</span>                                                                          <span class=\"token operator\">|</span>\n<span class=\"token operator\">|</span> device_owner            <span class=\"token operator\">|</span>                                                                          <span class=\"token operator\">|</span>\n<span class=\"token operator\">|</span> dns_assignment          <span class=\"token operator\">|</span> None                                                                     <span class=\"token operator\">|</span>\n<span class=\"token operator\">|</span> dns_domain              <span class=\"token operator\">|</span> None                                                                     <span class=\"token operator\">|</span>\n<span class=\"token operator\">|</span> dns_name                <span class=\"token operator\">|</span> None                                                                     <span class=\"token operator\">|</span>\n<span class=\"token operator\">|</span> extra_dhcp_opts         <span class=\"token operator\">|</span>                                                                          <span class=\"token operator\">|</span>\n<span class=\"token operator\">|</span> fixed_ips               <span class=\"token operator\">|</span> <span class=\"token assign-left variable\">ip_address</span><span class=\"token operator\">=</span><span class=\"token string\">'10.0.1.10'</span>, <span class=\"token assign-left variable\">subnet_id</span><span class=\"token operator\">=</span><span class=\"token string\">'7877edc3-a5b4-47c2-a0b6-1eb381e7c358'</span> <span class=\"token operator\">|</span>\n<span class=\"token operator\">|</span> <span class=\"token function\">id</span>                      <span class=\"token operator\">|</span> 1d31a525-e907-45a0-abbc-610dbd9f8528                                     <span class=\"token operator\">|</span>\n<span class=\"token operator\">|</span> ip_allocation           <span class=\"token operator\">|</span> None                                                                     <span class=\"token operator\">|</span>\n<span class=\"token operator\">|</span> mac_address             <span class=\"token operator\">|</span> fa:16:3e:83:8d:75                                                        <span class=\"token operator\">|</span>\n<span class=\"token operator\">|</span> name                    <span class=\"token operator\">|</span> port-sancho                                                              <span class=\"token operator\">|</span>\n<span class=\"token operator\">|</span> network_id              <span class=\"token operator\">|</span> feb5cf8f-3dab-4073-a09b-33c6c2c8dd79                                     <span class=\"token operator\">|</span>\n<span class=\"token operator\">|</span> numa_affinity_policy    <span class=\"token operator\">|</span> None                                                                     <span class=\"token operator\">|</span>\n<span class=\"token operator\">|</span> port_security_enabled   <span class=\"token operator\">|</span> False                                                                    <span class=\"token operator\">|</span>\n<span class=\"token operator\">|</span> project_id              <span class=\"token operator\">|</span> 2a0efdeba5724b2aa09e7c88e0c8a5bb                                         <span class=\"token operator\">|</span>\n<span class=\"token operator\">|</span> propagate_uplink_status <span class=\"token operator\">|</span> None                                                                     <span class=\"token operator\">|</span>\n<span class=\"token operator\">|</span> qos_network_policy_id   <span class=\"token operator\">|</span> None                                                                     <span class=\"token operator\">|</span>\n<span class=\"token operator\">|</span> qos_policy_id           <span class=\"token operator\">|</span> None                                                                     <span class=\"token operator\">|</span>\n<span class=\"token operator\">|</span> resource_request        <span class=\"token operator\">|</span> None                                                                     <span class=\"token operator\">|</span>\n<span class=\"token operator\">|</span> revision_number         <span class=\"token operator\">|</span> <span class=\"token number\">4</span>                                                                        <span class=\"token operator\">|</span>\n<span class=\"token operator\">|</span> security_group_ids      <span class=\"token operator\">|</span>                                                                          <span class=\"token operator\">|</span>\n<span class=\"token operator\">|</span> status                  <span class=\"token operator\">|</span> DOWN                                                                     <span class=\"token operator\">|</span>\n<span class=\"token operator\">|</span> tags                    <span class=\"token operator\">|</span>                                                                          <span class=\"token operator\">|</span>\n<span class=\"token operator\">|</span> trunk_details           <span class=\"token operator\">|</span> None                                                                     <span class=\"token operator\">|</span>\n<span class=\"token operator\">|</span> updated_at              <span class=\"token operator\">|</span> <span class=\"token number\">2021</span>-06-06T08:32:46Z                                                     <span class=\"token operator\">|</span>\n+-------------------------+--------------------------------------------------------------------------+</code></pre></div>\n<p>Si volvemos listar los puertos podremos ver el nuevo puerto creado,(en mi caso el puerto aparecia DOWN y Alberto tuvo que mediar para activarlo).</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\"><span class=\"token punctuation\">(</span>openstackclient<span class=\"token punctuation\">)</span> fran@debian:~/Documentos$ openstack port list --network <span class=\"token string\">'interna francisco.madu'</span>\n+--------------------------------------+-------------+-------------------+--------------------------------------------------------------------------+--------+\n<span class=\"token operator\">|</span> ID                                   <span class=\"token operator\">|</span> Name        <span class=\"token operator\">|</span> MAC Address       <span class=\"token operator\">|</span> Fixed IP Addresses                                                       <span class=\"token operator\">|</span> Status <span class=\"token operator\">|</span>\n+--------------------------------------+-------------+-------------------+--------------------------------------------------------------------------+--------+\n<span class=\"token operator\">|</span> 1d31a525-e907-45a0-abbc-610dbd9f8528 <span class=\"token operator\">|</span> port-sancho <span class=\"token operator\">|</span> fa:16:3e:83:8d:75 <span class=\"token operator\">|</span> <span class=\"token assign-left variable\">ip_address</span><span class=\"token operator\">=</span><span class=\"token string\">'10.0.1.10'</span>, <span class=\"token assign-left variable\">subnet_id</span><span class=\"token operator\">=</span><span class=\"token string\">'7877edc3-a5b4-47c2-a0b6-1eb381e7c358'</span> <span class=\"token operator\">|</span> DOWN   <span class=\"token operator\">|</span>\n<span class=\"token operator\">|</span> 2c9b1d47-10ca-479e-b1de-62ed18ccca26 <span class=\"token operator\">|</span>             <span class=\"token operator\">|</span> fa:16:3e:28:3c:7d <span class=\"token operator\">|</span> <span class=\"token assign-left variable\">ip_address</span><span class=\"token operator\">=</span><span class=\"token string\">'10.0.1.1'</span>, <span class=\"token assign-left variable\">subnet_id</span><span class=\"token operator\">=</span><span class=\"token string\">'7877edc3-a5b4-47c2-a0b6-1eb381e7c358'</span>  <span class=\"token operator\">|</span> ACTIVE <span class=\"token operator\">|</span>\n<span class=\"token operator\">|</span> 92ab186a-b317-41e5-8bac-315524c18c8b <span class=\"token operator\">|</span>             <span class=\"token operator\">|</span> fa:16:3e:0c:c0:5e <span class=\"token operator\">|</span> <span class=\"token assign-left variable\">ip_address</span><span class=\"token operator\">=</span><span class=\"token string\">'10.0.1.7'</span>, <span class=\"token assign-left variable\">subnet_id</span><span class=\"token operator\">=</span><span class=\"token string\">'7877edc3-a5b4-47c2-a0b6-1eb381e7c358'</span>  <span class=\"token operator\">|</span> ACTIVE <span class=\"token operator\">|</span>\n<span class=\"token operator\">|</span> bd2dabad-a368-40c0-9897-765a9311b4fe <span class=\"token operator\">|</span>             <span class=\"token operator\">|</span> fa:16:3e:bf:dd:55 <span class=\"token operator\">|</span> <span class=\"token assign-left variable\">ip_address</span><span class=\"token operator\">=</span><span class=\"token string\">'10.0.1.3'</span>, <span class=\"token assign-left variable\">subnet_id</span><span class=\"token operator\">=</span><span class=\"token string\">'7877edc3-a5b4-47c2-a0b6-1eb381e7c358'</span>  <span class=\"token operator\">|</span> ACTIVE <span class=\"token operator\">|</span>\n+--------------------------------------+-------------+-------------------+--------------------------------------------------------------------------+--------+</code></pre></div>\n<p>Listaremos nuestros volumenes para poder coger la <strong>ID</strong> del antiguo volumen asociado a <strong>Sancho</strong>:</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\"><span class=\"token punctuation\">(</span>openstackclient<span class=\"token punctuation\">)</span> fran@debian:~/Documentos$ openstack volume list\n+--------------------------------------+---------------------+--------+------+---------------------------------------------------------------+\n<span class=\"token operator\">|</span> ID                                   <span class=\"token operator\">|</span> Name                <span class=\"token operator\">|</span> Status <span class=\"token operator\">|</span> Size <span class=\"token operator\">|</span> Attached to                                                   <span class=\"token operator\">|</span>\n+--------------------------------------+---------------------+--------+------+---------------------------------------------------------------+\n<span class=\"token operator\">|</span> b58cd167-8a8d-46a8-a0bc-517e5f29c933 <span class=\"token operator\">|</span> v4 zfs              <span class=\"token operator\">|</span> in-use <span class=\"token operator\">|</span>    <span class=\"token number\">1</span> <span class=\"token operator\">|</span> Attached to AnsiblePruebas on /dev/vde                        <span class=\"token operator\">|</span>\n<span class=\"token operator\">|</span> 0fc5d06a-824a-48a5-9eed-f666702fc80d <span class=\"token operator\">|</span> v3 zfs              <span class=\"token operator\">|</span> in-use <span class=\"token operator\">|</span>    <span class=\"token number\">1</span> <span class=\"token operator\">|</span> Attached to AnsiblePruebas on /dev/vdd                        <span class=\"token operator\">|</span>\n<span class=\"token operator\">|</span> e344de1f-e878-4ae5-a207-4aec7fd5c190 <span class=\"token operator\">|</span> v2 zfs              <span class=\"token operator\">|</span> in-use <span class=\"token operator\">|</span>    <span class=\"token number\">1</span> <span class=\"token operator\">|</span> Attached to AnsiblePruebas on /dev/vdc                        <span class=\"token operator\">|</span>\n<span class=\"token operator\">|</span> 9f72a5c1-ef4c-48f0-8cff-6d83b03eea01 <span class=\"token operator\">|</span> v1 zfs              <span class=\"token operator\">|</span> in-use <span class=\"token operator\">|</span>    <span class=\"token number\">1</span> <span class=\"token operator\">|</span> Attached to AnsiblePruebas on /dev/vdb                        <span class=\"token operator\">|</span>\n<span class=\"token operator\">|</span> 6a739c5f-1384-4140-a8ee-1fcf85ce0946 <span class=\"token operator\">|</span> Volumen de Quijote  <span class=\"token operator\">|</span> in-use <span class=\"token operator\">|</span>   <span class=\"token number\">10</span> <span class=\"token operator\">|</span> Attached to Quijote on /dev/vda                               <span class=\"token operator\">|</span>\n<span class=\"token operator\">|</span> 09e5684a-723a-4686-8ef1-da85b804a5a1 <span class=\"token operator\">|</span>                     <span class=\"token operator\">|</span> in-use <span class=\"token operator\">|</span>    <span class=\"token number\">5</span> <span class=\"token operator\">|</span> Attached to AnsiblePruebas on /dev/vda                        <span class=\"token operator\">|</span>\n<span class=\"token operator\">|</span> d2a35b12-a105-40e6-a0fc-b10bd43023f0 <span class=\"token operator\">|</span> Volumen de Sancho   <span class=\"token operator\">|</span> in-use <span class=\"token operator\">|</span>   <span class=\"token number\">10</span> <span class=\"token operator\">|</span> Attached to 29299b3d-c9de-4b1b-a21b-52a31a41b9ec on /dev/vda  <span class=\"token operator\">|</span>\n<span class=\"token operator\">|</span> 5e309450-673c-40aa-85bc-f967b122be8d <span class=\"token operator\">|</span> Volumen de Dulcinea <span class=\"token operator\">|</span> in-use <span class=\"token operator\">|</span>   <span class=\"token number\">10</span> <span class=\"token operator\">|</span> Attached to Dulcinea on /dev/vda                              <span class=\"token operator\">|</span>\n<span class=\"token operator\">|</span> f2a13043-2d9b-4f03-8186-8cef3bc7db4a <span class=\"token operator\">|</span> Volumen de Freston  <span class=\"token operator\">|</span> in-use <span class=\"token operator\">|</span>   <span class=\"token number\">10</span> <span class=\"token operator\">|</span> Attached to Freston on /dev/vda                               <span class=\"token operator\">|</span>\n+--------------------------------------+---------------------+--------+------+---------------------------------------------------------------+</code></pre></div>\n<p>Ahora toca configurar nuestro fichero <strong>cloud-config.yaml</strong>, para ello rellenaremos el fichero de la siguiente manera:</p>\n<p><strong>Especificaciones:</strong></p>\n<ul>\n<li>Configuramos los repositorios del CICA y deshabilitamos \"backports\"</li>\n<li>Configuramos adecuadamente el hostname y el FQDN</li>\n<li>Configuramos adecuadamente el cliente NTP con un servidor cercano</li>\n<li>Definimos la zona horaria correcta</li>\n<li>\n<p>Creamos los usuarios \"ubuntu\" (que tendrá contraseña) y \"profesor\" y les permitimos hacer \"sudo\" sin contraseña, así como añadir las claves públicas necesarias.</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\"><span class=\"token punctuation\">(</span>openstackclient<span class=\"token punctuation\">)</span> fran@debian:~/Documentos$ <span class=\"token function\">nano</span> cloud-config.yaml\n<span class=\"token comment\">#cloud-config </span>\napt:\ndisable_suites:\n- backports\nprimary:\n- arches: <span class=\"token punctuation\">[</span>default<span class=\"token punctuation\">]</span>\n  uri: http://archive.ubuntu.com/ubuntu/\nsecurity:\n- arches: <span class=\"token punctuation\">[</span>default<span class=\"token punctuation\">]</span>\n  uri: http://security.ubuntu.com/ubuntu\n<span class=\"token comment\"># </span>\nmanage_etc_hosts: <span class=\"token boolean\">true</span>\nfqdn: sancho.madu.gonzalonazareno.org\nhostname: sancho\n<span class=\"token comment\">#</span>\nntp:\nenabled: <span class=\"token boolean\">true</span>\nntp_client: systemd-timesyncd\nservers:\n- es.pool.ntp.org\n<span class=\"token comment\"># </span>\ntimezone: Europe/Madrid\n<span class=\"token comment\"># hashed_passwd => se obtiene atraves del comando [mkpasswd --method=SHA-512 --rounds=4096] (necesita estar instalador el paquete whois)</span>\nusers:\n- name: ubuntu\nsudo: <span class=\"token assign-left variable\">ALL</span><span class=\"token operator\">=</span><span class=\"token punctuation\">(</span>ALL<span class=\"token punctuation\">)</span> NOPASSWD:ALL\nshell: /bin/bash\nlock_passwd: <span class=\"token boolean\">false</span>\nhashed_passwd: <span class=\"token variable\">$6</span><span class=\"token variable\">$rounds</span><span class=\"token operator\">=</span><span class=\"token number\">4096</span><span class=\"token variable\">$oLDEh24L</span><span class=\"token variable\">$DgaQvLjcmUEd1mf</span>.yVzfgFLpXwneTx3njGQPrfMI1s5o1Swe9V.Y0zAnV2NNF7jVlYu4pThZqkKJAp8A7ur3m/\nssh_authorized_keys:\n  -ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQDObn8DOhTKNI6ofl7o0ZGkvz7Q9VVXmu445nULNB+NPovmYROGut/ZMG543cez/uUbfKq1UJAvQw5AH9lMKaTsBr8VZLqwiSuk7kEOqTZmfocbDFP+Nr1vO+yhegIJiciAw65Aw9/jz/ubS/1Gsw+FIdUEoApg/Hqr0qmi/DXvi8mUzYfTYZ+Y9y0r7PolhULJGdMoTIkuGLjOZm4KUSjjo9Q3k9mJROHTeHyR6FxOzOV3xlDQWAKqmu0wpCrywoupUr5UCLdqcPQMCWTorSt4d3yENGUG3W/u2DwZggzkrHo9ZGzBNYIuNqx8whxR6FVBeBl3n9858Cx2eqW/mmIx Generated-by-Nova\n  -ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQC4c54Ans5kqEEL/qItQT/zyuhUV2nYLeyli7lb+n2mIsuz2UCNggN5njlSR1jg11fsXbQ8FLPRmXK0dml/alFvP6+gZJ7TwDqnZMr8tbLIOh5DumG4SpJYCPQTbAu2COWqJMlFknm1yWK905p0hNbTpvdkjEWmoVa5YQbY8Z/ajreGtVE6htiJJ9dbzXhxucuk6n7/hlwg4GsMox6GeS8CnSkLKdzqCpcrF31yqtbPkXaVuImo4+QvTM81xClk400rUYQz75mNfqDyuMjEapB6AECCPYj7WHVgW8r6vnqFhpCIaz7uh3Pypqv/k8kF7Unz/xfMGwvtuib/m+fMwRhZ fran@debian\n  -ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAACAQCjJLKyf2WmQr7yBO3Sro6/016tk2xWe/cJfc++gkbai9SKGaTn/z+ei8LXQYDlkJbJBeBrgLEaJCzs5b9Whj3Q8GUdTbLBOqTjq7CQ/29rcS1QLCbYcztnKMRBlihARS9KdkTnVQxkBTADqsUmF+vvPBDNfJX4TUA1hGZhL3sIdn9R3U0mIl/oXe8LP8pfuBUYOQGNDi1p+Tb60vCBD5G47CFnzLwoL4eP4qcGpHMvvEujUy4XOe9U1BzFFSzXnNWEuOCEdfE9adE/94J0xszBfRn3WnR+OshUDvexNX9Wa5bhTInjUlyPbYdBkz7rEP8q4Wkhn6OnauZOoz1x5ikjScGWSmZzrFnBDegBhA8verVHXDd73yElbtP3L1REIPbTyIrN1CcDNM6irQr5NPYpwgL7DKjDP8qSxe5yfPVesCrKPtuyO+atyyxVJ+r5BXFQshYz7hGzH1zoKAhTReha3GmFfzf6yDaTeH3wSTtdy1Cll1GMgjwPxpe9YI2YWqSoX2EYCf8SNGf/qnK+VqHfBmBeUHXpkBuQIzWR2Bxq+CtLFfvpF1jziHzTujQUrtnhh0CnqCoyPnpxl7I+M2w8J2BW2wsJNNNgcqIl+xSTJmJT4ZbXamMfQ1zakbZOPNb2Dx+en5slP0UR3sPPM7MKnuVwupslsoTNOWuWYTabpw<span class=\"token operator\">==</span> frandh1997@gmail.com\n- name: profesor\nsudo: <span class=\"token assign-left variable\">ALL</span><span class=\"token operator\">=</span><span class=\"token punctuation\">(</span>ALL<span class=\"token punctuation\">)</span> NOPASSWD:ALL\nshell: /bin/bash\nssh_authorized_keys:\n  - ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQCfk9mRtOHM3T1KpmGi0KiN2uAM6CDXM3WFcm1wkzKXx7RaLtf9pX+KCuVqHdy/N/9d9wtH7iSmLFX/4gQKQVG00jHiGf3ABufWeIpjmHtT1WaI0+vV47fofEIjDDfSZPlI3p5/c7tefHsIAK6GbQn31yepAcFYy9ZfqAh8H/Y5eLpf3egPZn9Czsvx+lm0I8Q+e/HSayRaiAPUukF57N2nnw7yhPZCHSZJqFbXyK3fVQ/UQVBeNS2ayp0my8X9sIBZnNkcYHFLIWBqJYdnu1ZFhnbu3yy94jmJdmELy3+54hqiwFEfjZAjUYSl8eGPixOfdTgc8ObbHbkHyIrQ91Kz rafa@eco\n  - ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQCmjoVIoZCx4QFXvljqozXGqxxlSvO7V2aizqyPgMfGqnyl0J9YXo6zrcWYwyWMnMdRdwYZgHqfiiFCUn2QDm6ZuzC4Lcx0K3ZwO2lgL4XaATykVLneHR1ib6RNroFcClN69cxWsdwQW6dpjpiBDXf8m6/qxVP3EHwUTsP8XaOV7WkcCAqfYAMvpWLISqYme6e+6ZGJUIPkDTxavu5JTagDLwY+py1WB53eoDWsG99gmvyit2O1Eo+jRWN+mgRHIxJTrFtLS6o4iWeshPZ6LvCZ/Pum12Oj4B4bjGSHzrKjHZgTwhVJ/LDq3v71/PP4zaI3gVB9ZalemSxqomgbTlnT jose@debian\n  - ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQC3AUDWjyPANntK+qwHmlJihKQZ1H+AGN02k06dzRHmkvWiNgou/VcCgowhMTGR+0I6nWVwgRSWKJEUEaMu1r9rEeL63GRtUSepCWpClHJG1CuySuJKVGtRdUq+/szDntpJnJW207a78hTeQLjQsyPvbOqkbulQG7xTRCycdT3bH2UO4JI2d+341gkOlxSG/stPQ52Dsbfb274oMRom5r5f2apD3wbfxE9A6qwm4m70G9NYS7T3uKgCiXegO/3GTJD4UbK0ylGUamG5obdS5yD8Ib12vRCCXWav23SAj/4f9MzAnXX8U4ATM/du2FHZBiIzWVH12LYvIEZpUIVYKPSf alberto@roma</code></pre></div>\n</li>\n</ul>\n<p>Crearemos las nueva instancia de Sancho con el siguiente comando:</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\"><span class=\"token punctuation\">(</span>openstackclient<span class=\"token punctuation\">)</span> fran@debian:~/Documentos$ openstack server create --volume d2a35b12-a105-40e6-a0fc-b10bd43023f0 --flavor m1.mini --key-name pardeclaves2asir --security-group default --port port-sancho --user-data cloud-config.yaml Sancho\n+-----------------------------+------------------------------------------------------------------+\n<span class=\"token operator\">|</span> Field                       <span class=\"token operator\">|</span> Value                                                            <span class=\"token operator\">|</span>\n+-----------------------------+------------------------------------------------------------------+\n<span class=\"token operator\">|</span> OS-DCF:diskConfig           <span class=\"token operator\">|</span> MANUAL                                                           <span class=\"token operator\">|</span>\n<span class=\"token operator\">|</span> OS-EXT-AZ:availability_zone <span class=\"token operator\">|</span>                                                                  <span class=\"token operator\">|</span>\n<span class=\"token operator\">|</span> OS-EXT-STS:power_state      <span class=\"token operator\">|</span> NOSTATE                                                          <span class=\"token operator\">|</span>\n<span class=\"token operator\">|</span> OS-EXT-STS:task_state       <span class=\"token operator\">|</span> scheduling                                                       <span class=\"token operator\">|</span>\n<span class=\"token operator\">|</span> OS-EXT-STS:vm_state         <span class=\"token operator\">|</span> building                                                         <span class=\"token operator\">|</span>\n<span class=\"token operator\">|</span> OS-SRV-USG:launched_at      <span class=\"token operator\">|</span> None                                                             <span class=\"token operator\">|</span>\n<span class=\"token operator\">|</span> OS-SRV-USG:terminated_at    <span class=\"token operator\">|</span> None                                                             <span class=\"token operator\">|</span>\n<span class=\"token operator\">|</span> accessIPv4                  <span class=\"token operator\">|</span>                                                                  <span class=\"token operator\">|</span>\n<span class=\"token operator\">|</span> accessIPv6                  <span class=\"token operator\">|</span>                                                                  <span class=\"token operator\">|</span>\n<span class=\"token operator\">|</span> addresses                   <span class=\"token operator\">|</span>                                                                  <span class=\"token operator\">|</span>\n<span class=\"token operator\">|</span> adminPass                   <span class=\"token operator\">|</span> QEbF6YwqnDjS                                                     <span class=\"token operator\">|</span>\n<span class=\"token operator\">|</span> config_drive                <span class=\"token operator\">|</span>                                                                  <span class=\"token operator\">|</span>\n<span class=\"token operator\">|</span> created                     <span class=\"token operator\">|</span> <span class=\"token number\">2021</span>-06-06T19:59:28Z                                             <span class=\"token operator\">|</span>\n<span class=\"token operator\">|</span> flavor                      <span class=\"token operator\">|</span> m1.mini <span class=\"token punctuation\">(</span><span class=\"token number\">12</span><span class=\"token punctuation\">)</span>                                                     <span class=\"token operator\">|</span>\n<span class=\"token operator\">|</span> hostId                      <span class=\"token operator\">|</span>                                                                  <span class=\"token operator\">|</span>\n<span class=\"token operator\">|</span> <span class=\"token function\">id</span>                          <span class=\"token operator\">|</span> 35563e93-78f3-4539-9e34-fca063f1a298                             <span class=\"token operator\">|</span>\n<span class=\"token operator\">|</span> image                       <span class=\"token operator\">|</span> N/A <span class=\"token punctuation\">(</span>booted from volume<span class=\"token punctuation\">)</span>                                         <span class=\"token operator\">|</span>\n<span class=\"token operator\">|</span> key_name                    <span class=\"token operator\">|</span> pardeclaves2asir                                                 <span class=\"token operator\">|</span>\n<span class=\"token operator\">|</span> name                        <span class=\"token operator\">|</span> Sancho                                                           <span class=\"token operator\">|</span>\n<span class=\"token operator\">|</span> progress                    <span class=\"token operator\">|</span> <span class=\"token number\">0</span>                                                                <span class=\"token operator\">|</span>\n<span class=\"token operator\">|</span> project_id                  <span class=\"token operator\">|</span> 2a0efdeba5724b2aa09e7c88e0c8a5bb                                 <span class=\"token operator\">|</span>\n<span class=\"token operator\">|</span> properties                  <span class=\"token operator\">|</span>                                                                  <span class=\"token operator\">|</span>\n<span class=\"token operator\">|</span> security_groups             <span class=\"token operator\">|</span> <span class=\"token assign-left variable\">name</span><span class=\"token operator\">=</span><span class=\"token string\">'530e496f-ed0c-4df9-8b26-01af7413a84a'</span>                      <span class=\"token operator\">|</span>\n<span class=\"token operator\">|</span> status                      <span class=\"token operator\">|</span> BUILD                                                            <span class=\"token operator\">|</span>\n<span class=\"token operator\">|</span> updated                     <span class=\"token operator\">|</span> <span class=\"token number\">2021</span>-06-06T19:59:29Z                                             <span class=\"token operator\">|</span>\n<span class=\"token operator\">|</span> user_id                     <span class=\"token operator\">|</span> 378f01c66b109c988668b2fd6ba83d0148061106dffdb49a229a3f46b252d190 <span class=\"token operator\">|</span>\n<span class=\"token operator\">|</span> volumes_attached            <span class=\"token operator\">|</span> <span class=\"token assign-left variable\">id</span><span class=\"token operator\">=</span><span class=\"token string\">'d2a35b12-a105-40e6-a0fc-b10bd43023f0'</span>                        <span class=\"token operator\">|</span>\n+-----------------------------+------------------------------------------------------------------+¡</code></pre></div>\n<p>¡Listo!, la máquina se encuentra generada y en funcionamiento, procederemos a revisar el estado de la instancia:</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">debian@dulcinea:~$ <span class=\"token function\">ssh</span> ubuntu@sancho\nubuntu@sancho's password: \nWelcome to Ubuntu <span class=\"token number\">20.04</span>.2 LTS <span class=\"token punctuation\">(</span>GNU/Linux <span class=\"token number\">5.4</span>.0-74-generic x86_64<span class=\"token punctuation\">)</span>\n\n * Documentation:  https://help.ubuntu.com\n * Management:     https://landscape.canonical.com\n * Support:        https://ubuntu.com/advantage\n\n  System information as of Sun Jun  <span class=\"token number\">6</span> <span class=\"token number\">22</span>:04:50 CEST <span class=\"token number\">2021</span>\n\n  System load:  <span class=\"token number\">0.02</span>              Processes:             <span class=\"token number\">106</span>\n  Usage of /:   <span class=\"token number\">31.1</span>% of <span class=\"token number\">9</span>.52GB   Users logged in:       <span class=\"token number\">0</span>\n  Memory usage: <span class=\"token number\">50</span>%               IPv4 address <span class=\"token keyword\">for</span> ens3: <span class=\"token number\">10.0</span>.1.10\n  Swap usage:   <span class=\"token number\">0</span>%\n\n * Super-optimized <span class=\"token keyword\">for</span> small spaces - <span class=\"token builtin class-name\">read</span> how we shrank the memory\n   footprint of MicroK8s to <span class=\"token function\">make</span> it the smallest full K8s around.\n\n   https://ubuntu.com/blog/microk8s-memory-optimisation\n\n<span class=\"token number\">68</span> updates can be installed immediately.\n<span class=\"token number\">0</span> of these updates are security updates.\nTo see these additional updates run: <span class=\"token function\">apt</span> list --upgradable\n\n\nLast login: Wed Jun  <span class=\"token number\">2</span> <span class=\"token number\">13</span>:30:16 <span class=\"token number\">2021</span> from <span class=\"token number\">10.0</span>.1.7\nubuntu@sancho:~$ </code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">ubuntu@sancho:~$ <span class=\"token function\">ip</span> a\n<span class=\"token number\">1</span>: lo: <span class=\"token operator\">&lt;</span>LOOPBACK,UP,LOWER_UP<span class=\"token operator\">></span> mtu <span class=\"token number\">65536</span> qdisc noqueue state UNKNOWN group default qlen <span class=\"token number\">1000</span>\n    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00\n    inet <span class=\"token number\">127.0</span>.0.1/8 scope <span class=\"token function\">host</span> lo\n       valid_lft forever preferred_lft forever\n    inet6 ::1/128 scope <span class=\"token function\">host</span> \n       valid_lft forever preferred_lft forever\n<span class=\"token number\">2</span>: ens3: <span class=\"token operator\">&lt;</span>BROADCAST,MULTICAST,UP,LOWER_UP<span class=\"token operator\">></span> mtu <span class=\"token number\">8950</span> qdisc fq_codel state UP group default qlen <span class=\"token number\">1000</span>\n    link/ether fa:16:3e:83:8d:75 brd ff:ff:ff:ff:ff:ff\n    inet <span class=\"token number\">10.0</span>.1.10/24 brd <span class=\"token number\">10.0</span>.1.255 scope global dynamic ens3\n       valid_lft 86070sec preferred_lft 86070sec\n    inet6 fe80::f816:3eff:fe83:8d75/64 scope <span class=\"token function\">link</span> \n       valid_lft forever preferred_lft forever\n<span class=\"token comment\">#</span>\nubuntu@sancho:~$ <span class=\"token function\">ip</span> r\n<span class=\"token number\">10.0</span>.1.0/24 dev ens3 proto kernel scope <span class=\"token function\">link</span> src <span class=\"token number\">10.0</span>.1.10 \n<span class=\"token number\">169.254</span>.169.254 via <span class=\"token number\">10.0</span>.1.1 dev ens3 proto dhcp src <span class=\"token number\">10.0</span>.1.10 metric <span class=\"token number\">100</span> </code></pre></div>\n<p>Como podemos apreciar la interfaz tiene configurada la dirección 10.0.1.10 que ha sido obtenida por DHCP y por otro lado no tiene puerta de enlace predeterminada(no tiene conectividad externa).</p>\n<p>Ambos problemas son debidos a que en el fichero cloud-config.yaml no hemos establecido ninguna configuración referente a la red.</p>\n<p>Para solucionarlo deberemos de crear un fichero de configuración red (como teniamos creado anteriormente):</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">ubuntu@sancho:~$ <span class=\"token function\">nano</span> /etc/cloud/cloud.cfg.d/50-curtin-networking.cfg\nnetwork:\n    version: <span class=\"token number\">2</span>\n    ethernets:\n        ens3:\n            dhcp4: <span class=\"token boolean\">false</span>\n            match:\n                macaddress: fa:16:3e:83:8d:75\n            mtu: <span class=\"token number\">8950</span>\n            set-name: ens3\n            addresses: <span class=\"token punctuation\">[</span><span class=\"token number\">10.0</span>.1.10/24<span class=\"token punctuation\">]</span>\n            gateway4: <span class=\"token number\">10.0</span>.1.7\n            nameservers:\n                addresses: <span class=\"token punctuation\">[</span><span class=\"token number\">10.0</span>.1.3, <span class=\"token number\">192.168</span>.202.2, <span class=\"token number\">192.168</span>.200.2<span class=\"token punctuation\">]</span>\n                search: <span class=\"token punctuation\">[</span><span class=\"token string\">\"madu.gonzalonazareno.org\"</span><span class=\"token punctuation\">]</span></code></pre></div>\n<p>Para guardar y aplicar los cambios, cargaremos nuevamente la configuración establecida de <strong>cloud-init</strong>:</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">ubuntu@sancho:~$ <span class=\"token function\">sudo</span> cloud-init clean -r\nConnection to sancho closed by remote host.\nConnection to sancho closed.</code></pre></div>\n<h3 id=\"pruebas-de-funcionamiento\"><a href=\"#pruebas-de-funcionamiento\" aria-label=\"pruebas de funcionamiento permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Pruebas de funcionamiento.</h3>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">ubuntu@sancho:~$ <span class=\"token function\">ip</span> a\n<span class=\"token number\">1</span>: lo: <span class=\"token operator\">&lt;</span>LOOPBACK,UP,LOWER_UP<span class=\"token operator\">></span> mtu <span class=\"token number\">65536</span> qdisc noqueue state UNKNOWN group default qlen <span class=\"token number\">1000</span>\n    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00\n    inet <span class=\"token number\">127.0</span>.0.1/8 scope <span class=\"token function\">host</span> lo\n       valid_lft forever preferred_lft forever\n    inet6 ::1/128 scope <span class=\"token function\">host</span> \n       valid_lft forever preferred_lft forever\n<span class=\"token number\">2</span>: ens3: <span class=\"token operator\">&lt;</span>BROADCAST,MULTICAST,UP,LOWER_UP<span class=\"token operator\">></span> mtu <span class=\"token number\">8950</span> qdisc fq_codel state UP group default qlen <span class=\"token number\">1000</span>\n    link/ether fa:16:3e:83:8d:75 brd ff:ff:ff:ff:ff:ff\n    inet <span class=\"token number\">10.0</span>.1.10/24 brd <span class=\"token number\">10.0</span>.1.255 scope global ens3\n       valid_lft forever preferred_lft forever\n    inet6 fe80::f816:3eff:fe83:8d75/64 scope <span class=\"token function\">link</span> \n       valid_lft forever preferred_lft forever\nubuntu@sancho:~$ <span class=\"token function\">ip</span> r\ndefault via <span class=\"token number\">10.0</span>.1.7 dev ens3 proto static \n<span class=\"token number\">10.0</span>.1.0/24 dev ens3 proto kernel scope <span class=\"token function\">link</span> src <span class=\"token number\">10.0</span>.1.10 </code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">ubuntu@sancho:~$ <span class=\"token function\">cat</span> /etc/netplan/50-cloud-init.yaml\n<span class=\"token comment\"># This file is generated from information provided by the datasource.  Changes</span>\n<span class=\"token comment\"># to it will not persist across an instance reboot.  To disable cloud-init's</span>\n<span class=\"token comment\"># network configuration capabilities, write a file</span>\n<span class=\"token comment\"># /etc/cloud/cloud.cfg.d/99-disable-network-config.cfg with the following:</span>\n<span class=\"token comment\"># network: {config: disabled}</span>\nnetwork:\n    ethernets:\n        ens3:\n            addresses:\n            - <span class=\"token number\">10.0</span>.1.10/24\n            dhcp4: <span class=\"token boolean\">false</span>\n            gateway4: <span class=\"token number\">10.0</span>.1.7\n            match:\n                macaddress: fa:16:3e:83:8d:75\n            mtu: <span class=\"token number\">8950</span>\n            nameservers:\n                addresses:\n                - <span class=\"token number\">10.0</span>.1.3\n                - <span class=\"token number\">192.168</span>.202.2\n                - <span class=\"token number\">192.168</span>.200.2\n                search:\n                - madu.gonzalonazareno.org\n            set-name: ens3\n    version: <span class=\"token number\">2</span></code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">ubuntu@sancho:~$ <span class=\"token function\">cat</span> /etc/resolv.conf\nnameserver <span class=\"token number\">127.0</span>.0.53\noptions edns0 trust-ad\nsearch madu.gonzalonazareno.org</code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">ubuntu@sancho:~$ <span class=\"token function\">cat</span> /etc/hostname \nsancho\nubuntu@sancho:~$ <span class=\"token function\">cat</span> /etc/hosts\n<span class=\"token comment\"># Your system has configured 'manage_etc_hosts' as True.</span>\n<span class=\"token comment\"># As a result, if you wish for changes to this file to persist</span>\n<span class=\"token comment\"># then you will need to either</span>\n<span class=\"token comment\"># a.) make changes to the master file in /etc/cloud/templates/hosts.debian.tmpl</span>\n<span class=\"token comment\"># b.) change or remove the value of 'manage_etc_hosts' in</span>\n<span class=\"token comment\">#     /etc/cloud/cloud.cfg or cloud-config from user-data</span>\n<span class=\"token comment\">#</span>\n<span class=\"token number\">127.0</span>.1.1 sancho.madu.gonzalonazareno.org sancho\n<span class=\"token number\">127.0</span>.0.1 localhost\n\n<span class=\"token comment\"># The following lines are desirable for IPv6 capable hosts</span>\n::1 ip6-localhost ip6-loopback\nfe00::0 ip6-localnet\nff00::0 ip6-mcastprefix\nff02::1 ip6-allnodes\nff02::2 ip6-allrouters\nff02::3 ip6-allhosts</code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">ubuntu@sancho:~$ <span class=\"token function\">ping</span> google.es\nPING google.es <span class=\"token punctuation\">(</span><span class=\"token number\">142.250</span>.200.67<span class=\"token punctuation\">)</span> <span class=\"token number\">56</span><span class=\"token punctuation\">(</span><span class=\"token number\">84</span><span class=\"token punctuation\">)</span> bytes of data.\n<span class=\"token number\">64</span> bytes from mad07s24-in-f3.1e100.net <span class=\"token punctuation\">(</span><span class=\"token number\">142.250</span>.200.67<span class=\"token punctuation\">)</span>: <span class=\"token assign-left variable\">icmp_seq</span><span class=\"token operator\">=</span><span class=\"token number\">1</span> <span class=\"token assign-left variable\">ttl</span><span class=\"token operator\">=</span><span class=\"token number\">111</span> <span class=\"token assign-left variable\">time</span><span class=\"token operator\">=</span><span class=\"token number\">42.9</span> ms\n<span class=\"token number\">64</span> bytes from mad07s24-in-f3.1e100.net <span class=\"token punctuation\">(</span><span class=\"token number\">142.250</span>.200.67<span class=\"token punctuation\">)</span>: <span class=\"token assign-left variable\">icmp_seq</span><span class=\"token operator\">=</span><span class=\"token number\">2</span> <span class=\"token assign-left variable\">ttl</span><span class=\"token operator\">=</span><span class=\"token number\">111</span> <span class=\"token assign-left variable\">time</span><span class=\"token operator\">=</span><span class=\"token number\">42.7</span> ms\n<span class=\"token number\">64</span> bytes from mad07s24-in-f3.1e100.net <span class=\"token punctuation\">(</span><span class=\"token number\">142.250</span>.200.67<span class=\"token punctuation\">)</span>: <span class=\"token assign-left variable\">icmp_seq</span><span class=\"token operator\">=</span><span class=\"token number\">3</span> <span class=\"token assign-left variable\">ttl</span><span class=\"token operator\">=</span><span class=\"token number\">111</span> <span class=\"token assign-left variable\">time</span><span class=\"token operator\">=</span><span class=\"token number\">43.5</span> ms\n<span class=\"token number\">64</span> bytes from mad07s24-in-f3.1e100.net <span class=\"token punctuation\">(</span><span class=\"token number\">142.250</span>.200.67<span class=\"token punctuation\">)</span>: <span class=\"token assign-left variable\">icmp_seq</span><span class=\"token operator\">=</span><span class=\"token number\">4</span> <span class=\"token assign-left variable\">ttl</span><span class=\"token operator\">=</span><span class=\"token number\">111</span> <span class=\"token assign-left variable\">time</span><span class=\"token operator\">=</span><span class=\"token number\">43.3</span> ms\n<span class=\"token number\">64</span> bytes from mad07s24-in-f3.1e100.net <span class=\"token punctuation\">(</span><span class=\"token number\">142.250</span>.200.67<span class=\"token punctuation\">)</span>: <span class=\"token assign-left variable\">icmp_seq</span><span class=\"token operator\">=</span><span class=\"token number\">5</span> <span class=\"token assign-left variable\">ttl</span><span class=\"token operator\">=</span><span class=\"token number\">111</span> <span class=\"token assign-left variable\">time</span><span class=\"token operator\">=</span><span class=\"token number\">42.9</span> ms\n^C\n--- google.es <span class=\"token function\">ping</span> statistics ---\n<span class=\"token number\">5</span> packets transmitted, <span class=\"token number\">5</span> received, <span class=\"token number\">0</span>% packet loss, <span class=\"token function\">time</span> 5915ms\nrtt min/avg/max/mdev <span class=\"token operator\">=</span> <span class=\"token number\">42.686</span>/43.046/43.452/0.282 ms</code></pre></div>\n<p>Sancho no esta autorizado a hacer ping entre maquinas como ya explicamos en la tarea de <a href=\"https://franmadu6.github.io/gatsbyjs/sad-cortafuegos-open-stack\">Cortafuegos</a></p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">ubuntu@sancho:~$ <span class=\"token function\">ping</span> dulcinea\nPING dulcinea.madu.gonzalonazareno.org <span class=\"token punctuation\">(</span><span class=\"token number\">10.0</span>.1.7<span class=\"token punctuation\">)</span> <span class=\"token number\">56</span><span class=\"token punctuation\">(</span><span class=\"token number\">84</span><span class=\"token punctuation\">)</span> bytes of data.\n^C\n--- dulcinea.madu.gonzalonazareno.org <span class=\"token function\">ping</span> statistics ---\n<span class=\"token number\">53</span> packets transmitted, <span class=\"token number\">0</span> received, <span class=\"token number\">100</span>% packet loss, <span class=\"token function\">time</span> 53247ms</code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">ubuntu@sancho:~$ <span class=\"token function\">ssh</span> debian@freston\nThe authenticity of <span class=\"token function\">host</span> <span class=\"token string\">'freston (10.0.1.3)'</span> can<span class=\"token string\">'t be established.\nECDSA key fingerprint is SHA256:B0DAB9uCeMpOu0ZYFOKLmc8BzFPEoxGY7WMBoncGE0w.\nAre you sure you want to continue connecting (yes/no/[fingerprint])? yes\nWarning: Permanently added '</span>freston,10.0.1.3<span class=\"token string\">' (ECDSA) to the list of known hosts.\ndebian@freston'</span>s password: \nLinux freston <span class=\"token number\">4.19</span>.0-16-cloud-amd64 <span class=\"token comment\">#1 SMP Debian 4.19.181-1 (2021-03-19) x86_64</span>\n\nThe programs included with the Debian GNU/Linux system are <span class=\"token function\">free</span> software<span class=\"token punctuation\">;</span>\nthe exact distribution terms <span class=\"token keyword\">for</span> each program are described <span class=\"token keyword\">in</span> the\nindividual files <span class=\"token keyword\">in</span> /usr/share/doc/*/copyright.\n\nDebian GNU/Linux comes with ABSOLUTELY NO WARRANTY, to the extent\npermitted by applicable law.\nLast login: Sun Jun  <span class=\"token number\">6</span> <span class=\"token number\">10</span>:57:03 <span class=\"token number\">2021</span> from <span class=\"token number\">10.0</span>.1.7\ndebian@freston:~$ </code></pre></div>\n<p>Como hemos podido comprobar ya tenemos la instancia correctamente configurada y en funcionamiento creada nuevamente con <strong>cloud-init</strong>.</p>","timeToRead":20,"excerpt":"PracticaImg cloud-init se define como el estándar para personalizar instancias cloud. Las imágenes para las instancias cloud empiezan siendo…","frontmatter":{"title":"Utilización de cloud-init","cover":"https://img.icons8.com/ios/452/work.png","date":"2021-5-27","categories":["HLC"],"tags":["Cloud-init","OpenStack"]},"fields":{"slug":"/utilizacion-de-cloud-init","date":"May 26, 2021"}}},"pageContext":{"slug":"/utilizacion-de-cloud-init","nexttitle":"Usuarios, grupos y ACLs en LDAP","nextslug":"/usuarios-grupos-y-ac-ls-en-ldap","prevtitle":"iSCSI","prevslug":"/i-scsi"}}}