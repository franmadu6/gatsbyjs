{"componentChunkName":"component---src-templates-post-js","path":"/actualizacion-de-quijote-a-cent-os-8","result":{"data":{"markdownRemark":{"html":"<h2 id=\"actualiza-la-instancia-quijote-a-centos-8-garantizando-que-todos-los-servicios-previos-continúen-funcionando-y-detalla-en-la-tarea-los-aspectos-más-relevantes\"><a href=\"#actualiza-la-instancia-quijote-a-centos-8-garantizando-que-todos-los-servicios-previos-contin%C3%BAen-funcionando-y-detalla-en-la-tarea-los-aspectos-m%C3%A1s-relevantes\" aria-label=\"actualiza la instancia quijote a centos 8 garantizando que todos los servicios previos continúen funcionando y detalla en la tarea los aspectos más relevantes permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Actualiza la instancia quijote a CentOS 8 garantizando que todos los servicios previos continúen funcionando y detalla en la tarea los aspectos más relevantes.</h2>\n<ul>\n<li>En el caso de que la instancia no sea recuperable en algún punto, se tiene que volver a crear una instancia de CentOS 7 y realizar la actualización de nuevo. Lo recomendable en este caso sería crear una instantánea de volumen antes de comenzar y en el caso de tener un error irrecuperable, crear un nuevo volumen a partir de la instantánea, eliminar la instancia quijote y crear una nueva con el nuevo volumen. Una vez arrancada la nueva instancia se puede eliminar el antiguo volumen y las instantáneas asociadas.</li>\n<li>Nota: Aunque aparezca una advertencia de que se puede corromper el volumen al crear una instantánea cuando está en uso, se supone que LVM (el sistema sobre el que se está usando los volúmenes en este caso) soporta la creación de instantáneas en caliente (se supone ;) )</li>\n</ul>\n<p>El primer paso que debemos dar es comprobar los repositorios epel de nuestra maquina.</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">yum <span class=\"token function\">install</span> epel-release -y</code></pre></div>\n<p>Instalamos las herramientas yum-utils.</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">yum <span class=\"token function\">install</span> yum-utils</code></pre></div>\n<p>Instalamos rpmconf, lo usaremos para verificar confilctos en ficheros de configuración.</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">yum <span class=\"token function\">install</span> rpmconf</code></pre></div>\n<p>Si queremos instalar la nueva versión del fichero de configuración.</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">rpmconf -a</code></pre></div>\n<p>Limpiamos los paquetes no necesarios:</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">package-cleanup --leaves\npackage-cleanup --orphans</code></pre></div>\n<p>Instalamos el gestor de paquetes <strong>dnf</strong>.</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">yum <span class=\"token function\">install</span> dnf</code></pre></div>\n<p>Los dos gestores de paquetes pueden convivir, pero es mejor que nos quedemos solo con dnf (y eliminamos yum, las dependencias y su directorio):</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">dnf -y remove yum yum-metadata-parser\n<span class=\"token function\">rm</span> -Rf /etc/yum</code></pre></div>\n<p>Comenzamos con la actualización de versión, de CentOS7 a CentOS8 y resolvemos los problemas con los paquetes al actualizar a CentOS8.</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">dnf upgrade</code></pre></div>\n<p>si tenemos errores del estilo: \"el archivo <strong>* entra en conflicto con el archivo del paquete *</strong>\".</p>\n<p>podemos intentar la actualización con la opción –allowerasing, que sirve para reemplazar automáticamente los paquetes con conflictos:</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">dnf upgrade --best --allowerasing</code></pre></div>\n<p>o usando la opción –skip-broken para eliminar los paquetes problemáticos:</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">dnf upgrade --best --allowerasing --skip-broken</code></pre></div>\n<p>Si tenemos algun problema con dependencias de algun paquete las borramos manualmente y (ej:dnf remove python3) y volvemos a upgradear con dnf.</p>\n<p>A continuación ya podemos instalar el paquete de lanzamiento de Centos8:</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">dnf <span class=\"token function\">install</span> http://mirror.centos.org/centos/8/BaseOS/x86_64/os/Packages/centos-linux-repos-8-2.el8.noarch.rpm http://mirror.centos.org/centos/8/BaseOS/x86_64/os/Packages/centos-linux-release-8.3-1.2011.el8.noarch.rpm http://mirror.centos.org/centos/8/BaseOS/x86_64/os/Packages/centos-gpg-keys-8-2.el8.noarch.rpm</code></pre></div>\n<p>Actualizamos el repositorio EPEL.</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">dnf -y upgrade https://dl.fedoraproject.org/pub/epel/epel-release-latest-8.noarch.rpm</code></pre></div>\n<p>Eliminamos los ficheros temporales.</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">dnf clean all</code></pre></div>\n<hr>\n<p><strong>Eliminamos el viejo kernel para CentOS7 e instalaremos el nuevo kernel para CentOS8</strong></p>\n<p>y ahora eliminamos el núcleo antiguo del kernel de CentOS 7 (si en este paso tenemos errores, realmente seguirá instalado el kernel de centos 7 y no habremos instalado el kernel de centos 8):</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\"><span class=\"token function\">rpm</span> -e <span class=\"token variable\"><span class=\"token variable\">`</span><span class=\"token function\">rpm</span> -q kernel<span class=\"token variable\">`</span></span></code></pre></div>\n<p>Eliminamos paquetes conflictivos (como las herramientas systemv):</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\"><span class=\"token function\">rpm</span> -e --nodeps sysvinit-tools</code></pre></div>\n<p>Si recibimos errores al ejecutar el comando anterior para eliminar el kernel :</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\"><span class=\"token function\">rpm</span> -e <span class=\"token variable\"><span class=\"token variable\">`</span><span class=\"token function\">rpm</span> -q kernel<span class=\"token variable\">`</span></span></code></pre></div>\n<p>comprobamos si seguimos teniendo errores y conflictos en paquetes; si es así, procuraremos eliminarlos para evitar los problemas (aunque en algunos casos esto es una solución muy arriesgada, sobre todo en servidores en producción).</p>\n<p>Otra opción es intentar eliminar el kernel viejo así:</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">dnf remove --oldinstallonly --setopt <span class=\"token assign-left variable\">installonly_limit</span><span class=\"token operator\">=</span><span class=\"token number\">1</span> kernel</code></pre></div>\n<p>o simplemente así:</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">dnf remove kernel</code></pre></div>\n<hr>\n<p><strong>Comenzamos la actualización a Centos8</strong></p>\n<p>Lanzamos actualización del sistema a Centos8:</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">dnf -y --releasever<span class=\"token operator\">=</span><span class=\"token number\">8</span> --allowerasing --setopt<span class=\"token operator\">=</span>deltarpm<span class=\"token operator\">=</span>false distro-sync</code></pre></div>\n<p>Si nos encontramos con algunos errores tambien podemos ejecutar:</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">dnf -y --releasever<span class=\"token operator\">=</span><span class=\"token number\">8</span> --allowerasing --skip-broken --setopt<span class=\"token operator\">=</span>deltarpm<span class=\"token operator\">=</span>false distro-sync</code></pre></div>\n<hr>\n<p><strong>Instalamos el nuevo kernel para Centos8</strong></p>\n<p>Ejecutamos instalación del kernel</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">dnf -y <span class=\"token function\">install</span> kernel-core</code></pre></div>\n<p>Aunque puede no ser necesario, si queremos estar seguros de que está instalado de forma correcta, primero lo desinstalamos y lo volvemos a instalar</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\"><span class=\"token function\">rpm</span> -e kernel-core\ndnf -y <span class=\"token function\">install</span> kernel-core</code></pre></div>\n<p>Si nuevamente tenemos problemas ejecutaremos:</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">dnf -y <span class=\"token function\">install</span> kernel-core --best --allowerasing --skip-broken</code></pre></div>\n<p>Si no hemos hemos ejecutado los comandos y no hemos tenido mas problemas daremos por hecho que el kernel que tenemos ahora es de Centos8.</p>\n<hr>\n<p><strong>Instalamos el paquete minimal de CentOS8 y actualizamos grupos</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">dnf -y groupupdate <span class=\"token string\">\"Core\"</span> <span class=\"token string\">\"Minimal Install\"</span></code></pre></div>\n<p>Si tuvimos problemas:</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">dnf -y groupupdate <span class=\"token string\">\"Core\"</span> <span class=\"token string\">\"Minimal Install\"</span> --allowerasing --skip-broken</code></pre></div>\n<p>Si tenemos problemas con los paquetes de yum en este punto deberemos volver atras, en la parte donde borramos <strong>yum</strong>. Al borrarlo este error desaparecerá.</p>\n<hr>\n<p><strong>Comprobación de que Centos8 y su kernel están instalados correctamente</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\"><span class=\"token punctuation\">[</span>centos@quijote ~<span class=\"token punctuation\">]</span>$ <span class=\"token function\">cat</span> /etc/os-release\n<span class=\"token assign-left variable\">NAME</span><span class=\"token operator\">=</span><span class=\"token string\">\"CentOS Linux\"</span>\n<span class=\"token assign-left variable\">VERSION</span><span class=\"token operator\">=</span><span class=\"token string\">\"8\"</span>\n<span class=\"token assign-left variable\">ID</span><span class=\"token operator\">=</span><span class=\"token string\">\"centos\"</span>\n<span class=\"token assign-left variable\">ID_LIKE</span><span class=\"token operator\">=</span><span class=\"token string\">\"rhel fedora\"</span>\n<span class=\"token assign-left variable\">VERSION_ID</span><span class=\"token operator\">=</span><span class=\"token string\">\"8\"</span>\n<span class=\"token assign-left variable\">PLATFORM_ID</span><span class=\"token operator\">=</span><span class=\"token string\">\"platform:el8\"</span>\n<span class=\"token assign-left variable\">PRETTY_NAME</span><span class=\"token operator\">=</span><span class=\"token string\">\"CentOS Linux 8\"</span>\n<span class=\"token assign-left variable\">ANSI_COLOR</span><span class=\"token operator\">=</span><span class=\"token string\">\"0;31\"</span>\n<span class=\"token assign-left variable\">CPE_NAME</span><span class=\"token operator\">=</span><span class=\"token string\">\"cpe:/o:centos:centos:8\"</span>\n<span class=\"token assign-left variable\">HOME_URL</span><span class=\"token operator\">=</span><span class=\"token string\">\"https://centos.org/\"</span>\n<span class=\"token assign-left variable\">BUG_REPORT_URL</span><span class=\"token operator\">=</span><span class=\"token string\">\"https://bugs.centos.org/\"</span>\n<span class=\"token assign-left variable\">CENTOS_MANTISBT_PROJECT</span><span class=\"token operator\">=</span><span class=\"token string\">\"CentOS-8\"</span>\n<span class=\"token assign-left variable\">CENTOS_MANTISBT_PROJECT_VERSION</span><span class=\"token operator\">=</span><span class=\"token string\">\"8\"</span>\n\n<span class=\"token punctuation\">[</span>centos@quijote ~<span class=\"token punctuation\">]</span>$ <span class=\"token function\">cat</span> /etc/redhat-release\nCentOS Linux release <span class=\"token number\">8.3</span>.2011\n\n<span class=\"token punctuation\">[</span>centos@quijote ~<span class=\"token punctuation\">]</span>$ <span class=\"token function\">uname</span> -r\n<span class=\"token number\">4.18</span>.0-240.10.1.el8_3.x86_64</code></pre></div>\n<p>¡Listo! ya tenemos upgradeada nuestra maquina a <strong>Centos8</strong>.</p>","timeToRead":5,"excerpt":"Actualiza la instancia quijote a CentOS 8 garantizando que todos los servicios previos continúen funcionando y detalla en la tarea los…","frontmatter":{"title":"Actualización de quijote a CentOS8","cover":"https://img.icons8.com/ios/452/work.png","date":"2020-11-27T00:00:00.000Z","categories":["ASO"],"tags":["OpenStack","CentOS","Actualización"]},"fields":{"slug":"/actualizacion-de-quijote-a-cent-os-8","date":"November 26, 2020"}}},"pageContext":{"slug":"/actualizacion-de-quijote-a-cent-os-8","nexttitle":"Práctica: Servidor DNS","nextslug":"/practica-servidor-dns","prevtitle":"Instalación y configuración de Servidores y Clientes","prevslug":"/instalacion-y-configuracion-de-servidores-y-clientes"}}}