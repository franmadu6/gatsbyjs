{"componentChunkName":"component---src-templates-post-js","path":"/iaw-p-1-instalacion-local-de-un-cms-php","result":{"data":{"markdownRemark":{"html":"<p>h1. Tarea 1: Instalación de un servidor LAMP</p>\n<p>1.- Crea una instancia de vagrant basado en un box debian o ubuntu</p>\n<pre>\n# -*- mode: ruby -*-\n# vi: set ft=ruby :\n\nVagrant.configure(\"2\") do |config|\n\n  config.vm.box = \"debian/buster64\"\n  config.vm.hostname = \"drupal\"\n  config.vm.network \"private_network\", ip: \"192.168.100.5\"\n\nend\n\n</pre>\n<p>2.- Instala en esa máquina virtual toda la pila LAMP</p>\n<pre>\n#Instalamos apache2 y apache2-utils\nsudo apt-get install -y apache2 apache2-utils\n#Instalamos el servidor y el cliente de mariadb\nsudo apt-get install -y mariadb-server mariadb-client\n#los dos pasos anteriores puede que ya vengan instalados por defecto\n#Instalamos php y los módulos necesarios y recomendables de php\nsudo apt-get install php libapache2-mod-php php-cli php-fpm php-json php-pdo php-mysql php-zip php-gd  php-mbstring php-curl php-xml php-pear php-bcmath\n</pre>\n<p>h1. Tarea 2: Instalación de drupal en mi servidor local</p>\n<p>1.- Configura el servidor web con virtual hosting para que el CMS sea accesible desde la dirección: www.nombrealumno-drupal.org.</p>\n<pre>\nServerName www.madu-drupal.org\n</pre>\n<p>2.- Crea un usuario en la base de datos para trabajar con la base de datos donde se van a guardar los datos del CMS.</p>\n<pre>\nvagrant@drupal:~$ sudo mysql -u root -p\n\nMariaDB [(none)]> create user 'fmadu' identified by 'dios';\nQuery OK, 0 rows affected (0.005 sec)\n\nMariaDB [(none)]> GRANT ALL PRIVILEGES ON *.* TO 'fmadu'@'localhost'\n    -> IDENTIFIED BY 'dios' WITH GRANT OPTION;\nQuery OK, 0 rows affected (0.001 sec)\n\nMariaDB [(none)]> exit\nBye\nvagrant@drupal:~$ mysql -u fmadu -p\n\nMariaDB [(none)]> create database fmadudb;\nQuery OK, 1 row affected (0.002 sec)\n</pre>\n<p>3.- Descarga la versión que te parezca más oportuna de Drupal y realiza la instalación.</p>\n<p>**  Descargamos drupal de la web oficial,(la ultima version)</p>\n<pre>\nvagrant@drupal:/etc/apache2/sites-available$ sudo wget https://www.drupal.org/download-latest/zip\n</pre>\n<p>** Creamos el directorio drupal en /var/www/, descomprimimos el fichero descargado y copiamos su contenido en dicho directorio</p>\n<pre>\nsudo mkdir /var/www/drupal\nsudo apt install unzip\nsudo unzip zip\nsudo mv drupal-9.0.7/* /var/www/drupal\n</pre>\n<ul>\n<li>\n<p>En /var/www/ y le damos los respectivos permisos necesarios.</p>\n<pre>\nchown www-data drupal/\nchgrp www-data drupal/\n</pre>\n</li>\n<li>\n<p>Añadimos la nueva ruta a nuestro archivo de configuracion</p>\n<pre>\nDocumentRoot /var/www/drupal\n</pre>\n</li>\n<li>\n<p>Enlace simbolico:</p>\n<pre>\nvagrant@drupal:/etc/apache2/sites-available$ sudo a2ensite drupal\n</pre>\n</li>\n<li>\n<p>Cambiamos el usuario del directorio</p>\n<pre>\nvagrant@drupal:/etc/apache2/sites-available$ sudo chown -R www-data:www-data /var/www/drupal/\n</pre>\n</li>\n<li>\n<p>Recargamos apache2</p>\n<pre>\nsystemctl reload apache2\n</pre>\n<p>-Modificamos el fichero  hosts en nuestra maquina fisica</p>\n<pre>\n192.168.100.5       www.madu-drupal.org\n</pre>\n<p>-El contenido de este archivo es un bloque Directory para el directorio de Drupal en el que una directiva AllowOverride permitirá el uso de los archivos .htaccess:</p>\n<pre>\n    <Directory /var/www/drupal>\n            AllowOverride all\n    </Directory>\n</pre>\n</li>\n</ul>\n<p>-Con estos pasos hechos correctamente podremos ver como podemos usar drupal desde nuestro navegador\n!drupalfound.png!</p>\n<p>Una vez realizado todos los procedimientos de configuración del asistente de instalación, tendremos instalado drupal en nuestro servidor.\nEl proceso es muy simple típico siguiente,siguiente,siguiente...</p>\n<p>Me salia un error de no tener URL limpia configurada lo he solucionado, activando el mod_rewrite y modificando el fichero apache.conf en la siguiente linea</p>\n<pre>\n#Para tener una URL limpia, añadimos el siguiente módulo y cambiamos el AllowOverride de \"None\" a \"All\":\nvagrant@drupal:/var/www/html$ sudo a2enmod rewrite\nvagrant@drupal:/etc/apache2$ sudo nano apache2.conf\n<Directory /var/www/>\n        Options Indexes FollowSymLinks\n        AllowOverride All\n        Require all granted\n</Directory>\n</pre>\n<p>Una vez terminada la configuración inicial podremos ver esta pantalla.\n!drupal1.png!</p>\n<p>4.- Realiza una configuración mínima de la aplicación (Cambia la plantilla, crea algún contenido, …)\nDentro de nuestra web de drupal accederemos a apariencias -> nueva plantilla -> ponemos la URL de la plantilla que hayamos buscado ->\n<a href=\"https://ftp.drupal.org/files/projects/adminimal_theme-8.x-1.6.tar.gz\">https://ftp.drupal.org/files/projects/adminimal_theme-8.x-1.6.tar.gz</a>\ny creamos un poco de contenido:\n!drupalnode1.png!</p>\n<p>5.- Instala un módulo para añadir alguna funcionalidad a drupal.\nHe instalado un nuevo modulo -> <a href=\"https://ftp.drupal.org/files/projects/inline_entity_form-8.x-1.0-rc8.tar.gz\">https://ftp.drupal.org/files/projects/inline_entity_form-8.x-1.0-rc8.tar.gz</a>\nLo activamos, este modulo se encarga de proporciona un widget para la gestión en línea (creación, modificación, eliminación) de entidades referenciadas.</p>\n<p>En este momento, muestra al profesor la aplicación funcionando en local. (4 puntos)</p>\n<p>h1. Tarea 3: Configuración multinodo</p>\n<ul>\n<li>\n<p>Realiza un copia de seguridad de la base de datos</p>\n<pre>\nvagrant@drupal:~$ mysqldump -v --opt --events --routines --triggers --default-character-set=utf8 -u fmadu -p fmadudb > fmadu.sql\nEnter password: \n-- Connecting to localhost...\n-- Disconnecting from localhost...\nvagrant@drupal:~$ ls\nfmadu.sql\n</pre>\n</li>\n<li>Crea otra máquina con vagrant, conectada con una red interna a la anterior y configura un servidor de base de datos.</li>\n</ul>\n<p>Creamos una máquina nueva con vagrant</p>\n<pre>\n bdd.vm.box = \"debian/buster64\"\n bdd.vm.hostname = \"bdd\"\n bdd.vm.network :public_network,:bridge=>\"wlo1\"\n bdd.vm.network :private_network, ip: \"192.168.100.6\", virtualbox__intnet: \"drupal\"\n</pre>\n<ul>\n<li>\n<p>Crea un usuario en la base de datos para trabajar con la nueva base de datos.</p>\n<pre>\nCreamos un usuario en el nuevo servidor:\n</li>\n</ul>\n<p>vagrant@bdd:~$ sudo mysql -u root -p</p>\n<p>MariaDB [(none)]> create user 'drupal2' identified by 'dios';</p>\n<p>MariaDB [(none)]> grant all privileges on <em>.</em> to 'drupal2'@'localhost' identified by 'dios' with grant option;</p>\n<p>MariaDB [(none)]> create database 'drupal2_db';</p>\n<p>Ahora le damos permisos también a la máquina con drupal:</p>\n<p>MariaDB [(none)]> grant all on drupal2_db.* to drupal2@192.168.2.171 identified by 'dios';</p>\n</pre>\n<ul>\n<li>\n<p>Restaura la copia de seguridad en el nuevo servidor de base datos.\nHe usado git para pasar el archivo de una maquina a otra.</p>\n<pre>\nmysql -u drupal2 --password=dios drupal2_db < /home/vagrant/prueba/fmadu.sql \n</pre>\n</li>\n<li>\n<p>Desinstala el servidor de base de datos en el servidor principal.</p>\n<pre>\nvagrant@drupal:~$ sudo apt purge mariadb-*\n</pre>\n</li>\n<li>Realiza los cambios de configuración necesario en drupal para que la página funcione.</li>\n</ul>\n<p>Modificamos el fichero 50-server.cnf</p>\n<pre>\nvagrant@drupal2:~$ sudo nano /etc/mysql/mariadb.conf.d/50-server.cnf \n\nbind-address            = 0.0.0.0\n</pre>\n<p>Nos vamos a nuestra maquina drupal, en drupal.conf:</p>\n<pre>\n        ServerName www.madu-drupal.org\n\n        ServerAdmin webmaster@localhost\n        DocumentRoot /var/www/drupal\n\n        <Directory /var/www/drupal>\n                Options FollowSymLinks\n                AllowOverride All\n                Order allow,deny\n                allow from all\n        </Directory>\n</pre>\n<pre>\nvagrant@drupal:/var/www/drupal/sites/default$ sudo nano settings.php \n\n$databases['default']['default'] = array (\n  'database' => 'drupal2_db',\n  'username' => 'drupal2',\n  'password' => 'dios',\n  'prefix' => '',\n  'host' => '192.168.2.63,\n  'port' => '3306',\n  'namespace' => 'Drupal\\\\Core\\\\Database\\\\Driver\\\\mysql',\n  'driver' => 'mysql',\n);\n</pre>\n<p>h1. Tarea 4: Instalación de otro CMS PHP</p>\n<ul>\n<li>\n<p>Elige otro CMS realizado en PHP y realiza la instalación en tu infraestructura.\nvagrant@drupal:/var/www$ sudo wget <a href=\"https://downloads.joomla.org/es/cms/joomla3/3-9-22/Joomla_3-9-22-Stable-Full_Package.zip?format=zip\">https://downloads.joomla.org/es/cms/joomla3/3-9-22/Joomla_3-9-22-Stable-Full_Package.zip?format=zip</a>\nvagrant@drupal:/var/www/joomla$ ls\nadministrator   cli            images      installation                                        layouts       media     README.txt        tmp\nbin             components     includes   'Joomla<em>3-9-22-Stable-Full</em>Package.zip?format=zip'   libraries     modules   robots.txt.dist   web.config.txt\ncache           htaccess.txt   index.php   language<br>\nvagrant@drupal:/var/www$ sudo chown -R www-data:www-data joomla/</p>\n</pre>\n</li>\n</ul>\n<pre>\nvagrant@drupal:/etc/apache2/sites-available$ sudo cp drupal.conf joomla.conf\n        ServerName www.madu-joomla.org\n\n        ServerAdmin webmaster@localhost\n        DocumentRoot /var/www/joomla\n        <Directory /var/www/joomla>\n                AllowOverride all\n        </Directory>\nvagrant@drupal:/etc/apache2/sites-available$ sudo a2ensite joomla.conf \nvagrant@drupal:/etc/apache2/sites-available$ sudo systemctl reload apache2\n</pre>\n<p>creamos base de datos para joomla</p>\n<pre>\nvagrant@drupal:/etc/apache2/sites-available$ sudo mysql -u fmadu -p\n\nMariaDB [(none)]> create database fmadudbjoomla;\nQuery OK, 1 row affected (0.017 sec)\n\nMariaDB [(none)]> create user 'joomla1' identified by 'dios';\nQuery OK, 0 rows affected (0.001 sec)\n\nMariaDB [(none)]> grant all on fmadudbjoomla.* to joomla1 identified by 'joomla1'\n    -> ;\nQuery OK, 0 rows affected (0.014 sec)\n</pre>\n<ul>\n<li>\n<p>Configura otro virtualhost y elige otro nombre en el mismo dominio.\nEn mi maquina -></p>\n<pre>\n192.168.100.5   www.madu-drupal.org\n192.168.100.5   www.madu-joomla.org\n</pre>\n</li>\n</ul>\n<p>!joomla.png!\n!joomla2.png!</p>\n<p>Tarea 5: Necesidad de otros serviciosPermalink\nLa mayoría de los CMS tienen la posibilidad de mandar correos electrónicos (por ejemplo para notificar una nueva versión, notificar un comentario,…)</p>\n<ul>\n<li>\n<p>Instala un servidor de correo electrónico en tu servidor. debes configurar un servidor relay de correo, para ello en el fichero /etc/postfix/main.cf, debes poner la siguiente línea:\nrelayhost = babuino-smtp.gonzalonazareno.org</p>\n<pre>\nvagrant@drupal:/var/www/joomla$ sudo apt install postfix\n</pre>\n<p>Selecciono Internet site y luego pongo un correo -> madu.gonzalonazareno.org</p>\n</li>\n</ul>\n<p>En /etc/postfix/main.cf:</p>\n<pre>\nsmtpd_relay_restrictions = permit_mynetworks permit_sasl_authenticated defer_unauth_destination\nmyhostname = drupal\nalias_maps = hash:/etc/aliases\nalias_database = hash:/etc/aliases\nmyorigin = /etc/mailname\nmydestination = $myhostname, madu.gonzalonazareno.org, drupal, localhost.localdomain, localhost\nrelayhost = babuino-smtp.gonzalonazareno.org\nmynetworks = 127.0.0.0/8 [::ffff:127.0.0.0]/104 [::1]/128\nmailbox_size_limit = 0\nrecipient_delimiter = +\ninet_interfaces = all\ninet_protocols = all\n</pre>\n<p>Se inicia el servicio</p>\n<pre>\nvagrant@drupal:/var/www/joomla$ sudo systemctl start postfix\nvagrant@drupal:/var/www/joomla$ mailq\nMail queue is empty\n</pre>\n<ul>\n<li>\n<p>Configura alguno de los CMS para utilizar tu servidor de correo y realiza una prueba de funcionamiento.</p>\n<pre>\nvagrant@drupal:/var/www/joomla$ mailq\n-Queue ID-  --Size-- ----Arrival Time---- -Sender/Recipient-------\n041EF62200      706 Mon Nov  2 16:13:19  frandh1997@gmail.com\n(connect to babuino-smtp.gonzalonazareno.org[80.59.1.152]:25: Connection timed out)\n                                     frandh1997@gmail.com\n</li>\n</ul>\n<p>01D1B623E7      993 Mon Nov  2 16:13:18  frandh1997@gmail.com\n(connect to babuino-smtp.gonzalonazareno.org[80.59.1.152]:25: Connection timed out)\nfrangodh97@gmail.com</p>\n<p>-- 1 Kbytes in 2 Requests.</p>\n</pre>\n<p> se deberian enviar esos mensajes de nuevo usuarios, al no estar conectados a la red con babuino no se pueden enviar</p>","timeToRead":7,"excerpt":"h1. Tarea 1: Instalación de un servidor LAMP 1.- Crea una instancia de vagrant basado en un box debian o ubuntu 2.- Instala en esa máquina…","frontmatter":{"title":"[IAW] - P1. Instalación local de un CMS PHP","cover":"https://img.icons8.com/ios/452/work.png","date":"2020-10-15T00:00:00.000Z","categories":["IAW"],"tags":["CMS","PHP","LAMP","Drupal"]},"fields":{"slug":"/iaw-p-1-instalacion-local-de-un-cms-php","date":"October 14, 2020"}}},"pageContext":{"slug":"/iaw-p-1-instalacion-local-de-un-cms-php","nexttitle":"Práctica 3: Integridad de ficheros (Unidad 1)","nextslug":"/practica-3-integridad-de-ficheros-unidad-1","prevtitle":"Práctica 1: Implantación y despliegue de una aplicación web estática","prevslug":"/practica-1-implantacion-y-despliegue-de-una-aplicacion-web-estatica"}}}